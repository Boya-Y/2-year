{\rtf1\ansi\ansicpg936\cocoartf2822
\cocoatextscaling0\cocoaplatform0{\fonttbl\f0\fnil\fcharset0 Menlo-Regular;}
{\colortbl;\red255\green255\blue255;\red111\green14\blue195;\red236\green241\blue247;\red0\green0\blue0;
\red14\green110\blue109;\red24\green112\blue43;\red77\green80\blue85;\red164\green69\blue11;}
{\*\expandedcolortbl;;\cssrgb\c51765\c18824\c80784;\cssrgb\c94118\c95686\c97647;\cssrgb\c0\c0\c0;
\cssrgb\c0\c50196\c50196;\cssrgb\c9412\c50196\c21961;\cssrgb\c37255\c38824\c40784;\cssrgb\c70980\c34902\c3137;}
\paperw11900\paperh16840\margl1440\margr1440\vieww11520\viewh8400\viewkind0
\deftab720
\pard\pardeftab720\partightenfactor0

\f0\fs28 \cf2 \cb3 \expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 import\cf0 \strokec4  \cf5 \strokec5 React\cf0 \strokec4 , \{ useEffect, useRef \} \cf2 \strokec2 from\cf0 \strokec4  \cf6 \strokec6 'react'\cf0 \strokec4 ;\cb1 \
\
\cf7 \cb3 \strokec7 // ==================== \uc0\u24120 \u37327 \u23450 \u20041  ====================\cf0 \cb1 \strokec4 \
\
\cf2 \cb3 \strokec2 const\cf0 \strokec4  \cf5 \strokec5 STATE\cf0 \strokec4  = \{\cb1 \
\cb3   \cf5 \strokec5 MENU\cf0 \strokec4 : \cf8 \strokec8 0\cf0 \strokec4 ,\cb1 \
\cb3   \cf5 \strokec5 SCENE_1_NOTIFICATION\cf0 \strokec4 : \cf8 \strokec8 11\cf0 \strokec4 ,\cb1 \
\cb3   \cf5 \strokec5 SCENE_1_CHAT\cf0 \strokec4 : \cf8 \strokec8 1\cf0 \strokec4 ,\cb1 \
\cb3   \cf5 \strokec5 SCENE_1_PHONE\cf0 \strokec4 : \cf8 \strokec8 2\cf0 \strokec4 ,\cb1 \
\cb3   \cf5 \strokec5 SCENE_2_DINNER\cf0 \strokec4 : \cf8 \strokec8 3\cf0 \strokec4 ,\cb1 \
\cb3   \cf5 \strokec5 SCENE_3_WALK\cf0 \strokec4 : \cf8 \strokec8 4\cf0 \strokec4 ,\cb1 \
\cb3   \cf5 \strokec5 SCENE_4_DATE\cf0 \strokec4 : \cf8 \strokec8 7\cf0 \strokec4 ,\cb1 \
\cb3   \cf5 \strokec5 SCENE_5_HAIR\cf0 \strokec4 : \cf8 \strokec8 8\cf0 \strokec4 ,\cb1 \
\cb3   \cf5 \strokec5 SCENE_6_PHOTO\cf0 \strokec4 : \cf8 \strokec8 9\cf0 \strokec4 ,\cb1 \
\cb3   \cf5 \strokec5 SCENE_7_SKINCARE\cf0 \strokec4 : \cf8 \strokec8 10\cf0 \strokec4 ,\cb1 \
\cb3   \cf5 \strokec5 SCENE_HOME_TV\cf0 \strokec4 : \cf8 \strokec8 6\cf0 \strokec4 ,\cb1 \
\cb3   \cf5 \strokec5 ENDING\cf0 \strokec4 : \cf8 \strokec8 5\cf0 \cb1 \strokec4 \
\cb3 \};\cb1 \
\
\cf2 \cb3 \strokec2 const\cf0 \strokec4  \cf5 \strokec5 COLORS\cf0 \strokec4  = \{\cb1 \
\cb3   bg: \cf6 \strokec6 '#fffaf0'\cf0 \strokec4 ,\cb1 \
\cb3   primary: \cf6 \strokec6 '#ff8da1'\cf0 \strokec4 ,\cb1 \
\cb3   xhs_red: \cf6 \strokec6 '#ff2442'\cf0 \strokec4 ,\cb1 \
\cb3   text: \cf6 \strokec6 '#333333'\cf0 \strokec4 ,\cb1 \
\cb3   text_gray: \cf6 \strokec6 '#999999'\cf0 \strokec4 ,\cb1 \
\cb3   highlight: \cf6 \strokec6 '#ffb7c5'\cf0 \strokec4 ,\cb1 \
\cb3   ui_gray: \cf6 \strokec6 '#f5f5f5'\cf0 \strokec4 ,\cb1 \
\cb3   line_gray: \cf6 \strokec6 '#e6e6e6'\cf0 \strokec4 ,\cb1 \
\cb3   phone_screen: \cf6 \strokec6 '#ffffff'\cf0 \strokec4 ,\cb1 \
\cb3   bubble_green: \cf6 \strokec6 '#95ec69'\cf0 \strokec4 ,\cb1 \
\cb3   bubble_me: \cf6 \strokec6 '#ff8da1'\cf0 \strokec4 ,\cb1 \
\cb3   window_light: \cf6 \strokec6 '#f1c40f'\cf0 \strokec4 ,\cb1 \
\cb3   night_sky: \cf6 \strokec6 '#2c3e50'\cf0 \cb1 \strokec4 \
\cb3 \};\cb1 \
\
\cf2 \cb3 \strokec2 const\cf0 \strokec4  \cf5 \strokec5 LOGIC_W\cf0 \strokec4  = \cf8 \strokec8 450\cf0 \strokec4 ;\cb1 \
\cf2 \cb3 \strokec2 const\cf0 \strokec4  \cf5 \strokec5 LOGIC_H\cf0 \strokec4  = \cf8 \strokec8 800\cf0 \strokec4 ;\cb1 \
\
\cf2 \cb3 \strokec2 export\cf0 \strokec4  \cf2 \strokec2 default\cf0 \strokec4  \cf2 \strokec2 function\cf0 \strokec4  \cf5 \strokec5 App\cf0 \strokec4 () \{\cb1 \
\cb3   \cf2 \strokec2 const\cf0 \strokec4  canvasRef = useRef(\cf2 \strokec2 null\cf0 \strokec4 );\cb1 \
\cb3   \cb1 \
\cb3   \cf2 \strokec2 const\cf0 \strokec4  gameState = useRef(\{\cb1 \
\cb3     current: \cf5 \strokec5 STATE\cf0 \strokec4 .\cf5 \strokec5 MENU\cf0 \strokec4 ,\cb1 \
\cb3     score: \cf8 \strokec8 0\cf0 \strokec4 ,\cb1 \
\cb3     frameCount: \cf8 \strokec8 0\cf0 \strokec4 ,\cb1 \
\cb3     mouse: \{ x: \cf8 \strokec8 0\cf0 \strokec4 , y: \cf8 \strokec8 0\cf0 \strokec4 , clicked: \cf2 \strokec2 false\cf0 \strokec4 , down: \cf2 \strokec2 false\cf0 \strokec4 , lastY: \cf8 \strokec8 0\cf0 \strokec4  \},\cb1 \
\cb3     textTyper: \{ text: \cf6 \strokec6 ""\cf0 \strokec4 , index: \cf8 \strokec8 0\cf0 \strokec4 , complete: \cf2 \strokec2 false\cf0 \strokec4  \},\cb1 \
\cb3     profileScrollY: \cf8 \strokec8 0\cf0 \strokec4 ,\cb1 \
\cb3     \cb1 \
\cb3     transition: \{ active: \cf2 \strokec2 false\cf0 \strokec4 , alpha: \cf8 \strokec8 0\cf0 \strokec4 , mode: \cf6 \strokec6 'IDLE'\cf0 \strokec4 , nextState: \cf2 \strokec2 null\cf0 \strokec4 , onMidpoint: \cf2 \strokec2 null\cf0 \strokec4  \},\cb1 \
\
\cb3     billTimer: \cf8 \strokec8 0\cf0 \strokec4 ,\cb1 \
\cb3     walkTimer: \cf8 \strokec8 0\cf0 \strokec4 ,\cb1 \
\cb3     showDinnerOptions: \cf2 \strokec2 false\cf0 \strokec4 ,\cb1 \
\cb3     waiterX: \cf5 \strokec5 LOGIC_W\cf0 \strokec4  + \cf8 \strokec8 100\cf0 \strokec4 , \cb1 \
\cb3     \cb1 \
\cb3     paymentFeedbackTimer: \cf8 \strokec8 0\cf0 \strokec4 , \cb1 \
\cb3     coatClickTime: \cf8 \strokec8 0\cf0 \strokec4 ,\cb1 \
\cb3     \cb1 \
\cb3     scene1Reply: \{ choiceMade: \cf2 \strokec2 false\cf0 \strokec4 , userText: \cf6 \strokec6 ""\cf0 \strokec4 , replyText: \cf6 \strokec6 ""\cf0 \strokec4 , showQR: \cf2 \strokec2 false\cf0 \strokec4 , timer: \cf8 \strokec8 0\cf0 \strokec4  \},\cb1 \
\cb3     homeTv: \{ timer: \cf8 \strokec8 0\cf0 \strokec4 , showOptions: \cf2 \strokec2 false\cf0 \strokec4 , lipstickClickFrame: \cf8 \strokec8 0\cf0 \strokec4 , reaction: \{ active: \cf2 \strokec2 false\cf0 \strokec4 , text: \cf6 \strokec6 ""\cf0 \strokec4 , color: \cf6 \strokec6 "#333"\cf0 \strokec4 , timer: \cf8 \strokec8 0\cf0 \strokec4  \} \},\cb1 \
\cb3     date: \{ timer: \cf8 \strokec8 0\cf0 \strokec4 , phase: \cf8 \strokec8 0\cf0 \strokec4 , phaseTimer: \cf8 \strokec8 0\cf0 \strokec4  \},\cb1 \
\cb3     hair: \{ timer: \cf8 \strokec8 0\cf0 \strokec4 , phase: \cf8 \strokec8 0\cf0 \strokec4 , dryerBought: \cf2 \strokec2 false\cf0 \strokec4  \},\cb1 \
\cb3     photo: \{ timer: \cf8 \strokec8 0\cf0 \strokec4 , count: \cf8 \strokec8 0\cf0 \strokec4 , phase: \cf8 \strokec8 0\cf0 \strokec4 , flash: \cf8 \strokec8 0\cf0 \strokec4  \},\cb1 \
\cb3     skin: \{ timer: \cf8 \strokec8 0\cf0 \strokec4 , phase: \cf8 \strokec8 0\cf0 \strokec4 , newBottleShown: \cf2 \strokec2 false\cf0 \strokec4  \},\cb1 \
\cb3     notification: \{ timer: \cf8 \strokec8 0\cf0 \strokec4 , phase: \cf8 \strokec8 0\cf0 \strokec4 , slideY: \cf8 \strokec8 0\cf0 \strokec4 , unlockTimer: \cf8 \strokec8 0\cf0 \strokec4  \},\cb1 \
\cb3     \cb1 \
\cb3     flags: \{\cb1 \
\cb3       sawMoments: \cf2 \strokec2 false\cf0 \strokec4 ,\cb1 \
\cb3       paidSecretly: \cf2 \strokec2 false\cf0 \strokec4 ,\cb1 \
\cb3       gaveCoat: \cf2 \strokec2 false\cf0 \strokec4 ,\cb1 \
\cb3       usedLipstick: \cf2 \strokec2 false\cf0 \strokec4 ,\cb1 \
\cb3       scene1Correct: \cf2 \strokec2 false\cf0 \strokec4 ,\cb1 \
\cb3       scene5Correct: \cf2 \strokec2 false\cf0 \strokec4 ,\cb1 \
\cb3       scene6Correct: \cf2 \strokec2 false\cf0 \strokec4 ,\cb1 \
\cb3       scene7Correct: \cf2 \strokec2 false\cf0 \strokec4 ,\cb1 \
\cb3       scene1Finished: \cf2 \strokec2 false\cf0 \strokec4 ,\cb1 \
\cb3       scene1InputClicked: \cf2 \strokec2 false\cf0 \strokec4 ,\cb1 \
\cb3       scene2Finished: \cf2 \strokec2 false\cf0 \strokec4 ,\cb1 \
\cb3       scene3Finished: \cf2 \strokec2 false\cf0 \strokec4 ,\cb1 \
\cb3       failReason: \cf8 \strokec8 0\cf0 \cb1 \strokec4 \
\cb3     \}\cb1 \
\cb3   \});\cb1 \
\
\cb3   \cf2 \strokec2 const\cf0 \strokec4  layoutRef = useRef(\{ scale: \cf8 \strokec8 1\cf0 \strokec4 , offsetX: \cf8 \strokec8 0\cf0 \strokec4 , offsetY: \cf8 \strokec8 0\cf0 \strokec4  \});\cb1 \
\
\cb3   useEffect(() => \{\cb1 \
\cb3     \cf2 \strokec2 const\cf0 \strokec4  canvas = canvasRef.current;\cb1 \
\cb3     \cf2 \strokec2 const\cf0 \strokec4  ctx = canvas.getContext(\cf6 \strokec6 '2d'\cf0 \strokec4 );\cb1 \
\cb3     \cf2 \strokec2 let\cf0 \strokec4  animationFrameId;\cb1 \
\
\cb3     \cf2 \strokec2 const\cf0 \strokec4  resize = () => \{\cb1 \
\cb3       \cf2 \strokec2 const\cf0 \strokec4  dpr = window.devicePixelRatio || \cf8 \strokec8 1\cf0 \strokec4 ;\cb1 \
\cb3       \cf2 \strokec2 const\cf0 \strokec4  \{ innerWidth, innerHeight \} = window;\cb1 \
\cb3       canvas.width = innerWidth * dpr;\cb1 \
\cb3       canvas.height = innerHeight * dpr;\cb1 \
\cb3       canvas.style.width = \cf6 \strokec6 `\cf0 \strokec4 $\{innerWidth\}\cf6 \strokec6 px`\cf0 \strokec4 ;\cb1 \
\cb3       canvas.style.height = \cf6 \strokec6 `\cf0 \strokec4 $\{innerHeight\}\cf6 \strokec6 px`\cf0 \strokec4 ;\cb1 \
\cb3       \cf2 \strokec2 const\cf0 \strokec4  scale = \cf5 \strokec5 Math\cf0 \strokec4 .min(innerWidth / \cf5 \strokec5 LOGIC_W\cf0 \strokec4 , innerHeight / \cf5 \strokec5 LOGIC_H\cf0 \strokec4 );\cb1 \
\cb3       \cf2 \strokec2 const\cf0 \strokec4  drawW = \cf5 \strokec5 LOGIC_W\cf0 \strokec4  * scale;\cb1 \
\cb3       \cf2 \strokec2 const\cf0 \strokec4  drawH = \cf5 \strokec5 LOGIC_H\cf0 \strokec4  * scale;\cb1 \
\cb3       \cf2 \strokec2 const\cf0 \strokec4  offsetX = (innerWidth - drawW) / \cf8 \strokec8 2\cf0 \strokec4 ;\cb1 \
\cb3       \cf2 \strokec2 const\cf0 \strokec4  offsetY = (innerHeight - drawH) / \cf8 \strokec8 2\cf0 \strokec4 ;\cb1 \
\cb3       layoutRef.current = \{ scale, offsetX, offsetY, dpr \};\cb1 \
\cb3       ctx.setTransform(\cf8 \strokec8 1\cf0 \strokec4 , \cf8 \strokec8 0\cf0 \strokec4 , \cf8 \strokec8 0\cf0 \strokec4 , \cf8 \strokec8 1\cf0 \strokec4 , \cf8 \strokec8 0\cf0 \strokec4 , \cf8 \strokec8 0\cf0 \strokec4 );\cb1 \
\cb3       ctx.scale(dpr, dpr);\cb1 \
\cb3       ctx.translate(offsetX, offsetY);\cb1 \
\cb3       ctx.scale(scale, scale);\cb1 \
\cb3       ctx.imageSmoothingEnabled = \cf2 \strokec2 true\cf0 \strokec4 ;\cb1 \
\cb3       ctx.imageSmoothingQuality = \cf6 \strokec6 'high'\cf0 \strokec4 ;\cb1 \
\cb3     \};\cb1 \
\cb3     window.addEventListener(\cf6 \strokec6 'resize'\cf0 \strokec4 , resize);\cb1 \
\cb3     resize();\cb1 \
\
\cb3     \cf2 \strokec2 const\cf0 \strokec4  getLogicPos = (evt) => \{\cb1 \
\cb3       \cf2 \strokec2 const\cf0 \strokec4  \{ scale, offsetX, offsetY \} = layoutRef.current;\cb1 \
\cb3       \cf2 \strokec2 let\cf0 \strokec4  clientX, clientY;\cb1 \
\cb3       \cf2 \strokec2 if\cf0 \strokec4  (evt.touches && evt.touches.length > \cf8 \strokec8 0\cf0 \strokec4 ) \{\cb1 \
\cb3         clientX = evt.touches[\cf8 \strokec8 0\cf0 \strokec4 ].clientX;\cb1 \
\cb3         clientY = evt.touches[\cf8 \strokec8 0\cf0 \strokec4 ].clientY;\cb1 \
\cb3       \} \cf2 \strokec2 else\cf0 \strokec4  \cf2 \strokec2 if\cf0 \strokec4  (evt.changedTouches && evt.changedTouches.length > \cf8 \strokec8 0\cf0 \strokec4 ) \{\cb1 \
\cb3         clientX = evt.changedTouches[\cf8 \strokec8 0\cf0 \strokec4 ].clientX;\cb1 \
\cb3         clientY = evt.changedTouches[\cf8 \strokec8 0\cf0 \strokec4 ].clientY;\cb1 \
\cb3       \} \cf2 \strokec2 else\cf0 \strokec4  \{\cb1 \
\cb3         clientX = evt.clientX;\cb1 \
\cb3         clientY = evt.clientY;\cb1 \
\cb3       \}\cb1 \
\cb3       \cf2 \strokec2 return\cf0 \strokec4  \{ x: (clientX - offsetX) / scale, y: (clientY - offsetY) / scale \};\cb1 \
\cb3     \};\cb1 \
\
\cb3     \cf2 \strokec2 const\cf0 \strokec4  handleInputStart = (e) => \{\cb1 \
\cb3       \cf2 \strokec2 const\cf0 \strokec4  pos = getLogicPos(e);\cb1 \
\cb3       \cf2 \strokec2 const\cf0 \strokec4  s = gameState.current;\cb1 \
\cb3       s.mouse.x = pos.x; s.mouse.y = pos.y; s.mouse.lastY = pos.y;\cb1 \
\cb3       s.mouse.clicked = \cf2 \strokec2 true\cf0 \strokec4 ; s.mouse.down = \cf2 \strokec2 true\cf0 \strokec4 ;\cb1 \
\cb3     \};\cb1 \
\
\cb3     \cf2 \strokec2 const\cf0 \strokec4  handleInputMove = (e) => \{\cb1 \
\cb3       e.preventDefault(); \cb1 \
\cb3       \cf2 \strokec2 const\cf0 \strokec4  pos = getLogicPos(e);\cb1 \
\cb3       \cf2 \strokec2 const\cf0 \strokec4  s = gameState.current;\cb1 \
\cb3       \cf2 \strokec2 if\cf0 \strokec4  (s.current === \cf5 \strokec5 STATE\cf0 \strokec4 .\cf5 \strokec5 SCENE_1_PHONE\cf0 \strokec4  && s.mouse.down) \{\cb1 \
\cb3         \cf2 \strokec2 const\cf0 \strokec4  deltaY = s.mouse.lastY - pos.y;\cb1 \
\cb3         s.profileScrollY += deltaY;\cb1 \
\cb3         s.profileScrollY = \cf5 \strokec5 Math\cf0 \strokec4 .max(\cf8 \strokec8 0\cf0 \strokec4 , \cf5 \strokec5 Math\cf0 \strokec4 .min(s.profileScrollY, \cf8 \strokec8 400\cf0 \strokec4 ));\cb1 \
\cb3       \}\cb1 \
\cb3       s.mouse.x = pos.x; s.mouse.y = pos.y; s.mouse.lastY = pos.y;\cb1 \
\cb3     \};\cb1 \
\
\cb3     \cf2 \strokec2 const\cf0 \strokec4  handleInputEnd = () => \{ gameState.current.mouse.down = \cf2 \strokec2 false\cf0 \strokec4 ; \};\cb1 \
\
\cb3     canvas.addEventListener(\cf6 \strokec6 'mousedown'\cf0 \strokec4 , handleInputStart);\cb1 \
\cb3     canvas.addEventListener(\cf6 \strokec6 'mousemove'\cf0 \strokec4 , handleInputMove);\cb1 \
\cb3     canvas.addEventListener(\cf6 \strokec6 'mouseup'\cf0 \strokec4 , handleInputEnd);\cb1 \
\cb3     canvas.addEventListener(\cf6 \strokec6 'touchstart'\cf0 \strokec4 , handleInputStart, \{ passive: \cf2 \strokec2 false\cf0 \strokec4  \});\cb1 \
\cb3     canvas.addEventListener(\cf6 \strokec6 'touchmove'\cf0 \strokec4 , handleInputMove, \{ passive: \cf2 \strokec2 false\cf0 \strokec4  \});\cb1 \
\cb3     canvas.addEventListener(\cf6 \strokec6 'touchend'\cf0 \strokec4 , handleInputEnd);\cb1 \
\
\cb3     \cf2 \strokec2 const\cf0 \strokec4  resetGame = () => \{\cb1 \
\cb3       \cf2 \strokec2 const\cf0 \strokec4  s = gameState.current;\cb1 \
\cb3       s.score = \cf8 \strokec8 0\cf0 \strokec4 ; s.frameCount = \cf8 \strokec8 0\cf0 \strokec4 ; s.billTimer = \cf8 \strokec8 0\cf0 \strokec4 ; s.walkTimer = \cf8 \strokec8 0\cf0 \strokec4 ;\cb1 \
\cb3       s.paymentFeedbackTimer = \cf8 \strokec8 0\cf0 \strokec4 ; s.coatClickTime = \cf8 \strokec8 0\cf0 \strokec4 ;\cb1 \
\cb3       s.homeTv = \{ timer: \cf8 \strokec8 0\cf0 \strokec4 , showOptions: \cf2 \strokec2 false\cf0 \strokec4 , lipstickClickFrame: \cf8 \strokec8 0\cf0 \strokec4 , reaction: \{ active: \cf2 \strokec2 false\cf0 \strokec4 , text: \cf6 \strokec6 ""\cf0 \strokec4 , color: \cf6 \strokec6 "#333"\cf0 \strokec4 , timer: \cf8 \strokec8 0\cf0 \strokec4  \} \};\cb1 \
\cb3       s.showDinnerOptions = \cf2 \strokec2 false\cf0 \strokec4 ; s.waiterX = \cf5 \strokec5 LOGIC_W\cf0 \strokec4  + \cf8 \strokec8 100\cf0 \strokec4 ; s.profileScrollY = \cf8 \strokec8 0\cf0 \strokec4 ;\cb1 \
\cb3       s.date = \{ timer: \cf8 \strokec8 0\cf0 \strokec4 , phase: \cf8 \strokec8 0\cf0 \strokec4 , phaseTimer: \cf8 \strokec8 0\cf0 \strokec4  \};\cb1 \
\cb3       s.hair = \{ timer: \cf8 \strokec8 0\cf0 \strokec4 , phase: \cf8 \strokec8 0\cf0 \strokec4 , dryerBought: \cf2 \strokec2 false\cf0 \strokec4  \};\cb1 \
\cb3       s.photo = \{ timer: \cf8 \strokec8 0\cf0 \strokec4 , count: \cf8 \strokec8 0\cf0 \strokec4 , phase: \cf8 \strokec8 0\cf0 \strokec4 , flash: \cf8 \strokec8 0\cf0 \strokec4  \};\cb1 \
\cb3       s.skin = \{ timer: \cf8 \strokec8 0\cf0 \strokec4 , phase: \cf8 \strokec8 0\cf0 \strokec4 , newBottleShown: \cf2 \strokec2 false\cf0 \strokec4  \};\cb1 \
\cb3       s.scene1Reply = \{ choiceMade: \cf2 \strokec2 false\cf0 \strokec4 , userText: \cf6 \strokec6 ""\cf0 \strokec4 , replyText: \cf6 \strokec6 ""\cf0 \strokec4 , showQR: \cf2 \strokec2 false\cf0 \strokec4 , timer: \cf8 \strokec8 0\cf0 \strokec4  \};\cb1 \
\cb3       s.transition = \{ active: \cf2 \strokec2 false\cf0 \strokec4 , alpha: \cf8 \strokec8 0\cf0 \strokec4 , mode: \cf6 \strokec6 'IDLE'\cf0 \strokec4 , nextState: \cf2 \strokec2 null\cf0 \strokec4 , onMidpoint: \cf2 \strokec2 null\cf0 \strokec4  \};\cb1 \
\cb3       s.notification = \{ timer: \cf8 \strokec8 0\cf0 \strokec4 , phase: \cf8 \strokec8 0\cf0 \strokec4 , slideY: \cf8 \strokec8 0\cf0 \strokec4 , unlockTimer: \cf8 \strokec8 0\cf0 \strokec4  \};\cb1 \
\cb3       \cf5 \strokec5 Object\cf0 \strokec4 .keys(s.flags).forEach(key => s.flags[key] = \cf2 \strokec2 false\cf0 \strokec4 );\cb1 \
\cb3       s.flags.failReason = \cf8 \strokec8 0\cf0 \strokec4 ; s.textTyper = \{ text: \cf6 \strokec6 ""\cf0 \strokec4 , index: \cf8 \strokec8 0\cf0 \strokec4 , complete: \cf2 \strokec2 false\cf0 \strokec4  \};\cb1 \
\cb3     \};\cb1 \
\
\cb3     \cf2 \strokec2 const\cf0 \strokec4  checkPerfectRun = () => \{\cb1 \
\cb3       \cf2 \strokec2 const\cf0 \strokec4  f = gameState.current.flags;\cb1 \
\cb3       \cf2 \strokec2 return\cf0 \strokec4  f.scene1Correct && f.paidSecretly && f.gaveCoat && f.usedLipstick && f.scene5Correct && f.scene6Correct && f.scene7Correct;\cb1 \
\cb3     \};\cb1 \
\
\cb3     \cf2 \strokec2 const\cf0 \strokec4  transitionTo = (newState, instant = \cf2 \strokec2 false\cf0 \strokec4 , onMidpoint = \cf2 \strokec2 null\cf0 \strokec4 ) => \{\cb1 \
\cb3       \cf2 \strokec2 const\cf0 \strokec4  s = gameState.current;\cb1 \
\cb3       s.mouse.clicked = \cf2 \strokec2 false\cf0 \strokec4 ; s.mouse.down = \cf2 \strokec2 false\cf0 \strokec4 ; s.textTyper = \{ text: \cf6 \strokec6 ""\cf0 \strokec4 , index: \cf8 \strokec8 0\cf0 \strokec4 , complete: \cf2 \strokec2 false\cf0 \strokec4  \};\cb1 \
\cb3       \cf2 \strokec2 if\cf0 \strokec4  (instant) \{ s.current = newState; \cf2 \strokec2 if\cf0 \strokec4 (onMidpoint) onMidpoint(); \cf2 \strokec2 return\cf0 \strokec4 ; \}\cb1 \
\cb3       \cf2 \strokec2 if\cf0 \strokec4  (s.transition.active) \cf2 \strokec2 return\cf0 \strokec4 ; \cb1 \
\cb3       s.transition.active = \cf2 \strokec2 true\cf0 \strokec4 ; s.transition.mode = \cf6 \strokec6 'FADE_OUT'\cf0 \strokec4 ; s.transition.alpha = \cf8 \strokec8 0\cf0 \strokec4 ; \cb1 \
\cb3       s.transition.nextState = newState;\cb1 \
\cb3       s.transition.onMidpoint = onMidpoint;\cb1 \
\cb3     \};\cb1 \
\
\cb3     \cf2 \strokec2 const\cf0 \strokec4  findFirstMistake = () => \{\cb1 \
\cb3       \cf2 \strokec2 const\cf0 \strokec4  f = gameState.current.flags;\cb1 \
\cb3       \cf2 \strokec2 if\cf0 \strokec4  (!f.scene1Correct) \cf2 \strokec2 return\cf0 \strokec4  \{ state: \cf5 \strokec5 STATE\cf0 \strokec4 .\cf5 \strokec5 SCENE_1_CHAT\cf0 \strokec4 , label: \cf6 \strokec6 "\uc0\u22238 \u21040  \u32842 \u22825 "\cf0 \strokec4  \};\cb1 \
\cb3       \cf2 \strokec2 if\cf0 \strokec4  (!f.paidSecretly) \cf2 \strokec2 return\cf0 \strokec4  \{ state: \cf5 \strokec5 STATE\cf0 \strokec4 .\cf5 \strokec5 SCENE_2_DINNER\cf0 \strokec4 , label: \cf6 \strokec6 "\uc0\u22238 \u21040  \u26202 \u39184 "\cf0 \strokec4  \};\cb1 \
\cb3       \cf2 \strokec2 if\cf0 \strokec4  (!f.gaveCoat) \cf2 \strokec2 return\cf0 \strokec4  \{ state: \cf5 \strokec5 STATE\cf0 \strokec4 .\cf5 \strokec5 SCENE_3_WALK\cf0 \strokec4 , label: \cf6 \strokec6 "\uc0\u22238 \u21040  \u23506 \u22812 "\cf0 \strokec4  \};\cb1 \
\cb3       \cf2 \strokec2 if\cf0 \strokec4  (!f.usedLipstick) \cf2 \strokec2 return\cf0 \strokec4  \{ state: \cf5 \strokec5 STATE\cf0 \strokec4 .\cf5 \strokec5 SCENE_HOME_TV\cf0 \strokec4 , label: \cf6 \strokec6 "\uc0\u22238 \u21040  \u27801 \u21457 "\cf0 \strokec4  \};\cb1 \
\cb3       \cf2 \strokec2 if\cf0 \strokec4  (!f.scene5Correct) \cf2 \strokec2 return\cf0 \strokec4  \{ state: \cf5 \strokec5 STATE\cf0 \strokec4 .\cf5 \strokec5 SCENE_5_HAIR\cf0 \strokec4 , label: \cf6 \strokec6 "\uc0\u22238 \u21040  \u21561 \u22836 \u21457 "\cf0 \strokec4  \};\cb1 \
\cb3       \cf2 \strokec2 if\cf0 \strokec4  (!f.scene6Correct) \cf2 \strokec2 return\cf0 \strokec4  \{ state: \cf5 \strokec5 STATE\cf0 \strokec4 .\cf5 \strokec5 SCENE_6_PHOTO\cf0 \strokec4 , label: \cf6 \strokec6 "\uc0\u22238 \u21040  \u25293 \u29031 "\cf0 \strokec4  \};\cb1 \
\cb3       \cf2 \strokec2 if\cf0 \strokec4  (!f.scene7Correct) \cf2 \strokec2 return\cf0 \strokec4  \{ state: \cf5 \strokec5 STATE\cf0 \strokec4 .\cf5 \strokec5 SCENE_7_SKINCARE\cf0 \strokec4 , label: \cf6 \strokec6 "\uc0\u22238 \u21040  \u25252 \u32932 "\cf0 \strokec4  \};\cb1 \
\cb3       \cf2 \strokec2 return\cf0 \strokec4  \cf2 \strokec2 null\cf0 \strokec4 ;\cb1 \
\cb3     \};\cb1 \
\
\cb3     \cf2 \strokec2 const\cf0 \strokec4  retryFromMistake = (targetState) => \{\cb1 \
\cb3       transitionTo(targetState, \cf2 \strokec2 false\cf0 \strokec4 , () => \{\cb1 \
\cb3         \cf2 \strokec2 const\cf0 \strokec4  s = gameState.current;\cb1 \
\cb3         \cf2 \strokec2 const\cf0 \strokec4  f = s.flags;\cb1 \
\cb3         \cf2 \strokec2 switch\cf0 \strokec4  (targetState) \{\cb1 \
\cb3             \cf2 \strokec2 case\cf0 \strokec4  \cf5 \strokec5 STATE\cf0 \strokec4 .\cf5 \strokec5 SCENE_1_CHAT\cf0 \strokec4 :\cb1 \
\cb3             s.scene1Reply = \{ choiceMade: \cf2 \strokec2 false\cf0 \strokec4 , userText: \cf6 \strokec6 ""\cf0 \strokec4 , replyText: \cf6 \strokec6 ""\cf0 \strokec4 , showQR: \cf2 \strokec2 false\cf0 \strokec4 , timer: \cf8 \strokec8 0\cf0 \strokec4  \}; f.scene1Finished = \cf2 \strokec2 false\cf0 \strokec4 ; f.scene1InputClicked = \cf2 \strokec2 false\cf0 \strokec4 ; f.scene1Correct = \cf2 \strokec2 false\cf0 \strokec4 ; s.profileScrollY = \cf8 \strokec8 0\cf0 \strokec4 ; s.notification = \{ timer: \cf8 \strokec8 0\cf0 \strokec4 , phase: \cf8 \strokec8 0\cf0 \strokec4 , slideY: \cf8 \strokec8 0\cf0 \strokec4 , unlockTimer: \cf8 \strokec8 0\cf0 \strokec4  \}; \cf2 \strokec2 break\cf0 \strokec4 ;\cb1 \
\cb3             \cf2 \strokec2 case\cf0 \strokec4  \cf5 \strokec5 STATE\cf0 \strokec4 .\cf5 \strokec5 SCENE_2_DINNER\cf0 \strokec4 : s.billTimer = \cf8 \strokec8 0\cf0 \strokec4 ; s.showDinnerOptions = \cf2 \strokec2 false\cf0 \strokec4 ; s.waiterX = \cf5 \strokec5 LOGIC_W\cf0 \strokec4  + \cf8 \strokec8 100\cf0 \strokec4 ; f.scene2Finished = \cf2 \strokec2 false\cf0 \strokec4 ; f.paidSecretly = \cf2 \strokec2 false\cf0 \strokec4 ; s.paymentFeedbackTimer = \cf8 \strokec8 0\cf0 \strokec4 ; \cf2 \strokec2 break\cf0 \strokec4 ;\cb1 \
\cb3             \cf2 \strokec2 case\cf0 \strokec4  \cf5 \strokec5 STATE\cf0 \strokec4 .\cf5 \strokec5 SCENE_3_WALK\cf0 \strokec4 : s.walkTimer = \cf8 \strokec8 0\cf0 \strokec4 ; f.scene3Finished = \cf2 \strokec2 false\cf0 \strokec4 ; f.gaveCoat = \cf2 \strokec2 false\cf0 \strokec4 ; s.coatClickTime = \cf8 \strokec8 0\cf0 \strokec4 ; \cf2 \strokec2 break\cf0 \strokec4 ;\cb1 \
\cb3             \cf2 \strokec2 case\cf0 \strokec4  \cf5 \strokec5 STATE\cf0 \strokec4 .\cf5 \strokec5 SCENE_HOME_TV\cf0 \strokec4 : s.homeTv = \{ timer: \cf8 \strokec8 0\cf0 \strokec4 , showOptions: \cf2 \strokec2 false\cf0 \strokec4 , lipstickClickFrame: \cf8 \strokec8 0\cf0 \strokec4 , reaction: \{ active: \cf2 \strokec2 false\cf0 \strokec4 , text: \cf6 \strokec6 ""\cf0 \strokec4 , color: \cf6 \strokec6 "#333"\cf0 \strokec4 , timer: \cf8 \strokec8 0\cf0 \strokec4  \} \}; f.usedLipstick = \cf2 \strokec2 false\cf0 \strokec4 ; \cf2 \strokec2 break\cf0 \strokec4 ;\cb1 \
\cb3             \cf2 \strokec2 case\cf0 \strokec4  \cf5 \strokec5 STATE\cf0 \strokec4 .\cf5 \strokec5 SCENE_5_HAIR\cf0 \strokec4 : s.hair = \{ timer: \cf8 \strokec8 0\cf0 \strokec4 , phase: \cf8 \strokec8 0\cf0 \strokec4 , dryerBought: \cf2 \strokec2 false\cf0 \strokec4  \}; f.scene5Correct = \cf2 \strokec2 false\cf0 \strokec4 ; \cf2 \strokec2 break\cf0 \strokec4 ;\cb1 \
\cb3             \cf2 \strokec2 case\cf0 \strokec4  \cf5 \strokec5 STATE\cf0 \strokec4 .\cf5 \strokec5 SCENE_6_PHOTO\cf0 \strokec4 : s.photo = \{ timer: \cf8 \strokec8 0\cf0 \strokec4 , count: \cf8 \strokec8 0\cf0 \strokec4 , phase: \cf8 \strokec8 0\cf0 \strokec4 , flash: \cf8 \strokec8 0\cf0 \strokec4  \}; f.scene6Correct = \cf2 \strokec2 false\cf0 \strokec4 ; f.failReason = \cf8 \strokec8 0\cf0 \strokec4 ; \cf2 \strokec2 break\cf0 \strokec4 ;\cb1 \
\cb3             \cf2 \strokec2 case\cf0 \strokec4  \cf5 \strokec5 STATE\cf0 \strokec4 .\cf5 \strokec5 SCENE_7_SKINCARE\cf0 \strokec4 : s.skin = \{ timer: \cf8 \strokec8 0\cf0 \strokec4 , phase: \cf8 \strokec8 0\cf0 \strokec4 , newBottleShown: \cf2 \strokec2 false\cf0 \strokec4  \}; f.scene7Correct = \cf2 \strokec2 false\cf0 \strokec4 ; \cf2 \strokec2 break\cf0 \strokec4 ;\cb1 \
\cb3             \cf2 \strokec2 default\cf0 \strokec4 : \cf2 \strokec2 break\cf0 \strokec4 ;\cb1 \
\cb3         \}\cb1 \
\cb3       \});\cb1 \
\cb3     \};\cb1 \
\
\cb3     \cf2 \strokec2 const\cf0 \strokec4  drawRect = (x, y, w, h, color, radius = \cf8 \strokec8 0\cf0 \strokec4 ) => \{\cb1 \
\cb3       ctx.fillStyle = color; ctx.beginPath();\cb1 \
\cb3       \cf2 \strokec2 if\cf0 \strokec4  (ctx.roundRect) ctx.roundRect(x, y, w, h, radius); \cf2 \strokec2 else\cf0 \strokec4  ctx.rect(x, y, w, h);\cb1 \
\cb3       ctx.fill();\cb1 \
\cb3     \};\cb1 \
\
\cb3     \cf2 \strokec2 const\cf0 \strokec4  drawCircle = (x, y, r, color) => \{\cb1 \
\cb3       ctx.fillStyle = color; ctx.beginPath(); ctx.arc(x, y, r, \cf8 \strokec8 0\cf0 \strokec4 , \cf5 \strokec5 Math\cf0 \strokec4 .\cf5 \strokec5 PI\cf0 \strokec4  * \cf8 \strokec8 2\cf0 \strokec4 ); ctx.fill();\cb1 \
\cb3     \};\cb1 \
\
\cb3     \cf2 \strokec2 const\cf0 \strokec4  drawText = (text, x, y, size, color = \cf5 \strokec5 COLORS\cf0 \strokec4 .text, align = \cf6 \strokec6 'center'\cf0 \strokec4 , fontName = \cf6 \strokec6 '"ZCOOL KuaiLe", sans-serif'\cf0 \strokec4 ) => \{\cb1 \
\cb3       ctx.fillStyle = color; ctx.font = \cf6 \strokec6 `\cf0 \strokec4 $\{size\}\cf6 \strokec6 px \cf0 \strokec4 $\{fontName\}\cf6 \strokec6 `\cf0 \strokec4 ; ctx.textAlign = align; \cb1 \
\cb3       ctx.textBaseline = \cf6 \strokec6 'middle'\cf0 \strokec4 ; ctx.fillText(text, x, y); ctx.textBaseline = \cf6 \strokec6 'alphabetic'\cf0 \strokec4 ; \cb1 \
\cb3     \};\cb1 \
\
\cb3     \cf2 \strokec2 const\cf0 \strokec4  drawParagraph = (text, x, y, maxWidth, lineHeight, fontSize, color = \cf5 \strokec5 COLORS\cf0 \strokec4 .text, align = \cf6 \strokec6 'left'\cf0 \strokec4 ) => \{\cb1 \
\cb3         ctx.fillStyle = color; ctx.font = \cf6 \strokec6 `\cf0 \strokec4 $\{fontSize\}\cf6 \strokec6 px "ZCOOL KuaiLe", sans-serif`\cf0 \strokec4 ; ctx.textAlign = align;\cb1 \
\cb3         \cf2 \strokec2 let\cf0 \strokec4  words = text.split(\cf6 \strokec6 ''\cf0 \strokec4 ); \cf2 \strokec2 let\cf0 \strokec4  line = \cf6 \strokec6 ''\cf0 \strokec4 ; \cf2 \strokec2 let\cf0 \strokec4  currentY = y;\cb1 \
\cb3         \cf2 \strokec2 for\cf0 \strokec4 (\cf2 \strokec2 let\cf0 \strokec4  n = \cf8 \strokec8 0\cf0 \strokec4 ; n < words.length; n++) \{\cb1 \
\cb3           \cf2 \strokec2 let\cf0 \strokec4  testLine = line + words[n]; \cf2 \strokec2 let\cf0 \strokec4  metrics = ctx.measureText(testLine);\cb1 \
\cb3           \cf2 \strokec2 if\cf0 \strokec4  (metrics.width > maxWidth && n > \cf8 \strokec8 0\cf0 \strokec4 ) \{ ctx.fillText(line, x, currentY); line = words[n]; currentY += lineHeight; \}\cb1 \
\cb3           \cf2 \strokec2 else\cf0 \strokec4  \{ line = testLine; \}\cb1 \
\cb3         \}\cb1 \
\cb3         ctx.fillText(line, x, currentY);\cb1 \
\cb3     \};\cb1 \
\
\cb3     \cf2 \strokec2 const\cf0 \strokec4  isHover = (x, y, w, h) => \{\cb1 \
\cb3       \cf2 \strokec2 const\cf0 \strokec4  mx = gameState.current.mouse.x; \cf2 \strokec2 const\cf0 \strokec4  my = gameState.current.mouse.y;\cb1 \
\cb3       \cf2 \strokec2 return\cf0 \strokec4  mx > x && mx < x + w && my > y && my < y + h;\cb1 \
\cb3     \};\cb1 \
\
\cb3     \cf2 \strokec2 const\cf0 \strokec4  drawButton = (text, x, y, w, h, callback, btnColor = \cf5 \strokec5 COLORS\cf0 \strokec4 .primary) => \{\cb1 \
\cb3       \cf2 \strokec2 if\cf0 \strokec4  (gameState.current.transition.active) \cf2 \strokec2 return\cf0 \strokec4 ;\cb1 \
\cb3       \cf2 \strokec2 const\cf0 \strokec4  hover = isHover(x, y, w, h);\cb1 \
\cb3       ctx.shadowBlur = hover ? \cf8 \strokec8 10\cf0 \strokec4  : \cf8 \strokec8 0\cf0 \strokec4 ; ctx.shadowColor = btnColor;\cb1 \
\cb3       ctx.fillStyle = hover ? btnColor : \cf6 \strokec6 '#fff'\cf0 \strokec4 ; ctx.strokeStyle = btnColor; ctx.lineWidth = \cf8 \strokec8 3\cf0 \strokec4 ;\cb1 \
\cb3       ctx.beginPath(); \cf2 \strokec2 if\cf0 \strokec4  (ctx.roundRect) ctx.roundRect(x, y, w, h, \cf8 \strokec8 20\cf0 \strokec4 ); \cf2 \strokec2 else\cf0 \strokec4  ctx.rect(x, y, w, h);\cb1 \
\cb3       ctx.fill(); ctx.stroke(); ctx.shadowBlur = \cf8 \strokec8 0\cf0 \strokec4 ;\cb1 \
\cb3       \cf2 \strokec2 let\cf0 \strokec4  fontSize = \cf8 \strokec8 18\cf0 \strokec4 ; \cf2 \strokec2 if\cf0 \strokec4  (text.length > \cf8 \strokec8 10\cf0 \strokec4 ) fontSize = \cf8 \strokec8 16\cf0 \strokec4 ; \cf2 \strokec2 if\cf0 \strokec4  (text.length > \cf8 \strokec8 14\cf0 \strokec4 ) fontSize = \cf8 \strokec8 14\cf0 \strokec4 ; \cf2 \strokec2 if\cf0 \strokec4  (text.length > \cf8 \strokec8 18\cf0 \strokec4 ) fontSize = \cf8 \strokec8 12\cf0 \strokec4 ; \cb1 \
\cb3       ctx.font = \cf6 \strokec6 `\cf0 \strokec4 $\{fontSize\}\cf6 \strokec6 px "ZCOOL KuaiLe", sans-serif`\cf0 \strokec4 ; ctx.textAlign = \cf6 \strokec6 'center'\cf0 \strokec4 ; ctx.fillStyle = hover ? \cf6 \strokec6 '#fff'\cf0 \strokec4  : btnColor;\cb1 \
\cb3       ctx.fillText(text, x + w/\cf8 \strokec8 2\cf0 \strokec4 , y + h/\cf8 \strokec8 2\cf0 \strokec4  + fontSize/\cf8 \strokec8 3\cf0 \strokec4 );\cb1 \
\cb3       \cf2 \strokec2 if\cf0 \strokec4  (hover && gameState.current.mouse.clicked) \{ gameState.current.mouse.clicked = \cf2 \strokec2 false\cf0 \strokec4 ; callback(); \}\cb1 \
\cb3     \};\cb1 \
\
\cb3     \cf7 \strokec7 // \uc0\u35843 \u25972 \u65306 \u25171 \u23383 \u36895 \u24230  5 (\u20013 \u31561 \u65292 \u33298 \u36866 )\cf0 \cb1 \strokec4 \
\cb3     \cf2 \strokec2 const\cf0 \strokec4  typeText = (str, speed = \cf8 \strokec8 5\cf0 \strokec4 ) => \{\cb1 \
\cb3       \cf2 \strokec2 const\cf0 \strokec4  s = gameState.current; \cf2 \strokec2 const\cf0 \strokec4  typer = s.textTyper;\cb1 \
\cb3       \cf2 \strokec2 if\cf0 \strokec4  (typer.text !== str) \{ typer.text = str; typer.index = \cf8 \strokec8 0\cf0 \strokec4 ; typer.complete = \cf2 \strokec2 false\cf0 \strokec4 ; \}\cb1 \
\cb3       \cf2 \strokec2 if\cf0 \strokec4  (!typer.complete) \{\cb1 \
\cb3         \cf2 \strokec2 if\cf0 \strokec4  (s.frameCount % speed === \cf8 \strokec8 0\cf0 \strokec4 ) \{ typer.index++; \}\cb1 \
\cb3         \cf2 \strokec2 if\cf0 \strokec4  (typer.index >= str.length) \{ typer.complete = \cf2 \strokec2 true\cf0 \strokec4 ; \}\cb1 \
\cb3       \}\cb1 \
\cb3       \cf2 \strokec2 return\cf0 \strokec4  str.substring(\cf8 \strokec8 0\cf0 \strokec4 , typer.index);\cb1 \
\cb3     \};\cb1 \
\
\cb3     \cf2 \strokec2 const\cf0 \strokec4  drawSnowflake = (x, y, size, color) => \{\cb1 \
\cb3       ctx.save(); ctx.translate(x, y); ctx.strokeStyle = color; ctx.lineWidth = size / \cf8 \strokec8 10\cf0 \strokec4 ; ctx.lineCap = \cf6 \strokec6 'round'\cf0 \strokec4 ;\cb1 \
\cb3       \cf2 \strokec2 for\cf0 \strokec4  (\cf2 \strokec2 let\cf0 \strokec4  i = \cf8 \strokec8 0\cf0 \strokec4 ; i < \cf8 \strokec8 6\cf0 \strokec4 ; i++) \{\cb1 \
\cb3         ctx.beginPath(); ctx.moveTo(\cf8 \strokec8 0\cf0 \strokec4 , \cf8 \strokec8 0\cf0 \strokec4 ); ctx.lineTo(\cf8 \strokec8 0\cf0 \strokec4 , -size / \cf8 \strokec8 2\cf0 \strokec4 ); ctx.stroke();\cb1 \
\cb3         ctx.beginPath(); ctx.moveTo(\cf8 \strokec8 0\cf0 \strokec4 , -size / \cf8 \strokec8 4\cf0 \strokec4 ); ctx.lineTo(-size / \cf8 \strokec8 8\cf0 \strokec4 , -size / \cf8 \strokec8 2.5\cf0 \strokec4 ); ctx.stroke();\cb1 \
\cb3         ctx.beginPath(); ctx.moveTo(\cf8 \strokec8 0\cf0 \strokec4 , -size / \cf8 \strokec8 4\cf0 \strokec4 ); ctx.lineTo(size / \cf8 \strokec8 8\cf0 \strokec4 , -size / \cf8 \strokec8 2.5\cf0 \strokec4 ); ctx.stroke();\cb1 \
\cb3         ctx.rotate(\cf5 \strokec5 Math\cf0 \strokec4 .\cf5 \strokec5 PI\cf0 \strokec4  / \cf8 \strokec8 3\cf0 \strokec4 );\cb1 \
\cb3       \}\cb1 \
\cb3       ctx.restore();\cb1 \
\cb3     \};\cb1 \
\
\cb3     \cf2 \strokec2 const\cf0 \strokec4  drawBean = (x, y, isGirl = \cf2 \strokec2 false\cf0 \strokec4 , emotion = \cf6 \strokec6 'normal'\cf0 \strokec4 , scale = \cf8 \strokec8 1\cf0 \strokec4 ) => \{\cb1 \
\cb3       ctx.save(); ctx.translate(x, y); ctx.scale(scale, scale);\cb1 \
\cb3       \cf2 \strokec2 if\cf0 \strokec4  (isGirl) \{\cb1 \
\cb3         ctx.fillStyle = \cf6 \strokec6 '#333'\cf0 \strokec4 ; ctx.beginPath();\cb1 \
\cb3         ctx.moveTo(-\cf8 \strokec8 28\cf0 \strokec4 , -\cf8 \strokec8 15\cf0 \strokec4 ); ctx.quadraticCurveTo(-\cf8 \strokec8 50\cf0 \strokec4 , \cf8 \strokec8 5\cf0 \strokec4 , -\cf8 \strokec8 45\cf0 \strokec4 , \cf8 \strokec8 65\cf0 \strokec4 ); ctx.quadraticCurveTo(-\cf8 \strokec8 40\cf0 \strokec4 , \cf8 \strokec8 85\cf0 \strokec4 , -\cf8 \strokec8 20\cf0 \strokec4 , \cf8 \strokec8 75\cf0 \strokec4 ); ctx.quadraticCurveTo(-\cf8 \strokec8 30\cf0 \strokec4 , \cf8 \strokec8 45\cf0 \strokec4 , -\cf8 \strokec8 22\cf0 \strokec4 , \cf8 \strokec8 5\cf0 \strokec4 );\cb1 \
\cb3         ctx.moveTo(\cf8 \strokec8 28\cf0 \strokec4 , -\cf8 \strokec8 15\cf0 \strokec4 ); ctx.quadraticCurveTo(\cf8 \strokec8 50\cf0 \strokec4 , \cf8 \strokec8 5\cf0 \strokec4 , \cf8 \strokec8 45\cf0 \strokec4 , \cf8 \strokec8 65\cf0 \strokec4 ); ctx.quadraticCurveTo(\cf8 \strokec8 40\cf0 \strokec4 , \cf8 \strokec8 85\cf0 \strokec4 , \cf8 \strokec8 20\cf0 \strokec4 , \cf8 \strokec8 75\cf0 \strokec4 ); ctx.quadraticCurveTo(\cf8 \strokec8 30\cf0 \strokec4 , \cf8 \strokec8 45\cf0 \strokec4 , \cf8 \strokec8 22\cf0 \strokec4 , \cf8 \strokec8 5\cf0 \strokec4 );\cb1 \
\cb3         ctx.moveTo(-\cf8 \strokec8 28\cf0 \strokec4 , -\cf8 \strokec8 15\cf0 \strokec4 ); ctx.quadraticCurveTo(\cf8 \strokec8 0\cf0 \strokec4 , -\cf8 \strokec8 50\cf0 \strokec4 , \cf8 \strokec8 28\cf0 \strokec4 , -\cf8 \strokec8 15\cf0 \strokec4 ); ctx.fill();\cb1 \
\cb3       \}\cb1 \
\cb3       ctx.fillStyle = \cf6 \strokec6 '#fff'\cf0 \strokec4 ; ctx.strokeStyle = \cf6 \strokec6 '#333'\cf0 \strokec4 ; ctx.lineWidth = \cf8 \strokec8 3\cf0 \strokec4 ; ctx.beginPath(); ctx.ellipse(\cf8 \strokec8 0\cf0 \strokec4 , \cf8 \strokec8 0\cf0 \strokec4 , \cf8 \strokec8 35\cf0 \strokec4 , \cf8 \strokec8 45\cf0 \strokec4 , \cf8 \strokec8 0\cf0 \strokec4 , \cf8 \strokec8 0\cf0 \strokec4 , \cf5 \strokec5 Math\cf0 \strokec4 .\cf5 \strokec5 PI\cf0 \strokec4  * \cf8 \strokec8 2\cf0 \strokec4 ); ctx.fill(); ctx.stroke();\cb1 \
\cb3       ctx.fillStyle = \cf6 \strokec6 '#333'\cf0 \strokec4 ;\cb1 \
\cb3       \cf2 \strokec2 if\cf0 \strokec4  (emotion === \cf6 \strokec6 'happy'\cf0 \strokec4 ) \{ ctx.beginPath(); ctx.moveTo(-\cf8 \strokec8 12\cf0 \strokec4 , -\cf8 \strokec8 5\cf0 \strokec4 ); ctx.lineTo(-\cf8 \strokec8 5\cf0 \strokec4 , -\cf8 \strokec8 12\cf0 \strokec4 ); ctx.lineTo(\cf8 \strokec8 2\cf0 \strokec4 , -\cf8 \strokec8 5\cf0 \strokec4 ); ctx.moveTo(\cf8 \strokec8 12\cf0 \strokec4 , -\cf8 \strokec8 5\cf0 \strokec4 ); ctx.lineTo(\cf8 \strokec8 19\cf0 \strokec4 , -\cf8 \strokec8 12\cf0 \strokec4 ); ctx.lineTo(\cf8 \strokec8 26\cf0 \strokec4 , -\cf8 \strokec8 5\cf0 \strokec4 ); ctx.stroke(); \}\cb1 \
\cb3       \cf2 \strokec2 else\cf0 \strokec4  \{ drawCircle(-\cf8 \strokec8 12\cf0 \strokec4 , -\cf8 \strokec8 8\cf0 \strokec4 , \cf8 \strokec8 3\cf0 \strokec4 , \cf6 \strokec6 '#333'\cf0 \strokec4 ); drawCircle(\cf8 \strokec8 12\cf0 \strokec4 , -\cf8 \strokec8 8\cf0 \strokec4 , \cf8 \strokec8 3\cf0 \strokec4 , \cf6 \strokec6 '#333'\cf0 \strokec4 ); \}\cb1 \
\cb3       \cf2 \strokec2 if\cf0 \strokec4  (isGirl || emotion === \cf6 \strokec6 'shy'\cf0 \strokec4 ) \{ ctx.fillStyle = \cf6 \strokec6 '#ffb7c5'\cf0 \strokec4 ; ctx.globalAlpha = \cf8 \strokec8 0.6\cf0 \strokec4 ; ctx.beginPath(); ctx.arc(-\cf8 \strokec8 18\cf0 \strokec4 , \cf8 \strokec8 5\cf0 \strokec4 , \cf8 \strokec8 5\cf0 \strokec4 , \cf8 \strokec8 0\cf0 \strokec4 , \cf5 \strokec5 Math\cf0 \strokec4 .\cf5 \strokec5 PI\cf0 \strokec4 *\cf8 \strokec8 2\cf0 \strokec4 ); ctx.fill(); ctx.beginPath(); ctx.arc(\cf8 \strokec8 18\cf0 \strokec4 , \cf8 \strokec8 5\cf0 \strokec4 , \cf8 \strokec8 5\cf0 \strokec4 , \cf8 \strokec8 0\cf0 \strokec4 , \cf5 \strokec5 Math\cf0 \strokec4 .\cf5 \strokec5 PI\cf0 \strokec4 *\cf8 \strokec8 2\cf0 \strokec4 ); ctx.fill(); ctx.globalAlpha = \cf8 \strokec8 1.0\cf0 \strokec4 ; \}\cb1 \
\cb3       \cf2 \strokec2 if\cf0 \strokec4  (isGirl) \{ ctx.fillStyle = \cf6 \strokec6 '#333'\cf0 \strokec4 ; ctx.beginPath(); ctx.arc(\cf8 \strokec8 0\cf0 \strokec4 , -\cf8 \strokec8 10\cf0 \strokec4 , \cf8 \strokec8 34\cf0 \strokec4 , \cf5 \strokec5 Math\cf0 \strokec4 .\cf5 \strokec5 PI\cf0 \strokec4  * \cf8 \strokec8 1.1\cf0 \strokec4 , \cf5 \strokec5 Math\cf0 \strokec4 .\cf5 \strokec5 PI\cf0 \strokec4  * \cf8 \strokec8 1.9\cf0 \strokec4 ); ctx.fill(); \}\cb1 \
\cb3       ctx.restore();\cb1 \
\cb3     \};\cb1 \
\
\cb3     \cf2 \strokec2 const\cf0 \strokec4  drawIcon = (\cf2 \strokec2 type\cf0 \strokec4 , x, y, size, color) => \{\cb1 \
\cb3       ctx.save(); ctx.translate(x, y); ctx.strokeStyle = color; ctx.fillStyle = color; ctx.lineWidth = \cf8 \strokec8 2\cf0 \strokec4 ; ctx.lineCap = \cf6 \strokec6 'round'\cf0 \strokec4 ; ctx.lineJoin = \cf6 \strokec6 'round'\cf0 \strokec4 ;\cb1 \
\cb3       \cf2 \strokec2 if\cf0 \strokec4  (\cf2 \strokec2 type\cf0 \strokec4  === \cf6 \strokec6 'back'\cf0 \strokec4 ) \{ ctx.beginPath(); ctx.moveTo(size/\cf8 \strokec8 2\cf0 \strokec4 , -size/\cf8 \strokec8 2\cf0 \strokec4 ); ctx.lineTo(-size/\cf8 \strokec8 2\cf0 \strokec4 , \cf8 \strokec8 0\cf0 \strokec4 ); ctx.lineTo(size/\cf8 \strokec8 2\cf0 \strokec4 , size/\cf8 \strokec8 2\cf0 \strokec4 ); ctx.stroke(); \}\cb1 \
\cb3       \cf2 \strokec2 else\cf0 \strokec4  \cf2 \strokec2 if\cf0 \strokec4  (\cf2 \strokec2 type\cf0 \strokec4  === \cf6 \strokec6 'more'\cf0 \strokec4 ) \{ ctx.beginPath(); ctx.arc(-size/\cf8 \strokec8 3\cf0 \strokec4 , \cf8 \strokec8 0\cf0 \strokec4 , \cf8 \strokec8 2\cf0 \strokec4 , \cf8 \strokec8 0\cf0 \strokec4 , \cf5 \strokec5 Math\cf0 \strokec4 .\cf5 \strokec5 PI\cf0 \strokec4 *\cf8 \strokec8 2\cf0 \strokec4 ); ctx.fill(); ctx.beginPath(); ctx.arc(\cf8 \strokec8 0\cf0 \strokec4 , \cf8 \strokec8 0\cf0 \strokec4 , \cf8 \strokec8 2\cf0 \strokec4 , \cf8 \strokec8 0\cf0 \strokec4 , \cf5 \strokec5 Math\cf0 \strokec4 .\cf5 \strokec5 PI\cf0 \strokec4 *\cf8 \strokec8 2\cf0 \strokec4 ); ctx.fill(); ctx.beginPath(); ctx.arc(size/\cf8 \strokec8 3\cf0 \strokec4 , \cf8 \strokec8 0\cf0 \strokec4 , \cf8 \strokec8 2\cf0 \strokec4 , \cf8 \strokec8 0\cf0 \strokec4 , \cf5 \strokec5 Math\cf0 \strokec4 .\cf5 \strokec5 PI\cf0 \strokec4 *\cf8 \strokec8 2\cf0 \strokec4 ); ctx.fill(); \}\cb1 \
\cb3       ctx.restore();\cb1 \
\cb3     \};\cb1 \
\
\cb3     \cf2 \strokec2 const\cf0 \strokec4  drawChatBubble = (x, y, text, isMe) => \{\cb1 \
\cb3       ctx.font = \cf6 \strokec6 `16px "ZCOOL KuaiLe", sans-serif`\cf0 \strokec4 ; \cf2 \strokec2 const\cf0 \strokec4  maxWidth = \cf8 \strokec8 240\cf0 \strokec4 ; \cf2 \strokec2 const\cf0 \strokec4  lineHeight = \cf8 \strokec8 24\cf0 \strokec4 ; \cf2 \strokec2 const\cf0 \strokec4  padding = \cf8 \strokec8 12\cf0 \strokec4 ;\cb1 \
\cb3       \cf2 \strokec2 let\cf0 \strokec4  lines = []; \cf2 \strokec2 let\cf0 \strokec4  line = \cf6 \strokec6 ''\cf0 \strokec4 ;\cb1 \
\cb3       \cf2 \strokec2 for\cf0 \strokec4  (\cf2 \strokec2 let\cf0 \strokec4  i = \cf8 \strokec8 0\cf0 \strokec4 ; i < text.length; i++) \{\cb1 \
\cb3         \cf2 \strokec2 let\cf0 \strokec4  testLine = line + text[i]; \cf2 \strokec2 let\cf0 \strokec4  metrics = ctx.measureText(testLine);\cb1 \
\cb3         \cf2 \strokec2 if\cf0 \strokec4  (metrics.width > maxWidth && i > \cf8 \strokec8 0\cf0 \strokec4 ) \{ lines.push(line); line = text[i]; \} \cf2 \strokec2 else\cf0 \strokec4  \{ line = testLine; \}\cb1 \
\cb3       \}\cb1 \
\cb3       lines.push(line);\cb1 \
\cb3       \cf2 \strokec2 const\cf0 \strokec4  w = \cf5 \strokec5 Math\cf0 \strokec4 .max(...lines.map(l => ctx.measureText(l).width)) + padding * \cf8 \strokec8 2\cf0 \strokec4 ;\cb1 \
\cb3       \cf2 \strokec2 const\cf0 \strokec4  h = lines.length * lineHeight + padding + \cf8 \strokec8 5\cf0 \strokec4 ; \cb1 \
\cb3       \cf2 \strokec2 const\cf0 \strokec4  bx = isMe ? x - w : x; \cf2 \strokec2 const\cf0 \strokec4  bgColor = isMe ? \cf5 \strokec5 COLORS\cf0 \strokec4 .bubble_me : \cf6 \strokec6 '#fff'\cf0 \strokec4 ; \cf2 \strokec2 const\cf0 \strokec4  textColor = isMe ? \cf6 \strokec6 '#fff'\cf0 \strokec4  : \cf6 \strokec6 '#333'\cf0 \strokec4 ;\cb1 \
\cb3       drawRect(bx, y, w, h, bgColor, \cf8 \strokec8 10\cf0 \strokec4 );\cb1 \
\cb3       ctx.beginPath();\cb1 \
\cb3       \cf2 \strokec2 if\cf0 \strokec4  (isMe) \{ ctx.moveTo(bx + w, y + \cf8 \strokec8 10\cf0 \strokec4 ); ctx.lineTo(bx + w + \cf8 \strokec8 5\cf0 \strokec4 , y + \cf8 \strokec8 10\cf0 \strokec4 ); ctx.lineTo(bx + w, y + \cf8 \strokec8 15\cf0 \strokec4 ); \} \cf2 \strokec2 else\cf0 \strokec4  \{ ctx.moveTo(bx, y + \cf8 \strokec8 10\cf0 \strokec4 ); ctx.lineTo(bx - \cf8 \strokec8 5\cf0 \strokec4 , y + \cf8 \strokec8 10\cf0 \strokec4 ); ctx.lineTo(bx, y + \cf8 \strokec8 15\cf0 \strokec4 ); \}\cb1 \
\cb3       ctx.fillStyle = bgColor; ctx.fill();\cb1 \
\cb3       \cf2 \strokec2 if\cf0 \strokec4  (!isMe) \{ ctx.strokeStyle = \cf6 \strokec6 '#eee'\cf0 \strokec4 ; ctx.strokeRect(bx, y, w, h); \}\cb1 \
\cb3       ctx.fillStyle = textColor; ctx.textAlign = \cf6 \strokec6 'left'\cf0 \strokec4 ; ctx.textBaseline = \cf6 \strokec6 'middle'\cf0 \strokec4 ;\cb1 \
\cb3       lines.forEach((l, i) => \{ ctx.fillText(l, bx + padding, y + padding + i * lineHeight + \cf8 \strokec8 6\cf0 \strokec4 ); \});\cb1 \
\cb3       ctx.textBaseline = \cf6 \strokec6 'alphabetic'\cf0 \strokec4 ; \cb1 \
\cb3       \cf2 \strokec2 return\cf0 \strokec4  h; \cb1 \
\cb3     \};\cb1 \
\
\cb3     \cf7 \strokec7 // ==================== \uc0\u22330 \u26223 \u26356 \u26032  ====================\cf0 \cb1 \strokec4 \
\
\cb3     \cf2 \strokec2 const\cf0 \strokec4  updateMenu = () => \{\cb1 \
\cb3       \cf2 \strokec2 const\cf0 \strokec4  s = gameState.current;\cb1 \
\cb3       ctx.fillStyle = \cf5 \strokec5 COLORS\cf0 \strokec4 .bg; ctx.fillRect(\cf8 \strokec8 0\cf0 \strokec4 , \cf8 \strokec8 0\cf0 \strokec4 , \cf5 \strokec5 LOGIC_W\cf0 \strokec4 , \cf5 \strokec5 LOGIC_H\cf0 \strokec4 );\cb1 \
\cb3       drawText(\cf6 \strokec6 "\uc0\u24651 \u38634 "\cf0 \strokec4 , \cf5 \strokec5 LOGIC_W\cf0 \strokec4  / \cf8 \strokec8 2\cf0 \strokec4 , \cf8 \strokec8 250\cf0 \strokec4 , \cf8 \strokec8 80\cf0 \strokec4 , \cf5 \strokec5 COLORS\cf0 \strokec4 .primary);\cb1 \
\cb3       drawText(\cf6 \strokec6 "\uc0\u20271 \u29273 \u30340 \u24651 \u29233 \u22823 \u20882 \u38505 "\cf0 \strokec4 , \cf5 \strokec5 LOGIC_W\cf0 \strokec4  / \cf8 \strokec8 2\cf0 \strokec4 , \cf8 \strokec8 320\cf0 \strokec4 , \cf8 \strokec8 24\cf0 \strokec4 , \cf6 \strokec6 "#aaa"\cf0 \strokec4 );\cb1 \
\cb3       \cf2 \strokec2 const\cf0 \strokec4  scale = \cf8 \strokec8 1\cf0 \strokec4  + \cf5 \strokec5 Math\cf0 \strokec4 .sin(s.frameCount * \cf8 \strokec8 0.05\cf0 \strokec4 ) * \cf8 \strokec8 0.05\cf0 \strokec4 ;\cb1 \
\cb3       ctx.save(); ctx.translate(\cf5 \strokec5 LOGIC_W\cf0 \strokec4  / \cf8 \strokec8 2\cf0 \strokec4 , \cf8 \strokec8 150\cf0 \strokec4 ); ctx.scale(scale, scale); drawSnowflake(\cf8 \strokec8 0\cf0 \strokec4 , \cf8 \strokec8 0\cf0 \strokec4 , \cf8 \strokec8 80\cf0 \strokec4 , \cf5 \strokec5 COLORS\cf0 \strokec4 .primary); ctx.restore();\cb1 \
\cb3       drawButton(\cf6 \strokec6 "\uc0\u24320 \u22987 \u25925 \u20107 "\cf0 \strokec4 , (\cf5 \strokec5 LOGIC_W\cf0 \strokec4  - \cf8 \strokec8 200\cf0 \strokec4 ) / \cf8 \strokec8 2\cf0 \strokec4 , \cf8 \strokec8 550\cf0 \strokec4 , \cf8 \strokec8 200\cf0 \strokec4 , \cf8 \strokec8 60\cf0 \strokec4 , () => \{ resetGame(); transitionTo(\cf5 \strokec5 STATE\cf0 \strokec4 .\cf5 \strokec5 SCENE_1_NOTIFICATION\cf0 \strokec4 ); \}); \cb1 \
\cb3     \};\cb1 \
\
\cb3     \cf2 \strokec2 const\cf0 \strokec4  drawLockScreen = (yOffset) => \{\cb1 \
\cb3         \cf2 \strokec2 const\cf0 \strokec4  s = gameState.current;\cb1 \
\cb3         \cf2 \strokec2 const\cf0 \strokec4  grad = ctx.createLinearGradient(\cf8 \strokec8 0\cf0 \strokec4 , yOffset, \cf8 \strokec8 0\cf0 \strokec4 , \cf5 \strokec5 LOGIC_H\cf0 \strokec4  + yOffset); \cb1 \
\cb3         grad.addColorStop(\cf8 \strokec8 0\cf0 \strokec4 , \cf6 \strokec6 '#2c3e50'\cf0 \strokec4 ); grad.addColorStop(\cf8 \strokec8 1\cf0 \strokec4 , \cf6 \strokec6 '#4ca1af'\cf0 \strokec4 );\cb1 \
\cb3         ctx.fillStyle = grad; ctx.fillRect(\cf8 \strokec8 0\cf0 \strokec4 , yOffset, \cf5 \strokec5 LOGIC_W\cf0 \strokec4 , \cf5 \strokec5 LOGIC_H\cf0 \strokec4 );\cb1 \
\cb3         drawText(\cf6 \strokec6 "20:30"\cf0 \strokec4 , \cf5 \strokec5 LOGIC_W\cf0 \strokec4  / \cf8 \strokec8 2\cf0 \strokec4 , \cf8 \strokec8 150\cf0 \strokec4  + yOffset, \cf8 \strokec8 60\cf0 \strokec4 , \cf6 \strokec6 '#fff'\cf0 \strokec4 , \cf6 \strokec6 'center'\cf0 \strokec4 , \cf6 \strokec6 'Arial'\cf0 \strokec4 );\cb1 \
\cb3         drawText(\cf6 \strokec6 "11\uc0\u26376 14\u26085  \u26143 \u26399 \u20108 "\cf0 \strokec4 , \cf5 \strokec5 LOGIC_W\cf0 \strokec4  / \cf8 \strokec8 2\cf0 \strokec4 , \cf8 \strokec8 200\cf0 \strokec4  + yOffset, \cf8 \strokec8 20\cf0 \strokec4 , \cf6 \strokec6 '#fff'\cf0 \strokec4 , \cf6 \strokec6 'center'\cf0 \strokec4 , \cf6 \strokec6 'Arial'\cf0 \strokec4 );\cb1 \
\cb3         \cf2 \strokec2 const\cf0 \strokec4  lockY = \cf8 \strokec8 50\cf0 \strokec4  + yOffset;\cb1 \
\cb3         ctx.strokeStyle = \cf6 \strokec6 '#fff'\cf0 \strokec4 ; ctx.lineWidth = \cf8 \strokec8 3\cf0 \strokec4 ;\cb1 \
\cb3         \cf2 \strokec2 if\cf0 \strokec4  (s.notification.phase === \cf8 \strokec8 1\cf0 \strokec4 ) \{\cb1 \
\cb3              ctx.save(); ctx.translate(\cf5 \strokec5 LOGIC_W\cf0 \strokec4 /\cf8 \strokec8 2\cf0 \strokec4 , lockY); ctx.rotate(s.frameCount * \cf8 \strokec8 0.2\cf0 \strokec4 ); ctx.beginPath(); ctx.arc(\cf8 \strokec8 0\cf0 \strokec4 , \cf8 \strokec8 0\cf0 \strokec4 , \cf8 \strokec8 10\cf0 \strokec4 , \cf8 \strokec8 0\cf0 \strokec4 , \cf5 \strokec5 Math\cf0 \strokec4 .\cf5 \strokec5 PI\cf0 \strokec4 *\cf8 \strokec8 2\cf0 \strokec4 ); ctx.stroke(); ctx.restore();\cb1 \
\cb3         \} \cf2 \strokec2 else\cf0 \strokec4  \cf2 \strokec2 if\cf0 \strokec4  (s.notification.phase >= \cf8 \strokec8 2\cf0 \strokec4 ) \{\cb1 \
\cb3             ctx.save(); ctx.translate(\cf5 \strokec5 LOGIC_W\cf0 \strokec4 /\cf8 \strokec8 2\cf0 \strokec4 , lockY); ctx.fillStyle = \cf6 \strokec6 '#fff'\cf0 \strokec4 ; drawRect(-\cf8 \strokec8 8\cf0 \strokec4 , -\cf8 \strokec8 6\cf0 \strokec4 , \cf8 \strokec8 16\cf0 \strokec4 , \cf8 \strokec8 12\cf0 \strokec4 , \cf6 \strokec6 '#fff'\cf0 \strokec4 , \cf8 \strokec8 2\cf0 \strokec4 ); ctx.beginPath(); ctx.arc(\cf8 \strokec8 0\cf0 \strokec4 , -\cf8 \strokec8 6\cf0 \strokec4 , \cf8 \strokec8 5\cf0 \strokec4 , \cf5 \strokec5 Math\cf0 \strokec4 .\cf5 \strokec5 PI\cf0 \strokec4 , \cf8 \strokec8 0\cf0 \strokec4 ); ctx.stroke(); ctx.restore();\cb1 \
\cb3             drawText(\cf6 \strokec6 "\uc0\u38754 \u23481 ID\u24050 \u35299 \u38145 "\cf0 \strokec4 , \cf5 \strokec5 LOGIC_W\cf0 \strokec4 /\cf8 \strokec8 2\cf0 \strokec4 , lockY + \cf8 \strokec8 30\cf0 \strokec4 , \cf8 \strokec8 12\cf0 \strokec4 , \cf6 \strokec6 '#fff'\cf0 \strokec4 );\cb1 \
\cb3         \} \cf2 \strokec2 else\cf0 \strokec4  \{\cb1 \
\cb3             ctx.save(); ctx.translate(\cf5 \strokec5 LOGIC_W\cf0 \strokec4 /\cf8 \strokec8 2\cf0 \strokec4 , lockY); drawRect(-\cf8 \strokec8 8\cf0 \strokec4 , -\cf8 \strokec8 6\cf0 \strokec4 , \cf8 \strokec8 16\cf0 \strokec4 , \cf8 \strokec8 12\cf0 \strokec4 , \cf6 \strokec6 '#fff'\cf0 \strokec4 , \cf8 \strokec8 2\cf0 \strokec4 ); ctx.beginPath(); ctx.arc(\cf8 \strokec8 0\cf0 \strokec4 , -\cf8 \strokec8 6\cf0 \strokec4 , \cf8 \strokec8 5\cf0 \strokec4 , \cf5 \strokec5 Math\cf0 \strokec4 .\cf5 \strokec5 PI\cf0 \strokec4 , \cf8 \strokec8 0\cf0 \strokec4 ); ctx.stroke(); ctx.restore();\cb1 \
\cb3         \}\cb1 \
\cb3         \cf2 \strokec2 const\cf0 \strokec4  cardW = \cf8 \strokec8 380\cf0 \strokec4 , cardH = \cf8 \strokec8 80\cf0 \strokec4 , cardX = (\cf5 \strokec5 LOGIC_W\cf0 \strokec4  - cardW) / \cf8 \strokec8 2\cf0 \strokec4 , cardY = \cf8 \strokec8 300\cf0 \strokec4  + yOffset;\cb1 \
\cb3         ctx.shadowBlur = \cf8 \strokec8 10\cf0 \strokec4 ; ctx.shadowColor = \cf6 \strokec6 'rgba(0,0,0,0.3)'\cf0 \strokec4 ; drawRect(cardX, cardY, cardW, cardH, \cf6 \strokec6 'rgba(255,255,255,0.9)'\cf0 \strokec4 , \cf8 \strokec8 15\cf0 \strokec4 ); ctx.shadowBlur = \cf8 \strokec8 0\cf0 \strokec4 ;\cb1 \
\cb3         drawRect(cardX + \cf8 \strokec8 15\cf0 \strokec4 , cardY + \cf8 \strokec8 15\cf0 \strokec4 , \cf8 \strokec8 50\cf0 \strokec4 , \cf8 \strokec8 50\cf0 \strokec4 , \cf5 \strokec5 COLORS\cf0 \strokec4 .xhs_red, \cf8 \strokec8 10\cf0 \strokec4 ); drawText(\cf6 \strokec6 "\uc0\u20070 "\cf0 \strokec4 , cardX + \cf8 \strokec8 40\cf0 \strokec4 , cardY + \cf8 \strokec8 48\cf0 \strokec4 , \cf8 \strokec8 24\cf0 \strokec4 , \cf6 \strokec6 '#fff'\cf0 \strokec4 ); \cb1 \
\cb3         drawText(\cf6 \strokec6 "\uc0\u23567 \u32418 \u34223 "\cf0 \strokec4 , cardX + \cf8 \strokec8 80\cf0 \strokec4 , cardY + \cf8 \strokec8 30\cf0 \strokec4 , \cf8 \strokec8 14\cf0 \strokec4 , \cf6 \strokec6 '#666'\cf0 \strokec4 , \cf6 \strokec6 'left'\cf0 \strokec4 ); drawText(\cf6 \strokec6 "\uc0\u27224 \u29983 \u10024  \u20851 \u27880 \u20102 \u20320 "\cf0 \strokec4 , cardX + \cf8 \strokec8 80\cf0 \strokec4 , cardY + \cf8 \strokec8 55\cf0 \strokec4 , \cf8 \strokec8 16\cf0 \strokec4 , \cf6 \strokec6 '#333'\cf0 \strokec4 , \cf6 \strokec6 'left'\cf0 \strokec4 ); drawText(\cf6 \strokec6 "\uc0\u29616 \u22312 "\cf0 \strokec4 , cardX + cardW - \cf8 \strokec8 40\cf0 \strokec4 , cardY + \cf8 \strokec8 30\cf0 \strokec4 , \cf8 \strokec8 12\cf0 \strokec4 , \cf6 \strokec6 '#999'\cf0 \strokec4 );\cb1 \
\cb3         drawText(\cf6 \strokec6 "\uc0\u21521 \u19978 \u28369 \u21160 \u35299 \u38145 "\cf0 \strokec4 , \cf5 \strokec5 LOGIC_W\cf0 \strokec4 /\cf8 \strokec8 2\cf0 \strokec4 , \cf5 \strokec5 LOGIC_H\cf0 \strokec4  - \cf8 \strokec8 50\cf0 \strokec4  + yOffset, \cf8 \strokec8 14\cf0 \strokec4 , \cf6 \strokec6 '#fff'\cf0 \strokec4 ); drawRect(\cf5 \strokec5 LOGIC_W\cf0 \strokec4 /\cf8 \strokec8 2\cf0 \strokec4  - \cf8 \strokec8 70\cf0 \strokec4 , \cf5 \strokec5 LOGIC_H\cf0 \strokec4  - \cf8 \strokec8 30\cf0 \strokec4  + yOffset, \cf8 \strokec8 140\cf0 \strokec4 , \cf8 \strokec8 5\cf0 \strokec4 , \cf6 \strokec6 '#fff'\cf0 \strokec4 , \cf8 \strokec8 2\cf0 \strokec4 );\cb1 \
\cb3     \};\cb1 \
\
\cb3     \cf2 \strokec2 const\cf0 \strokec4  updateScene1Notification = () => \{\cb1 \
\cb3         \cf2 \strokec2 const\cf0 \strokec4  s = gameState.current;\cb1 \
\cb3         \cf2 \strokec2 if\cf0 \strokec4  (s.notification.phase === \cf8 \strokec8 0\cf0 \strokec4 ) \{ \cf2 \strokec2 if\cf0 \strokec4  (s.mouse.clicked) \{ s.mouse.clicked = \cf2 \strokec2 false\cf0 \strokec4 ; s.notification.phase = \cf8 \strokec8 1\cf0 \strokec4 ; s.notification.unlockTimer = \cf8 \strokec8 0\cf0 \strokec4 ; \} \} \cb1 \
\cb3         \cf2 \strokec2 else\cf0 \strokec4  \cf2 \strokec2 if\cf0 \strokec4  (s.notification.phase === \cf8 \strokec8 1\cf0 \strokec4 ) \{ s.notification.unlockTimer++; \cf2 \strokec2 if\cf0 \strokec4  (s.notification.unlockTimer > \cf8 \strokec8 40\cf0 \strokec4 ) \{ s.notification.phase = \cf8 \strokec8 2\cf0 \strokec4 ; s.notification.unlockTimer = \cf8 \strokec8 0\cf0 \strokec4 ; \} \} \cb1 \
\cb3         \cf2 \strokec2 else\cf0 \strokec4  \cf2 \strokec2 if\cf0 \strokec4  (s.notification.phase === \cf8 \strokec8 2\cf0 \strokec4 ) \{ s.notification.unlockTimer++; \cf2 \strokec2 if\cf0 \strokec4  (s.notification.unlockTimer > \cf8 \strokec8 40\cf0 \strokec4 ) \{ s.notification.phase = \cf8 \strokec8 3\cf0 \strokec4 ; \} \} \cb1 \
\cb3         \cf2 \strokec2 else\cf0 \strokec4  \cf2 \strokec2 if\cf0 \strokec4  (s.notification.phase === \cf8 \strokec8 3\cf0 \strokec4 ) \{ s.notification.slideY -= \cf8 \strokec8 25\cf0 \strokec4 ; \cf2 \strokec2 if\cf0 \strokec4  (s.notification.slideY <= -\cf5 \strokec5 LOGIC_H\cf0 \strokec4 ) \{ transitionTo(\cf5 \strokec5 STATE\cf0 \strokec4 .\cf5 \strokec5 SCENE_1_CHAT\cf0 \strokec4 , \cf2 \strokec2 true\cf0 \strokec4 ); \cf2 \strokec2 return\cf0 \strokec4 ; \} \}\cb1 \
\cb3         \cf2 \strokec2 if\cf0 \strokec4  (s.notification.phase === \cf8 \strokec8 3\cf0 \strokec4 ) \{ updateScene1(\cf2 \strokec2 false\cf0 \strokec4 ); drawLockScreen(s.notification.slideY); \} \cf2 \strokec2 else\cf0 \strokec4  \{ drawLockScreen(\cf8 \strokec8 0\cf0 \strokec4 ); \}\cb1 \
\cb3     \};\cb1 \
\
\cb3     \cf2 \strokec2 const\cf0 \strokec4  updateScene1 = (interactive = \cf2 \strokec2 true\cf0 \strokec4 ) => \{\cb1 \
\cb3         \cf2 \strokec2 const\cf0 \strokec4  s = gameState.current; \cf2 \strokec2 const\cf0 \strokec4  f = s.flags; \cf2 \strokec2 const\cf0 \strokec4  px = \cf8 \strokec8 250\cf0 \strokec4 , py = \cf8 \strokec8 50\cf0 \strokec4 , pw = \cf8 \strokec8 300\cf0 \strokec4 , ph = \cf8 \strokec8 500\cf0 \strokec4 ;\cb1 \
\cb3         ctx.fillStyle = \cf6 \strokec6 '#f0f2f5'\cf0 \strokec4 ; ctx.fillRect(\cf8 \strokec8 0\cf0 \strokec4 , \cf8 \strokec8 0\cf0 \strokec4 , \cf5 \strokec5 LOGIC_W\cf0 \strokec4 , \cf5 \strokec5 LOGIC_H\cf0 \strokec4 );\cb1 \
\cb3         drawRect(\cf8 \strokec8 0\cf0 \strokec4 , \cf8 \strokec8 0\cf0 \strokec4 , \cf5 \strokec5 LOGIC_W\cf0 \strokec4 , \cf8 \strokec8 80\cf0 \strokec4 , \cf6 \strokec6 '#fff'\cf0 \strokec4 ); drawIcon(\cf6 \strokec6 'back'\cf0 \strokec4 , \cf8 \strokec8 30\cf0 \strokec4 , \cf8 \strokec8 50\cf0 \strokec4 , \cf8 \strokec8 12\cf0 \strokec4 , \cf6 \strokec6 '#333'\cf0 \strokec4 ); drawText(\cf6 \strokec6 "\uc0\u27224 \u29983 \u10024 "\cf0 \strokec4 , \cf5 \strokec5 LOGIC_W\cf0 \strokec4  / \cf8 \strokec8 2\cf0 \strokec4 , \cf8 \strokec8 56\cf0 \strokec4 , \cf8 \strokec8 18\cf0 \strokec4 , \cf6 \strokec6 '#333'\cf0 \strokec4 ); drawIcon(\cf6 \strokec6 'more'\cf0 \strokec4 , \cf5 \strokec5 LOGIC_W\cf0 \strokec4  - \cf8 \strokec8 30\cf0 \strokec4 , \cf8 \strokec8 50\cf0 \strokec4 , \cf8 \strokec8 12\cf0 \strokec4 , \cf6 \strokec6 '#333'\cf0 \strokec4 ); ctx.strokeStyle = \cf5 \strokec5 COLORS\cf0 \strokec4 .line_gray; ctx.lineWidth = \cf8 \strokec8 1\cf0 \strokec4 ; ctx.beginPath(); ctx.moveTo(\cf8 \strokec8 0\cf0 \strokec4 , \cf8 \strokec8 80\cf0 \strokec4 ); ctx.lineTo(\cf5 \strokec5 LOGIC_W\cf0 \strokec4 , \cf8 \strokec8 80\cf0 \strokec4 ); ctx.stroke();\cb1 \
\cb3         \cf2 \strokec2 const\cf0 \strokec4  avatarX = \cf8 \strokec8 20\cf0 \strokec4 , avatarY = \cf8 \strokec8 100\cf0 \strokec4 , avatarR = \cf8 \strokec8 20\cf0 \strokec4 ;\cb1 \
\cb3         ctx.save(); ctx.beginPath(); ctx.arc(avatarX + avatarR, avatarY + avatarR, avatarR, \cf8 \strokec8 0\cf0 \strokec4 , \cf5 \strokec5 Math\cf0 \strokec4 .\cf5 \strokec5 PI\cf0 \strokec4  * \cf8 \strokec8 2\cf0 \strokec4 ); ctx.clip(); ctx.fillStyle = \cf6 \strokec6 '#ffe4e1'\cf0 \strokec4 ; ctx.fillRect(avatarX, avatarY, avatarR*\cf8 \strokec8 2\cf0 \strokec4 , avatarR*\cf8 \strokec8 2\cf0 \strokec4 ); ctx.fillStyle = \cf5 \strokec5 COLORS\cf0 \strokec4 .xhs_red; ctx.beginPath(); ctx.arc(avatarX + avatarR, avatarY + avatarR + \cf8 \strokec8 5\cf0 \strokec4 , \cf8 \strokec8 12\cf0 \strokec4 , \cf8 \strokec8 0\cf0 \strokec4 , \cf5 \strokec5 Math\cf0 \strokec4 .\cf5 \strokec5 PI\cf0 \strokec4 *\cf8 \strokec8 2\cf0 \strokec4 ); ctx.fill(); ctx.restore();\cb1 \
\cb3         \cf2 \strokec2 if\cf0 \strokec4  (!f.sawMoments) drawCircle(avatarX + \cf8 \strokec8 2\cf0 \strokec4  * avatarR - \cf8 \strokec8 2\cf0 \strokec4 , avatarY + \cf8 \strokec8 5\cf0 \strokec4 , \cf8 \strokec8 4\cf0 \strokec4 , \cf6 \strokec6 'red'\cf0 \strokec4 );\cb1 \
\cb3         \cf2 \strokec2 if\cf0 \strokec4  (interactive && !s.scene1Reply.choiceMade && isHover(avatarX, avatarY, \cf8 \strokec8 40\cf0 \strokec4 , \cf8 \strokec8 40\cf0 \strokec4 )) \{ canvas.style.cursor = \cf6 \strokec6 'pointer'\cf0 \strokec4 ; \cf2 \strokec2 if\cf0 \strokec4  (s.mouse.clicked) \{ s.mouse.clicked = \cf2 \strokec2 false\cf0 \strokec4 ; transitionTo(\cf5 \strokec5 STATE\cf0 \strokec4 .\cf5 \strokec5 SCENE_1_PHONE\cf0 \strokec4 , \cf2 \strokec2 true\cf0 \strokec4 ); \} \}\cb1 \
\cb3         \cf2 \strokec2 let\cf0 \strokec4  currentY = \cf8 \strokec8 105\cf0 \strokec4 ; \cf2 \strokec2 const\cf0 \strokec4  h1 = drawChatBubble(\cf8 \strokec8 70\cf0 \strokec4 , currentY + \cf8 \strokec8 5\cf0 \strokec4 , \cf6 \strokec6 "99\uc0\u24180 \u23567 \u23398 \u32769 \u24072   dd\u19968 \u19979 "\cf0 \strokec4 , \cf2 \strokec2 false\cf0 \strokec4 );\cb1 \
\cb3         drawText(\cf6 \strokec6 "2023.11.14"\cf0 \strokec4 , \cf5 \strokec5 LOGIC_W\cf0 \strokec4  / \cf8 \strokec8 2\cf0 \strokec4 , \cf8 \strokec8 90\cf0 \strokec4 , \cf8 \strokec8 10\cf0 \strokec4 , \cf6 \strokec6 '#ccc'\cf0 \strokec4 );\cb1 \
\cb3         \cf2 \strokec2 if\cf0 \strokec4  (s.scene1Reply.choiceMade) \{\cb1 \
\cb3             \cf2 \strokec2 if\cf0 \strokec4  (interactive) s.scene1Reply.timer++;\cb1 \
\cb3             currentY += h1 + \cf8 \strokec8 20\cf0 \strokec4 ; drawCircle(\cf5 \strokec5 LOGIC_W\cf0 \strokec4  - \cf8 \strokec8 40\cf0 \strokec4 , currentY + \cf8 \strokec8 20\cf0 \strokec4 , \cf8 \strokec8 20\cf0 \strokec4 , \cf5 \strokec5 COLORS\cf0 \strokec4 .primary); \cf2 \strokec2 const\cf0 \strokec4  h2 = drawChatBubble(\cf5 \strokec5 LOGIC_W\cf0 \strokec4  - \cf8 \strokec8 70\cf0 \strokec4 , currentY + \cf8 \strokec8 5\cf0 \strokec4 , s.scene1Reply.userText, \cf2 \strokec2 true\cf0 \strokec4 );\cb1 \
\cb3             \cf2 \strokec2 if\cf0 \strokec4  (s.scene1Reply.timer > \cf8 \strokec8 60\cf0 \strokec4 ) \{\cb1 \
\cb3             currentY += h2 + \cf8 \strokec8 20\cf0 \strokec4 ; ctx.save(); ctx.beginPath(); ctx.arc(avatarX + avatarR, currentY + \cf8 \strokec8 20\cf0 \strokec4 , avatarR, \cf8 \strokec8 0\cf0 \strokec4 , \cf5 \strokec5 Math\cf0 \strokec4 .\cf5 \strokec5 PI\cf0 \strokec4  * \cf8 \strokec8 2\cf0 \strokec4 ); ctx.clip(); ctx.fillStyle = \cf6 \strokec6 '#ffe4e1'\cf0 \strokec4 ; ctx.fillRect(avatarX, currentY, avatarR*\cf8 \strokec8 2\cf0 \strokec4 , avatarR*\cf8 \strokec8 2\cf0 \strokec4 ); ctx.fillStyle = \cf5 \strokec5 COLORS\cf0 \strokec4 .xhs_red; ctx.beginPath(); ctx.arc(avatarX + avatarR, currentY + \cf8 \strokec8 25\cf0 \strokec4 , \cf8 \strokec8 12\cf0 \strokec4 , \cf8 \strokec8 0\cf0 \strokec4 , \cf5 \strokec5 Math\cf0 \strokec4 .\cf5 \strokec5 PI\cf0 \strokec4 *\cf8 \strokec8 2\cf0 \strokec4 ); ctx.fill(); ctx.restore();\cb1 \
\cb3             \cf2 \strokec2 const\cf0 \strokec4  h3 = drawChatBubble(\cf8 \strokec8 70\cf0 \strokec4 , currentY + \cf8 \strokec8 5\cf0 \strokec4 , s.scene1Reply.replyText, \cf2 \strokec2 false\cf0 \strokec4 );\cb1 \
\cb3             \cf2 \strokec2 if\cf0 \strokec4  (s.scene1Reply.showQR && s.scene1Reply.timer > \cf8 \strokec8 120\cf0 \strokec4 ) \{\cb1 \
\cb3                 \cf2 \strokec2 const\cf0 \strokec4  qrY = currentY + h3 + \cf8 \strokec8 20\cf0 \strokec4 ; drawRect(\cf8 \strokec8 70\cf0 \strokec4 , qrY, \cf8 \strokec8 120\cf0 \strokec4 , \cf8 \strokec8 120\cf0 \strokec4 , \cf6 \strokec6 '#fff'\cf0 \strokec4 , \cf8 \strokec8 5\cf0 \strokec4 ); ctx.strokeStyle = \cf6 \strokec6 '#eee'\cf0 \strokec4 ; ctx.strokeRect(\cf8 \strokec8 70\cf0 \strokec4 , qrY, \cf8 \strokec8 120\cf0 \strokec4 , \cf8 \strokec8 120\cf0 \strokec4 ); ctx.fillStyle = \cf6 \strokec6 '#000'\cf0 \strokec4 ;\cb1 \
\cb3                 \cf2 \strokec2 for\cf0 \strokec4 (\cf2 \strokec2 let\cf0 \strokec4  i=\cf8 \strokec8 0\cf0 \strokec4 ; i<\cf8 \strokec8 5\cf0 \strokec4 ; i++) \cf2 \strokec2 for\cf0 \strokec4 (\cf2 \strokec2 let\cf0 \strokec4  j=\cf8 \strokec8 0\cf0 \strokec4 ; j<\cf8 \strokec8 5\cf0 \strokec4 ; j++) \cf2 \strokec2 if\cf0 \strokec4 ((i+j)%\cf8 \strokec8 2\cf0 \strokec4 ==\cf8 \strokec8 0\cf0 \strokec4 ) drawRect(\cf8 \strokec8 85\cf0 \strokec4  + i*\cf8 \strokec8 18\cf0 \strokec4 , qrY+\cf8 \strokec8 15\cf0 \strokec4  + j*\cf8 \strokec8 18\cf0 \strokec4 , \cf8 \strokec8 12\cf0 \strokec4 , \cf8 \strokec8 12\cf0 \strokec4 , \cf6 \strokec6 '#000'\cf0 \strokec4 );\cb1 \
\cb3                 drawText(\cf6 \strokec6 "\uc0\u25195 \u19968 \u25195 \u21152 \u25105 "\cf0 \strokec4 , \cf8 \strokec8 130\cf0 \strokec4 , qrY + \cf8 \strokec8 140\cf0 \strokec4 , \cf8 \strokec8 12\cf0 \strokec4 , \cf6 \strokec6 '#999'\cf0 \strokec4 );\cb1 \
\cb3             \}\cb1 \
\cb3             \}\cb1 \
\cb3             \cf2 \strokec2 const\cf0 \strokec4  waitTime = s.scene1Reply.showQR ? \cf8 \strokec8 240\cf0 \strokec4  : \cf8 \strokec8 180\cf0 \strokec4 ;\cb1 \
\cb3             \cf2 \strokec2 if\cf0 \strokec4  (interactive && s.scene1Reply.timer > waitTime) \{ \cf2 \strokec2 if\cf0 \strokec4  (f.scene1Correct) \{ f.scene1Finished = \cf2 \strokec2 true\cf0 \strokec4 ; transitionTo(\cf5 \strokec5 STATE\cf0 \strokec4 .\cf5 \strokec5 SCENE_2_DINNER\cf0 \strokec4 ); \} \cf2 \strokec2 else\cf0 \strokec4  \{ s.score = \cf8 \strokec8 0\cf0 \strokec4 ; transitionTo(\cf5 \strokec5 STATE\cf0 \strokec4 .\cf5 \strokec5 ENDING\cf0 \strokec4 ); \} \}\cb1 \
\cb3             \cf2 \strokec2 return\cf0 \strokec4 ;\cb1 \
\cb3         \}\cb1 \
\cb3         \cf2 \strokec2 const\cf0 \strokec4  inputY = \cf5 \strokec5 LOGIC_H\cf0 \strokec4  - \cf8 \strokec8 70\cf0 \strokec4 ; drawRect(\cf8 \strokec8 0\cf0 \strokec4 , \cf5 \strokec5 LOGIC_H\cf0 \strokec4  - \cf8 \strokec8 80\cf0 \strokec4 , \cf5 \strokec5 LOGIC_W\cf0 \strokec4 , \cf8 \strokec8 80\cf0 \strokec4 , \cf6 \strokec6 '#fff'\cf0 \strokec4 ); ctx.strokeStyle = \cf5 \strokec5 COLORS\cf0 \strokec4 .line_gray; ctx.beginPath(); ctx.moveTo(\cf8 \strokec8 0\cf0 \strokec4 , \cf5 \strokec5 LOGIC_H\cf0 \strokec4  - \cf8 \strokec8 80\cf0 \strokec4 ); ctx.lineTo(\cf5 \strokec5 LOGIC_W\cf0 \strokec4 , \cf5 \strokec5 LOGIC_H\cf0 \strokec4  - \cf8 \strokec8 80\cf0 \strokec4 ); ctx.stroke();\cb1 \
\cb3         \cf2 \strokec2 const\cf0 \strokec4  inputW = \cf5 \strokec5 LOGIC_W\cf0 \strokec4  - \cf8 \strokec8 100\cf0 \strokec4 ; \cf2 \strokec2 let\cf0 \strokec4  inputStroke = !f.scene1InputClicked && isHover(\cf8 \strokec8 20\cf0 \strokec4 , inputY, inputW, \cf8 \strokec8 40\cf0 \strokec4 ) ? \cf5 \strokec5 COLORS\cf0 \strokec4 .xhs_red : \cf6 \strokec6 'transparent'\cf0 \strokec4 ; \cf2 \strokec2 if\cf0 \strokec4  (f.scene1InputClicked) inputStroke = \cf5 \strokec5 COLORS\cf0 \strokec4 .xhs_red;\cb1 \
\cb3         \cf2 \strokec2 if\cf0 \strokec4  (interactive && !f.scene1InputClicked && isHover(\cf8 \strokec8 20\cf0 \strokec4 , inputY, inputW, \cf8 \strokec8 40\cf0 \strokec4 ) && s.mouse.clicked) \{ s.mouse.clicked = \cf2 \strokec2 false\cf0 \strokec4 ; f.scene1InputClicked = \cf2 \strokec2 true\cf0 \strokec4 ; \}\cb1 \
\cb3         drawRect(\cf8 \strokec8 20\cf0 \strokec4 , inputY, inputW, \cf8 \strokec8 40\cf0 \strokec4 , \cf5 \strokec5 COLORS\cf0 \strokec4 .ui_gray, \cf8 \strokec8 20\cf0 \strokec4 ); \cf2 \strokec2 if\cf0 \strokec4  (inputStroke !== \cf6 \strokec6 'transparent'\cf0 \strokec4 ) \{ ctx.save(); ctx.strokeStyle = inputStroke; ctx.lineWidth = \cf8 \strokec8 1\cf0 \strokec4 ; ctx.beginPath(); ctx.roundRect(\cf8 \strokec8 20\cf0 \strokec4 , inputY, inputW, \cf8 \strokec8 40\cf0 \strokec4 , \cf8 \strokec8 20\cf0 \strokec4 ); ctx.stroke(); ctx.restore(); \}\cb1 \
\cb3         drawText(f.scene1InputClicked ? \cf6 \strokec6 " |"\cf0 \strokec4  : \cf6 \strokec6 " \uc0\u35828 \u28857 \u20160 \u20040 ..."\cf0 \strokec4 , \cf8 \strokec8 60\cf0 \strokec4 , inputY + \cf8 \strokec8 25\cf0 \strokec4 , \cf8 \strokec8 14\cf0 \strokec4 , f.scene1InputClicked ? \cf6 \strokec6 '#333'\cf0 \strokec4  : \cf6 \strokec6 '#999'\cf0 \strokec4 , \cf6 \strokec6 'left'\cf0 \strokec4 ); drawCircle(\cf5 \strokec5 LOGIC_W\cf0 \strokec4  - \cf8 \strokec8 40\cf0 \strokec4 , inputY + \cf8 \strokec8 20\cf0 \strokec4 , \cf8 \strokec8 15\cf0 \strokec4 , \cf5 \strokec5 COLORS\cf0 \strokec4 .ui_gray); drawText(\cf6 \strokec6 "+"\cf0 \strokec4 , \cf5 \strokec5 LOGIC_W\cf0 \strokec4  - \cf8 \strokec8 40\cf0 \strokec4 , inputY + \cf8 \strokec8 26\cf0 \strokec4 , \cf8 \strokec8 20\cf0 \strokec4 , \cf6 \strokec6 '#666'\cf0 \strokec4 );\cb1 \
\cb3         \cf2 \strokec2 if\cf0 \strokec4  (interactive && s.frameCount > \cf8 \strokec8 60\cf0 \strokec4  && f.scene1InputClicked) \{\cb1 \
\cb3             \cf2 \strokec2 const\cf0 \strokec4  btnW = \cf8 \strokec8 280\cf0 \strokec4 , btnX = (\cf5 \strokec5 LOGIC_W\cf0 \strokec4  - btnW) / \cf8 \strokec8 2\cf0 \strokec4 ; \cf2 \strokec2 const\cf0 \strokec4  optY = \cf5 \strokec5 LOGIC_H\cf0 \strokec4  - \cf8 \strokec8 250\cf0 \strokec4 ;\cb1 \
\cb3             drawButton(\cf6 \strokec6 "\uc0\u20320 \u22909 \u21834 "\cf0 \strokec4 , btnX, optY, btnW, \cf8 \strokec8 45\cf0 \strokec4 , () => \{ s.scene1Reply = \{ choiceMade: \cf2 \strokec2 true\cf0 \strokec4 , userText: \cf6 \strokec6 "\uc0\u20320 \u22909 \u21834 "\cf0 \strokec4 , replyText: \cf6 \strokec6 "\uc0\u20320 \u22909 \u20320 \u22909 "\cf0 \strokec4 , showQR: \cf2 \strokec2 false\cf0 \strokec4 , timer: \cf8 \strokec8 0\cf0 \strokec4  \}; s.score = \cf8 \strokec8 0\cf0 \strokec4 ; \}, \cf5 \strokec5 COLORS\cf0 \strokec4 .xhs_red);\cb1 \
\cb3             drawButton(\cf6 \strokec6 "\uc0\u21516 \u23398 \u20320 \u22909 \u65292 \u35831 \u38382 \u20320 \u21483 \u20160 \u20040 \u21517 \u23383 "\cf0 \strokec4 , btnX, optY + \cf8 \strokec8 55\cf0 \strokec4 , btnW, \cf8 \strokec8 45\cf0 \strokec4 , () => \{ s.scene1Reply = \{ choiceMade: \cf2 \strokec2 true\cf0 \strokec4 , userText: \cf6 \strokec6 "\uc0\u21516 \u23398 \u20320 \u22909 \u65292 \u35831 \u38382 \u20320 \u21483 \u20160 \u20040 \u21517 \u23383 "\cf0 \strokec4 , replyText: \cf6 \strokec6 "\uc0\u25105 \u21483 \u21608 \u26790 \u38634 \u65292 \u20320 \u21483 \u20160 \u20040 \u65311 "\cf0 \strokec4 , showQR: \cf2 \strokec2 false\cf0 \strokec4 , timer: \cf8 \strokec8 0\cf0 \strokec4  \}; s.score = \cf8 \strokec8 4\cf0 \strokec4 ; \}, \cf5 \strokec5 COLORS\cf0 \strokec4 .xhs_red);\cb1 \
\cb3             \cf2 \strokec2 if\cf0 \strokec4  (f.sawMoments) \{ ctx.shadowBlur = \cf8 \strokec8 10\cf0 \strokec4 ; ctx.shadowColor = \cf6 \strokec6 'rgba(255, 36, 66, 0.3)'\cf0 \strokec4 ; drawButton(\cf6 \strokec6 "\uc0\u21516 \u23398 \u20320 \u22909 \u28418 \u20142 \u65292 \u24494 \u20449 \u21495 \u20063 \u19968 \u23450 \u24456 \u22909 \u35760 \u21543 "\cf0 \strokec4 , btnX, optY - \cf8 \strokec8 55\cf0 \strokec4 , btnW, \cf8 \strokec8 45\cf0 \strokec4 , () => \{ s.scene1Reply = \{ choiceMade: \cf2 \strokec2 true\cf0 \strokec4 , userText: \cf6 \strokec6 "\uc0\u21516 \u23398 \u20320 \u22909 \u28418 \u20142 \u65292 \u24494 \u20449 \u21495 \u20063 \u19968 \u23450 \u24456 \u22909 \u35760 \u21543 "\cf0 \strokec4 , replyText: \cf6 \strokec6 "\uc0\u27833 \u22068 \u28369 \u33292 \u65281 "\cf0 \strokec4 , showQR: \cf2 \strokec2 true\cf0 \strokec4 , timer: \cf8 \strokec8 0\cf0 \strokec4  \}; s.score += \cf8 \strokec8 2\cf0 \strokec4 ; f.scene1Correct = \cf2 \strokec2 true\cf0 \strokec4 ; \}, \cf5 \strokec5 COLORS\cf0 \strokec4 .xhs_red); ctx.shadowBlur = \cf8 \strokec8 0\cf0 \strokec4 ; \}\cb1 \
\cb3         \}\cb1 \
\cb3     \};\cb1 \
\
\cb3     \cf2 \strokec2 const\cf0 \strokec4  updateScene1Phone = () => \{\cb1 \
\cb3         \cf2 \strokec2 const\cf0 \strokec4  s = gameState.current;\cb1 \
\cb3         ctx.fillStyle = \cf6 \strokec6 '#000'\cf0 \strokec4 ; ctx.fillRect(\cf8 \strokec8 0\cf0 \strokec4 , \cf8 \strokec8 0\cf0 \strokec4 , \cf5 \strokec5 LOGIC_W\cf0 \strokec4 , \cf5 \strokec5 LOGIC_H\cf0 \strokec4 ); drawRect(\cf8 \strokec8 0\cf0 \strokec4 , \cf8 \strokec8 0\cf0 \strokec4 , \cf5 \strokec5 LOGIC_W\cf0 \strokec4 , \cf5 \strokec5 LOGIC_H\cf0 \strokec4 , \cf6 \strokec6 '#fff'\cf0 \strokec4 );\cb1 \
\cb3         ctx.save(); ctx.beginPath(); ctx.rect(\cf8 \strokec8 0\cf0 \strokec4 , \cf8 \strokec8 0\cf0 \strokec4 , \cf5 \strokec5 LOGIC_W\cf0 \strokec4 , \cf5 \strokec5 LOGIC_H\cf0 \strokec4 ); ctx.clip(); ctx.translate(\cf8 \strokec8 0\cf0 \strokec4 , -s.profileScrollY);\cb1 \
\cb3         \cf2 \strokec2 const\cf0 \strokec4  grad = ctx.createLinearGradient(\cf8 \strokec8 0\cf0 \strokec4 , \cf8 \strokec8 0\cf0 \strokec4 , \cf8 \strokec8 0\cf0 \strokec4 , \cf8 \strokec8 200\cf0 \strokec4 ); grad.addColorStop(\cf8 \strokec8 0\cf0 \strokec4 , \cf6 \strokec6 '#ffdde1'\cf0 \strokec4 ); grad.addColorStop(\cf8 \strokec8 1\cf0 \strokec4 , \cf6 \strokec6 '#ee9ca7'\cf0 \strokec4 ); ctx.fillStyle = grad; ctx.fillRect(\cf8 \strokec8 0\cf0 \strokec4 , \cf8 \strokec8 0\cf0 \strokec4 , \cf5 \strokec5 LOGIC_W\cf0 \strokec4 , \cf8 \strokec8 200\cf0 \strokec4 );\cb1 \
\cb3         \cf2 \strokec2 const\cf0 \strokec4  infoY = \cf8 \strokec8 160\cf0 \strokec4 ; drawCircle(\cf8 \strokec8 50\cf0 \strokec4 , infoY, \cf8 \strokec8 42\cf0 \strokec4 , \cf6 \strokec6 '#fff'\cf0 \strokec4 ); drawCircle(\cf8 \strokec8 50\cf0 \strokec4 , infoY, \cf8 \strokec8 38\cf0 \strokec4 , \cf6 \strokec6 '#ffe4e1'\cf0 \strokec4 ); ctx.fillStyle = \cf5 \strokec5 COLORS\cf0 \strokec4 .xhs_red; ctx.beginPath(); ctx.arc(\cf8 \strokec8 50\cf0 \strokec4 , infoY + \cf8 \strokec8 10\cf0 \strokec4 , \cf8 \strokec8 22\cf0 \strokec4 , \cf8 \strokec8 0\cf0 \strokec4 , \cf5 \strokec5 Math\cf0 \strokec4 .\cf5 \strokec5 PI\cf0 \strokec4 *\cf8 \strokec8 2\cf0 \strokec4 ); ctx.fill();\cb1 \
\cb3         drawText(\cf6 \strokec6 "\uc0\u27224 \u29983 \u10024 "\cf0 \strokec4 , \cf8 \strokec8 110\cf0 \strokec4 , infoY + \cf8 \strokec8 15\cf0 \strokec4 , \cf8 \strokec8 20\cf0 \strokec4 , \cf6 \strokec6 '#333'\cf0 \strokec4 , \cf6 \strokec6 'left'\cf0 \strokec4 ); drawText(\cf6 \strokec6 "\uc0\u23567 \u32418 \u34223 \u21495 \u65306 9527888"\cf0 \strokec4 , \cf8 \strokec8 110\cf0 \strokec4 , infoY + \cf8 \strokec8 35\cf0 \strokec4 , \cf8 \strokec8 12\cf0 \strokec4 , \cf6 \strokec6 '#999'\cf0 \strokec4 , \cf6 \strokec6 'left'\cf0 \strokec4 ); drawText(\cf6 \strokec6 "\uc0\u21507 \u21917 \u29609 \u20048 \u10024  | \u25668 \u24433 \u55357 \u56567  | \u20998 \u20139 \u29983 \u27963 "\cf0 \strokec4 , \cf8 \strokec8 20\cf0 \strokec4 , infoY + \cf8 \strokec8 70\cf0 \strokec4 , \cf8 \strokec8 14\cf0 \strokec4 , \cf6 \strokec6 '#333'\cf0 \strokec4 , \cf6 \strokec6 'left'\cf0 \strokec4 );\cb1 \
\cb3         \cf2 \strokec2 const\cf0 \strokec4  statsY = infoY + \cf8 \strokec8 100\cf0 \strokec4 ; drawText(\cf6 \strokec6 "12"\cf0 \strokec4 , \cf8 \strokec8 30\cf0 \strokec4 , statsY, \cf8 \strokec8 16\cf0 \strokec4 , \cf6 \strokec6 '#333'\cf0 \strokec4 ); drawText(\cf6 \strokec6 "\uc0\u20851 \u27880 "\cf0 \strokec4 , \cf8 \strokec8 30\cf0 \strokec4 , statsY + \cf8 \strokec8 20\cf0 \strokec4 , \cf8 \strokec8 12\cf0 \strokec4 , \cf6 \strokec6 '#999'\cf0 \strokec4 ); drawText(\cf6 \strokec6 "326"\cf0 \strokec4 , \cf8 \strokec8 90\cf0 \strokec4 , statsY, \cf8 \strokec8 16\cf0 \strokec4 , \cf6 \strokec6 '#333'\cf0 \strokec4 ); drawText(\cf6 \strokec6 "\uc0\u31881 \u19997 "\cf0 \strokec4 , \cf8 \strokec8 90\cf0 \strokec4 , statsY + \cf8 \strokec8 20\cf0 \strokec4 , \cf8 \strokec8 12\cf0 \strokec4 , \cf6 \strokec6 '#999'\cf0 \strokec4 ); drawText(\cf6 \strokec6 "1.2k"\cf0 \strokec4 , \cf8 \strokec8 160\cf0 \strokec4 , statsY, \cf8 \strokec8 16\cf0 \strokec4 , \cf6 \strokec6 '#333'\cf0 \strokec4 ); drawText(\cf6 \strokec6 "\uc0\u33719 \u36190 \u19982 \u25910 \u34255 "\cf0 \strokec4 , \cf8 \strokec8 170\cf0 \strokec4 , statsY + \cf8 \strokec8 20\cf0 \strokec4 , \cf8 \strokec8 12\cf0 \strokec4 , \cf6 \strokec6 '#999'\cf0 \strokec4 );\cb1 \
\cb3         drawRect(\cf5 \strokec5 LOGIC_W\cf0 \strokec4  - \cf8 \strokec8 120\cf0 \strokec4 , infoY + \cf8 \strokec8 10\cf0 \strokec4 , \cf8 \strokec8 80\cf0 \strokec4 , \cf8 \strokec8 30\cf0 \strokec4 , \cf5 \strokec5 COLORS\cf0 \strokec4 .xhs_red, \cf8 \strokec8 15\cf0 \strokec4 ); drawText(\cf6 \strokec6 "\uc0\u20851 \u27880 "\cf0 \strokec4 , \cf5 \strokec5 LOGIC_W\cf0 \strokec4  - \cf8 \strokec8 80\cf0 \strokec4 , infoY + \cf8 \strokec8 30\cf0 \strokec4 , \cf8 \strokec8 14\cf0 \strokec4 , \cf6 \strokec6 '#fff'\cf0 \strokec4 );\cb1 \
\cb3         \cf2 \strokec2 const\cf0 \strokec4  tabY = statsY + \cf8 \strokec8 40\cf0 \strokec4 ; drawText(\cf6 \strokec6 "\uc0\u31508 \u35760 "\cf0 \strokec4 , \cf8 \strokec8 60\cf0 \strokec4 , tabY, \cf8 \strokec8 16\cf0 \strokec4 , \cf6 \strokec6 '#333'\cf0 \strokec4 ); drawRect(\cf8 \strokec8 45\cf0 \strokec4 , tabY + \cf8 \strokec8 10\cf0 \strokec4 , \cf8 \strokec8 30\cf0 \strokec4 , \cf8 \strokec8 2\cf0 \strokec4 , \cf5 \strokec5 COLORS\cf0 \strokec4 .xhs_red); drawText(\cf6 \strokec6 "\uc0\u25910 \u34255 "\cf0 \strokec4 , \cf8 \strokec8 150\cf0 \strokec4 , tabY, \cf8 \strokec8 16\cf0 \strokec4 , \cf6 \strokec6 '#999'\cf0 \strokec4 ); drawText(\cf6 \strokec6 "\uc0\u36190 \u36807 "\cf0 \strokec4 , \cf8 \strokec8 240\cf0 \strokec4 , tabY, \cf8 \strokec8 16\cf0 \strokec4 , \cf6 \strokec6 '#999'\cf0 \strokec4 ); ctx.strokeStyle = \cf6 \strokec6 '#f0f0f0'\cf0 \strokec4 ; ctx.beginPath(); ctx.moveTo(\cf8 \strokec8 0\cf0 \strokec4 , tabY+\cf8 \strokec8 15\cf0 \strokec4 ); ctx.lineTo(\cf5 \strokec5 LOGIC_W\cf0 \strokec4 , tabY+\cf8 \strokec8 15\cf0 \strokec4 ); ctx.stroke();\cb1 \
\cb3         \cf2 \strokec2 const\cf0 \strokec4  contentY = tabY + \cf8 \strokec8 30\cf0 \strokec4 ; \cf2 \strokec2 const\cf0 \strokec4  cardW = (\cf5 \strokec5 LOGIC_W\cf0 \strokec4  - \cf8 \strokec8 40\cf0 \strokec4 ) / \cf8 \strokec8 2\cf0 \strokec4 , cardH = \cf8 \strokec8 220\cf0 \strokec4 , gap = \cf8 \strokec8 10\cf0 \strokec4 ;\cb1 \
\cb3         \cf2 \strokec2 const\cf0 \strokec4  drawCard = (cx, cy, title, likeCount, \cf2 \strokec2 type\cf0 \strokec4 ) => \{\cb1 \
\cb3           drawRect(cx, cy, cardW, cardH, \cf6 \strokec6 '#fff'\cf0 \strokec4 , \cf8 \strokec8 8\cf0 \strokec4 ); ctx.strokeStyle = \cf6 \strokec6 '#f5f5f5'\cf0 \strokec4 ; ctx.strokeRect(cx, cy, cardW, cardH); drawRect(cx, cy, cardW, \cf8 \strokec8 150\cf0 \strokec4 , \cf6 \strokec6 '#f9f9f9'\cf0 \strokec4 , \cf8 \strokec8 8\cf0 \strokec4 ); ctx.fillRect(cx, cy+\cf8 \strokec8 140\cf0 \strokec4 , cardW, \cf8 \strokec8 10\cf0 \strokec4 );\cb1 \
\cb3           \cf2 \strokec2 if\cf0 \strokec4  (\cf2 \strokec2 type\cf0 \strokec4  === \cf6 \strokec6 'selfie'\cf0 \strokec4 ) \{ ctx.fillStyle = \cf5 \strokec5 COLORS\cf0 \strokec4 .highlight; ctx.beginPath(); ctx.arc(cx + cardW/\cf8 \strokec8 2\cf0 \strokec4 , cy + \cf8 \strokec8 80\cf0 \strokec4 , \cf8 \strokec8 30\cf0 \strokec4 , \cf8 \strokec8 0\cf0 \strokec4 , \cf5 \strokec5 Math\cf0 \strokec4 .\cf5 \strokec5 PI\cf0 \strokec4 *\cf8 \strokec8 2\cf0 \strokec4 ); ctx.fill(); \} \cf2 \strokec2 else\cf0 \strokec4  \cf2 \strokec2 if\cf0 \strokec4  (\cf2 \strokec2 type\cf0 \strokec4  === \cf6 \strokec6 'food'\cf0 \strokec4 ) drawCircle(cx + cardW/\cf8 \strokec8 2\cf0 \strokec4 , cy + \cf8 \strokec8 80\cf0 \strokec4 , \cf8 \strokec8 20\cf0 \strokec4 , \cf6 \strokec6 '#ffd700'\cf0 \strokec4 ); \cf2 \strokec2 else\cf0 \strokec4  \{ ctx.fillStyle = \cf6 \strokec6 '#87ceeb'\cf0 \strokec4 ; drawRect(cx+\cf8 \strokec8 20\cf0 \strokec4 , cy+\cf8 \strokec8 50\cf0 \strokec4 , cardW-\cf8 \strokec8 40\cf0 \strokec4 , \cf8 \strokec8 60\cf0 \strokec4 , \cf6 \strokec6 '#87ceeb'\cf0 \strokec4 ); \}\cb1 \
\cb3           drawText(title, cx + \cf8 \strokec8 10\cf0 \strokec4 , cy + \cf8 \strokec8 175\cf0 \strokec4 , \cf8 \strokec8 14\cf0 \strokec4 , \cf6 \strokec6 '#333'\cf0 \strokec4 , \cf6 \strokec6 'left'\cf0 \strokec4 ); drawCircle(cx + \cf8 \strokec8 15\cf0 \strokec4 , cy + \cf8 \strokec8 200\cf0 \strokec4 , \cf8 \strokec8 10\cf0 \strokec4 , \cf6 \strokec6 '#eee'\cf0 \strokec4 ); drawText(\cf6 \strokec6 "\uc0\u27224 \u29983 \u10024 "\cf0 \strokec4 , cx + \cf8 \strokec8 30\cf0 \strokec4 , cy + \cf8 \strokec8 205\cf0 \strokec4 , \cf8 \strokec8 12\cf0 \strokec4 , \cf6 \strokec6 '#999'\cf0 \strokec4 , \cf6 \strokec6 'left'\cf0 \strokec4 ); drawText(\cf6 \strokec6 "\uc0\u10084  "\cf0 \strokec4  + likeCount, cx + cardW - \cf8 \strokec8 10\cf0 \strokec4 , cy + \cf8 \strokec8 205\cf0 \strokec4 , \cf8 \strokec8 10\cf0 \strokec4 , \cf6 \strokec6 '#999'\cf0 \strokec4 , \cf6 \strokec6 'right'\cf0 \strokec4 );\cb1 \
\cb3         \};\cb1 \
\cb3         drawCard(\cf8 \strokec8 15\cf0 \strokec4 , contentY, \cf6 \strokec6 "\uc0\u20170 \u26085 \u20221 \u33258 \u25293 ~\u10024 "\cf0 \strokec4 , \cf6 \strokec6 "520"\cf0 \strokec4 , \cf6 \strokec6 'selfie'\cf0 \strokec4 ); drawCard(\cf8 \strokec8 15\cf0 \strokec4  + cardW + gap, contentY, \cf6 \strokec6 "\uc0\u36229 \u22909 \u21507 \u30340 \u28779 \u38149 \u55356 \u57202 "\cf0 \strokec4 , \cf6 \strokec6 "102"\cf0 \strokec4 , \cf6 \strokec6 'food'\cf0 \strokec4 ); drawCard(\cf8 \strokec8 15\cf0 \strokec4 , contentY + cardH + gap, \cf6 \strokec6 "\uc0\u21608 \u26411 \u21435 \u30475 \u20102 \u23637 \u55356 \u57256 "\cf0 \strokec4 , \cf6 \strokec6 "330"\cf0 \strokec4 , \cf6 \strokec6 'scenery'\cf0 \strokec4 ); drawCard(\cf8 \strokec8 15\cf0 \strokec4  + cardW + gap, contentY + cardH + gap, \cf6 \strokec6 "\uc0\u31070 \u20185 \u22902 \u33590 !"\cf0 \strokec4 , \cf6 \strokec6 "89"\cf0 \strokec4 , \cf6 \strokec6 'food'\cf0 \strokec4 ); drawCard(\cf8 \strokec8 15\cf0 \strokec4 , contentY + (cardH + gap)*\cf8 \strokec8 2\cf0 \strokec4 , \cf6 \strokec6 "\uc0\u27714 \u25265 \u25265 "\cf0 \strokec4 , \cf6 \strokec6 "999"\cf0 \strokec4 , \cf6 \strokec6 'selfie'\cf0 \strokec4 );\cb1 \
\cb3         ctx.restore();\cb1 \
\cb3         drawIcon(\cf6 \strokec6 'back'\cf0 \strokec4 , \cf8 \strokec8 30\cf0 \strokec4 , \cf8 \strokec8 50\cf0 \strokec4 , \cf8 \strokec8 12\cf0 \strokec4 , \cf6 \strokec6 '#fff'\cf0 \strokec4 );\cb1 \
\cb3         \cf2 \strokec2 if\cf0 \strokec4  (isHover(\cf8 \strokec8 0\cf0 \strokec4 , \cf8 \strokec8 0\cf0 \strokec4 , \cf8 \strokec8 80\cf0 \strokec4 , \cf8 \strokec8 80\cf0 \strokec4 ) && s.mouse.clicked) \{ s.mouse.clicked = \cf2 \strokec2 false\cf0 \strokec4 ; s.flags.sawMoments = \cf2 \strokec2 true\cf0 \strokec4 ; transitionTo(\cf5 \strokec5 STATE\cf0 \strokec4 .\cf5 \strokec5 SCENE_1_CHAT\cf0 \strokec4 , \cf2 \strokec2 true\cf0 \strokec4 ); \}\cb1 \
\cb3         drawButton(\cf6 \strokec6 "\uc0\u36820 \u22238 \u32842 \u22825 "\cf0 \strokec4 , (\cf5 \strokec5 LOGIC_W\cf0 \strokec4  - \cf8 \strokec8 200\cf0 \strokec4 )/\cf8 \strokec8 2\cf0 \strokec4 , \cf5 \strokec5 LOGIC_H\cf0 \strokec4  - \cf8 \strokec8 80\cf0 \strokec4 , \cf8 \strokec8 200\cf0 \strokec4 , \cf8 \strokec8 50\cf0 \strokec4 , () => \{ s.flags.sawMoments = \cf2 \strokec2 true\cf0 \strokec4 ; transitionTo(\cf5 \strokec5 STATE\cf0 \strokec4 .\cf5 \strokec5 SCENE_1_CHAT\cf0 \strokec4 , \cf2 \strokec2 true\cf0 \strokec4 ); \}, \cf5 \strokec5 COLORS\cf0 \strokec4 .xhs_red);\cb1 \
\cb3     \};\cb1 \
\
\cb3     \cf2 \strokec2 const\cf0 \strokec4  updateScene2 = () => \{\cb1 \
\cb3       \cf2 \strokec2 const\cf0 \strokec4  s = gameState.current; \cf2 \strokec2 const\cf0 \strokec4  f = s.flags;\cb1 \
\cb3       \cf2 \strokec2 if\cf0 \strokec4  (s.mouse.clicked && !f.scene2Finished && !s.showDinnerOptions) \{\cb1 \
\cb3         \cf2 \strokec2 if\cf0 \strokec4  (isHover(\cf5 \strokec5 LOGIC_W\cf0 \strokec4  - \cf8 \strokec8 150\cf0 \strokec4 , \cf8 \strokec8 100\cf0 \strokec4 , \cf8 \strokec8 150\cf0 \strokec4 , \cf8 \strokec8 200\cf0 \strokec4 )) \{ f.paidSecretly = \cf2 \strokec2 true\cf0 \strokec4 ; s.score += \cf8 \strokec8 2\cf0 \strokec4 ; s.mouse.clicked = \cf2 \strokec2 false\cf0 \strokec4 ; s.paymentFeedbackTimer = \cf8 \strokec8 90\cf0 \strokec4 ; \cf2 \strokec2 return\cf0 \strokec4 ; \}\cb1 \
\cb3       \}\cb1 \
\cb3       ctx.fillStyle = \cf6 \strokec6 '#fff8dc'\cf0 \strokec4 ; ctx.fillRect(\cf8 \strokec8 0\cf0 \strokec4 , \cf8 \strokec8 0\cf0 \strokec4 , \cf5 \strokec5 LOGIC_W\cf0 \strokec4 , \cf5 \strokec5 LOGIC_H\cf0 \strokec4 );\cb1 \
\cb3       ctx.fillStyle = \cf6 \strokec6 '#d2b48c'\cf0 \strokec4 ; ctx.fillRect(\cf5 \strokec5 LOGIC_W\cf0 \strokec4  - \cf8 \strokec8 150\cf0 \strokec4 , \cf8 \strokec8 150\cf0 \strokec4 , \cf8 \strokec8 150\cf0 \strokec4 , \cf8 \strokec8 100\cf0 \strokec4 ); drawText(\cf6 \strokec6 "\uc0\u25910 \u38134 \u21488 "\cf0 \strokec4 , \cf5 \strokec5 LOGIC_W\cf0 \strokec4  - \cf8 \strokec8 75\cf0 \strokec4 , \cf8 \strokec8 200\cf0 \strokec4 , \cf8 \strokec8 16\cf0 \strokec4 , \cf6 \strokec6 '#fff'\cf0 \strokec4 );\cb1 \
\cb3       \cf2 \strokec2 if\cf0 \strokec4  (!f.paidSecretly && !s.showDinnerOptions && s.frameCount % \cf8 \strokec8 60\cf0 \strokec4  < \cf8 \strokec8 30\cf0 \strokec4 ) drawCircle(\cf5 \strokec5 LOGIC_W\cf0 \strokec4  - \cf8 \strokec8 75\cf0 \strokec4 , \cf8 \strokec8 140\cf0 \strokec4 , \cf8 \strokec8 5\cf0 \strokec4 , \cf5 \strokec5 COLORS\cf0 \strokec4 .primary);\cb1 \
\cb3       \cf2 \strokec2 if\cf0 \strokec4  (f.paidSecretly) drawText(\cf6 \strokec6 "\uc0\u10004 "\cf0 \strokec4 , \cf5 \strokec5 LOGIC_W\cf0 \strokec4  - \cf8 \strokec8 75\cf0 \strokec4 , \cf8 \strokec8 140\cf0 \strokec4 , \cf8 \strokec8 20\cf0 \strokec4 , \cf6 \strokec6 'green'\cf0 \strokec4 );\cb1 \
\cb3       \cf2 \strokec2 if\cf0 \strokec4  (s.paymentFeedbackTimer > \cf8 \strokec8 0\cf0 \strokec4 ) \{ s.paymentFeedbackTimer--; ctx.fillStyle = \cf5 \strokec5 COLORS\cf0 \strokec4 .highlight; ctx.globalAlpha = \cf8 \strokec8 0.8\cf0 \strokec4 ; ctx.fillRect(\cf5 \strokec5 LOGIC_W\cf0 \strokec4  - \cf8 \strokec8 150\cf0 \strokec4 , \cf8 \strokec8 150\cf0 \strokec4 , \cf8 \strokec8 150\cf0 \strokec4 , \cf8 \strokec8 100\cf0 \strokec4 ); ctx.globalAlpha = \cf8 \strokec8 1.0\cf0 \strokec4 ; drawText(\cf6 \strokec6 "\uc0\u24050 \u24708 \u24708 \u20080 \u21333 "\cf0 \strokec4 , \cf5 \strokec5 LOGIC_W\cf0 \strokec4  / \cf8 \strokec8 2\cf0 \strokec4 , \cf8 \strokec8 280\cf0 \strokec4 , \cf8 \strokec8 20\cf0 \strokec4 , \cf5 \strokec5 COLORS\cf0 \strokec4 .primary); \}\cb1 \
\cb3       \cf2 \strokec2 const\cf0 \strokec4  boyX = \cf5 \strokec5 LOGIC_W\cf0 \strokec4  * \cf8 \strokec8 0.3\cf0 \strokec4 , girlX = \cf5 \strokec5 LOGIC_W\cf0 \strokec4  * \cf8 \strokec8 0.7\cf0 \strokec4 , charY = \cf8 \strokec8 450\cf0 \strokec4 ; drawBean(boyX, charY, \cf2 \strokec2 false\cf0 \strokec4 ); drawBean(girlX, charY, \cf2 \strokec2 true\cf0 \strokec4 );\cb1 \
\cb3       drawRect(\cf8 \strokec8 20\cf0 \strokec4 , \cf8 \strokec8 500\cf0 \strokec4 , \cf5 \strokec5 LOGIC_W\cf0 \strokec4  - \cf8 \strokec8 40\cf0 \strokec4 , \cf8 \strokec8 150\cf0 \strokec4 , \cf6 \strokec6 '#8b4513'\cf0 \strokec4 , \cf8 \strokec8 10\cf0 \strokec4 ); drawCircle(\cf5 \strokec5 LOGIC_W\cf0 \strokec4  * \cf8 \strokec8 0.3\cf0 \strokec4 , \cf8 \strokec8 530\cf0 \strokec4 , \cf8 \strokec8 30\cf0 \strokec4 , \cf6 \strokec6 '#ddd'\cf0 \strokec4 ); drawCircle(\cf5 \strokec5 LOGIC_W\cf0 \strokec4  * \cf8 \strokec8 0.7\cf0 \strokec4 , \cf8 \strokec8 530\cf0 \strokec4 , \cf8 \strokec8 30\cf0 \strokec4 , \cf6 \strokec6 '#ddd'\cf0 \strokec4 ); drawText(\cf6 \strokec6 "\uc0\u31354 \u30424 "\cf0 \strokec4 , \cf5 \strokec5 LOGIC_W\cf0 \strokec4  * \cf8 \strokec8 0.3\cf0 \strokec4 , \cf8 \strokec8 535\cf0 \strokec4 , \cf8 \strokec8 12\cf0 \strokec4 , \cf6 \strokec6 '#aaa'\cf0 \strokec4 );\cb1 \
\cb3       drawRect(\cf8 \strokec8 20\cf0 \strokec4 , \cf8 \strokec8 60\cf0 \strokec4 , \cf5 \strokec5 LOGIC_W\cf0 \strokec4  - \cf8 \strokec8 40\cf0 \strokec4 , \cf8 \strokec8 120\cf0 \strokec4 , \cf6 \strokec6 '#fff'\cf0 \strokec4 , \cf8 \strokec8 10\cf0 \strokec4 ); ctx.strokeStyle = \cf6 \strokec6 '#333'\cf0 \strokec4 ; ctx.lineWidth = \cf8 \strokec8 2\cf0 \strokec4 ; ctx.strokeRect(\cf8 \strokec8 20\cf0 \strokec4 , \cf8 \strokec8 60\cf0 \strokec4 , \cf5 \strokec5 LOGIC_W\cf0 \strokec4  - \cf8 \strokec8 40\cf0 \strokec4 , \cf8 \strokec8 120\cf0 \strokec4 );\cb1 \
\cb3       s.billTimer++;\cb1 \
\cb3       \cf2 \strokec2 let\cf0 \strokec4  msg = \cf6 \strokec6 ""\cf0 \strokec4 ;\cb1 \
\cb3       \cf7 \strokec7 // 120, 360, 600\cf0 \cb1 \strokec4 \
\cb3       \cf2 \strokec2 if\cf0 \strokec4  (s.billTimer < \cf8 \strokec8 120\cf0 \strokec4 ) msg = \cf6 \strokec6 ""\cf0 \strokec4 ; \cf2 \strokec2 else\cf0 \strokec4  \cf2 \strokec2 if\cf0 \strokec4  (s.billTimer < \cf8 \strokec8 360\cf0 \strokec4 ) msg = \cf6 \strokec6 "\uc0\u22905 \u65306 \u20170 \u22825 \u21507 \u24471 \u22909 \u39281 \u21568 ~ \u21619 \u36947 \u30495 \u19981 \u38169 \u65281 "\cf0 \strokec4 ;\cb1 \
\cb3       \cf2 \strokec2 else\cf0 \strokec4  \cf2 \strokec2 if\cf0 \strokec4  (s.billTimer < \cf8 \strokec8 600\cf0 \strokec4 ) \{\cb1 \
\cb3         msg = \cf6 \strokec6 "\uc0\u65288 \u26381 \u21153 \u21592 \u25343 \u30528 \u36134 \u21333 \u24930 \u24930 \u36208 \u36807 \u26469 \u20102 ...\u65289 "\cf0 \strokec4 ;\cb1 \
\cb3         \cf2 \strokec2 let\cf0 \strokec4  wX = (\cf5 \strokec5 LOGIC_W\cf0 \strokec4  + \cf8 \strokec8 100\cf0 \strokec4 ) - (s.billTimer - \cf8 \strokec8 360\cf0 \strokec4 ) * \cf8 \strokec8 1.5\cf0 \strokec4 ; \cf2 \strokec2 if\cf0 \strokec4  (wX < \cf5 \strokec5 LOGIC_W\cf0 \strokec4  - \cf8 \strokec8 80\cf0 \strokec4 ) wX = \cf5 \strokec5 LOGIC_W\cf0 \strokec4  - \cf8 \strokec8 80\cf0 \strokec4 ;\cb1 \
\cb3         s.waiterX = wX; drawBean(wX, \cf8 \strokec8 350\cf0 \strokec4 , \cf2 \strokec2 false\cf0 \strokec4 , \cf6 \strokec6 'normal'\cf0 \strokec4 , \cf8 \strokec8 0.8\cf0 \strokec4 ); drawRect(wX - \cf8 \strokec8 12\cf0 \strokec4 , \cf8 \strokec8 365\cf0 \strokec4 , \cf8 \strokec8 24\cf0 \strokec4 , \cf8 \strokec8 30\cf0 \strokec4 , \cf6 \strokec6 '#fff'\cf0 \strokec4 , \cf8 \strokec8 2\cf0 \strokec4 );\cb1 \
\cb3       \} \cf2 \strokec2 else\cf0 \strokec4  \{ msg = \cf6 \strokec6 "\uc0\u26381 \u21153 \u21592 \u65306 \u20320 \u22909 \u65292 \u35831 \u38382 \u36825 \u36793 \u20080 \u21333 \u21527 \u65311 "\cf0 \strokec4 ; s.showDinnerOptions = \cf2 \strokec2 true\cf0 \strokec4 ; \}\cb1 \
\cb3       \cf2 \strokec2 if\cf0 \strokec4  (msg) drawText(typeText(msg, \cf8 \strokec8 5\cf0 \strokec4 ), \cf8 \strokec8 40\cf0 \strokec4 , \cf8 \strokec8 100\cf0 \strokec4 , \cf8 \strokec8 20\cf0 \strokec4 , \cf6 \strokec6 '#333'\cf0 \strokec4 , \cf6 \strokec6 'left'\cf0 \strokec4 );\cb1 \
\cb3       \cf2 \strokec2 if\cf0 \strokec4  (s.showDinnerOptions) \{\cb1 \
\cb3         \cf2 \strokec2 if\cf0 \strokec4  (f.paidSecretly) \{\cb1 \
\cb3           drawRect(\cf8 \strokec8 20\cf0 \strokec4 , \cf8 \strokec8 60\cf0 \strokec4 , \cf5 \strokec5 LOGIC_W\cf0 \strokec4  - \cf8 \strokec8 40\cf0 \strokec4 , \cf8 \strokec8 120\cf0 \strokec4 , \cf6 \strokec6 '#fff'\cf0 \strokec4 , \cf8 \strokec8 10\cf0 \strokec4 ); drawText(\cf6 \strokec6 "\uc0\u25105 \u65306 \u21018 \u25165 \u21435 \u27927 \u25163 \u38388 \u30340 \u26102 \u20505 \u24050 \u32463 \u32467 \u36807 \u20102 \u12290 "\cf0 \strokec4 , \cf8 \strokec8 40\cf0 \strokec4 , \cf8 \strokec8 100\cf0 \strokec4 , \cf8 \strokec8 20\cf0 \strokec4 , \cf6 \strokec6 '#333'\cf0 \strokec4 , \cf6 \strokec6 'left'\cf0 \strokec4 );\cb1 \
\cb3           \cf2 \strokec2 if\cf0 \strokec4  (s.billTimer > \cf8 \strokec8 800\cf0 \strokec4 ) transitionTo(\cf5 \strokec5 STATE\cf0 \strokec4 .\cf5 \strokec5 SCENE_3_WALK\cf0 \strokec4 );\cb1 \
\cb3         \} \cf2 \strokec2 else\cf0 \strokec4  \{\cb1 \
\cb3           \cf2 \strokec2 const\cf0 \strokec4  btnW = \cf8 \strokec8 180\cf0 \strokec4 ; drawButton(\cf6 \strokec6 "\uc0\u25105 \u26469 \u20080 \u21543 "\cf0 \strokec4 , (\cf5 \strokec5 LOGIC_W\cf0 \strokec4  - btnW)/\cf8 \strokec8 2\cf0 \strokec4 , \cf8 \strokec8 680\cf0 \strokec4 , btnW, \cf8 \strokec8 50\cf0 \strokec4 , () => \{ s.score = \cf8 \strokec8 4\cf0 \strokec4 ; transitionTo(\cf5 \strokec5 STATE\cf0 \strokec4 .\cf5 \strokec5 ENDING\cf0 \strokec4 ); \});\cb1 \
\cb3           drawButton(\cf6 \strokec6 "\uc0\u25105 \u20204 \u35201 AA\u21527 \u65311 "\cf0 \strokec4 , (\cf5 \strokec5 LOGIC_W\cf0 \strokec4  - btnW)/\cf8 \strokec8 2\cf0 \strokec4 , \cf8 \strokec8 740\cf0 \strokec4 , btnW, \cf8 \strokec8 50\cf0 \strokec4 , () => \{ s.score = \cf8 \strokec8 0\cf0 \strokec4 ; transitionTo(\cf5 \strokec5 STATE\cf0 \strokec4 .\cf5 \strokec5 ENDING\cf0 \strokec4 ); \});\cb1 \
\cb3         \}\cb1 \
\cb3       \}\cb1 \
\cb3     \};\cb1 \
\
\cb3     \cf2 \strokec2 const\cf0 \strokec4  updateScene3 = () => \{\cb1 \
\cb3       \cf2 \strokec2 const\cf0 \strokec4  s = gameState.current; \cf2 \strokec2 const\cf0 \strokec4  f = s.flags;\cb1 \
\cb3       ctx.fillStyle = \cf6 \strokec6 '#2c3e50'\cf0 \strokec4 ; ctx.fillRect(\cf8 \strokec8 0\cf0 \strokec4 , \cf8 \strokec8 0\cf0 \strokec4 , \cf5 \strokec5 LOGIC_W\cf0 \strokec4 , \cf5 \strokec5 LOGIC_H\cf0 \strokec4 ); ctx.fillStyle = \cf6 \strokec6 'rgba(255,255,255,0.5)'\cf0 \strokec4 ; \cf2 \strokec2 for\cf0 \strokec4 (\cf2 \strokec2 let\cf0 \strokec4  i=\cf8 \strokec8 0\cf0 \strokec4 ; i<\cf8 \strokec8 10\cf0 \strokec4 ; i++) drawCircle((s.frameCount * \cf8 \strokec8 2\cf0 \strokec4  + i * \cf8 \strokec8 50\cf0 \strokec4 ) % \cf5 \strokec5 LOGIC_W\cf0 \strokec4 , (s.frameCount * \cf8 \strokec8 3\cf0 \strokec4  + i * \cf8 \strokec8 80\cf0 \strokec4 ) % \cf5 \strokec5 LOGIC_H\cf0 \strokec4 , \cf8 \strokec8 2\cf0 \strokec4 , \cf6 \strokec6 '#fff'\cf0 \strokec4 ); ctx.fillStyle = \cf6 \strokec6 '#34495e'\cf0 \strokec4 ; ctx.fillRect(\cf8 \strokec8 0\cf0 \strokec4 , \cf8 \strokec8 550\cf0 \strokec4 , \cf5 \strokec5 LOGIC_W\cf0 \strokec4 , \cf8 \strokec8 250\cf0 \strokec4 );\cb1 \
\cb3       \cf2 \strokec2 const\cf0 \strokec4  centerX = \cf5 \strokec5 LOGIC_W\cf0 \strokec4  / \cf8 \strokec8 2\cf0 \strokec4 , charY = \cf8 \strokec8 500\cf0 \strokec4 ; \cf2 \strokec2 let\cf0 \strokec4  shake = \cf8 \strokec8 0\cf0 \strokec4 ; \cf2 \strokec2 if\cf0 \strokec4  (s.walkTimer > \cf8 \strokec8 100\cf0 \strokec4 ) shake = \cf5 \strokec5 Math\cf0 \strokec4 .sin(s.frameCount * \cf8 \strokec8 0.5\cf0 \strokec4 ) * \cf8 \strokec8 2\cf0 \strokec4 ;\cb1 \
\cb3       drawBean(centerX + \cf8 \strokec8 50\cf0 \strokec4  + shake, charY, \cf2 \strokec2 true\cf0 \strokec4 , \cf6 \strokec6 'normal'\cf0 \strokec4 , \cf8 \strokec8 1\cf0 \strokec4 , \cf2 \strokec2 true\cf0 \strokec4 ); ctx.fillStyle = \cf6 \strokec6 '#ffcccc'\cf0 \strokec4 ; ctx.beginPath(); ctx.ellipse(centerX + \cf8 \strokec8 50\cf0 \strokec4  + shake, charY + \cf8 \strokec8 50\cf0 \strokec4 , \cf8 \strokec8 20\cf0 \strokec4 , \cf8 \strokec8 40\cf0 \strokec4 , \cf8 \strokec8 0\cf0 \strokec4 , \cf8 \strokec8 0\cf0 \strokec4 , \cf5 \strokec5 Math\cf0 \strokec4 .\cf5 \strokec5 PI\cf0 \strokec4 *\cf8 \strokec8 2\cf0 \strokec4 ); ctx.fill(); drawBean(centerX - \cf8 \strokec8 50\cf0 \strokec4 , charY, \cf2 \strokec2 false\cf0 \strokec4 );\cb1 \
\cb3       \cf2 \strokec2 let\cf0 \strokec4  coatColor = \cf6 \strokec6 '#8e44ad'\cf0 \strokec4 ;\cb1 \
\cb3       \cf2 \strokec2 if\cf0 \strokec4  (isHover(centerX - \cf8 \strokec8 80\cf0 \strokec4 , charY, \cf8 \strokec8 60\cf0 \strokec4 , \cf8 \strokec8 100\cf0 \strokec4 ) && !f.gaveCoat && s.walkTimer > \cf8 \strokec8 100\cf0 \strokec4 ) \{ coatColor = \cf6 \strokec6 '#9b59b6'\cf0 \strokec4 ; canvas.style.cursor = \cf6 \strokec6 'pointer'\cf0 \strokec4 ; \cf2 \strokec2 if\cf0 \strokec4  (s.mouse.clicked) \{ f.gaveCoat = \cf2 \strokec2 true\cf0 \strokec4 ; s.mouse.clicked = \cf2 \strokec2 false\cf0 \strokec4 ; s.score += \cf8 \strokec8 2\cf0 \strokec4 ; s.coatClickTime = s.walkTimer; \} \}\cb1 \
\cb3       \cf2 \strokec2 if\cf0 \strokec4  (!f.gaveCoat) \{ ctx.fillStyle = coatColor; ctx.beginPath(); ctx.ellipse(centerX - \cf8 \strokec8 50\cf0 \strokec4 , charY + \cf8 \strokec8 50\cf0 \strokec4 , \cf8 \strokec8 25\cf0 \strokec4 , \cf8 \strokec8 45\cf0 \strokec4 , \cf8 \strokec8 0\cf0 \strokec4 , \cf8 \strokec8 0\cf0 \strokec4 , \cf5 \strokec5 Math\cf0 \strokec4 .\cf5 \strokec5 PI\cf0 \strokec4 *\cf8 \strokec8 2\cf0 \strokec4 ); ctx.fill(); \} \cf2 \strokec2 else\cf0 \strokec4  \{ ctx.fillStyle = \cf6 \strokec6 '#bdc3c7'\cf0 \strokec4 ; ctx.beginPath(); ctx.ellipse(centerX - \cf8 \strokec8 50\cf0 \strokec4 , charY + \cf8 \strokec8 50\cf0 \strokec4 , \cf8 \strokec8 20\cf0 \strokec4 , \cf8 \strokec8 40\cf0 \strokec4 , \cf8 \strokec8 0\cf0 \strokec4 , \cf8 \strokec8 0\cf0 \strokec4 , \cf5 \strokec5 Math\cf0 \strokec4 .\cf5 \strokec5 PI\cf0 \strokec4 *\cf8 \strokec8 2\cf0 \strokec4 ); ctx.fill(); ctx.fillStyle = coatColor; ctx.beginPath(); ctx.ellipse(centerX + \cf8 \strokec8 50\cf0 \strokec4  + shake, charY + \cf8 \strokec8 55\cf0 \strokec4 , \cf8 \strokec8 28\cf0 \strokec4 , \cf8 \strokec8 48\cf0 \strokec4 , \cf8 \strokec8 0\cf0 \strokec4 , \cf8 \strokec8 0\cf0 \strokec4 , \cf5 \strokec5 Math\cf0 \strokec4 .\cf5 \strokec5 PI\cf0 \strokec4 *\cf8 \strokec8 2\cf0 \strokec4 ); ctx.fill(); \}\cb1 \
\cb3       drawRect(\cf8 \strokec8 20\cf0 \strokec4 , \cf8 \strokec8 60\cf0 \strokec4 , \cf5 \strokec5 LOGIC_W\cf0 \strokec4  - \cf8 \strokec8 40\cf0 \strokec4 , \cf8 \strokec8 120\cf0 \strokec4 , \cf6 \strokec6 '#fff'\cf0 \strokec4 , \cf8 \strokec8 10\cf0 \strokec4 ); s.walkTimer++;\cb1 \
\cb3       \cf2 \strokec2 let\cf0 \strokec4  msg = \cf6 \strokec6 ""\cf0 \strokec4 ; \cf2 \strokec2 if\cf0 \strokec4  (s.walkTimer < \cf8 \strokec8 180\cf0 \strokec4 ) msg = \cf6 \strokec6 "\uc0\u65288 \u36208 \u22312 \u22238 \u23478 \u30340 \u36335 \u19978 \u65292 \u39118 \u31361 \u28982 \u22823 \u20102 \u36215 \u26469 ...\u65289 "\cf0 \strokec4 ; \cf2 \strokec2 else\cf0 \strokec4  \cf2 \strokec2 if\cf0 \strokec4  (s.walkTimer < \cf8 \strokec8 420\cf0 \strokec4 ) msg = \cf6 \strokec6 "\uc0\u22905 \u65306 \u22070 ... \u22909 \u20919 \u21834 ..."\cf0 \strokec4 ; \cf2 \strokec2 else\cf0 \strokec4  \cf2 \strokec2 if\cf0 \strokec4  (!f.gaveCoat) msg = \cf6 \strokec6 "\uc0\u25105 \u24212 \u35813 ..."\cf0 \strokec4 ; \cf2 \strokec2 else\cf0 \strokec4  msg = \cf6 \strokec6 "\uc0\u25105 \u65306 \u65288 \u40664 \u40664 \u33073 \u19979 \u22806 \u22871 \u25259 \u22312 \u22905 \u36523 \u19978 \u65289 "\cf0 \strokec4 ;\cb1 \
\cb3       drawText(typeText(msg, \cf8 \strokec8 5\cf0 \strokec4 ), \cf8 \strokec8 40\cf0 \strokec4 , \cf8 \strokec8 100\cf0 \strokec4 , \cf8 \strokec8 20\cf0 \strokec4 , \cf6 \strokec6 '#333'\cf0 \strokec4 , \cf6 \strokec6 'left'\cf0 \strokec4 );\cb1 \
\cb3       \cf2 \strokec2 if\cf0 \strokec4  (s.walkTimer >= \cf8 \strokec8 420\cf0 \strokec4  && !f.gaveCoat) \{\cb1 \
\cb3         \cf2 \strokec2 const\cf0 \strokec4  btnW = \cf8 \strokec8 220\cf0 \strokec4 ; drawButton(\cf6 \strokec6 "\uc0\u38382 \u22905 \u65306 \u20320 \u20919 \u21527 \u65311 "\cf0 \strokec4 , (\cf5 \strokec5 LOGIC_W\cf0 \strokec4  - btnW)/\cf8 \strokec8 2\cf0 \strokec4 , \cf8 \strokec8 650\cf0 \strokec4 , btnW, \cf8 \strokec8 50\cf0 \strokec4 , () => \{ s.score = \cf8 \strokec8 4\cf0 \strokec4 ; transitionTo(\cf5 \strokec5 STATE\cf0 \strokec4 .\cf5 \strokec5 ENDING\cf0 \strokec4 ); \});\cb1 \
\cb3         drawButton(\cf6 \strokec6 "\uc0\u35828 \u65306 \u22362 \u25345 \u19968 \u19979 \u23601 \u21040 \u20102 "\cf0 \strokec4 , (\cf5 \strokec5 LOGIC_W\cf0 \strokec4  - btnW)/\cf8 \strokec8 2\cf0 \strokec4 , \cf8 \strokec8 710\cf0 \strokec4 , btnW, \cf8 \strokec8 50\cf0 \strokec4 , () => \{ s.score = \cf8 \strokec8 0\cf0 \strokec4 ; transitionTo(\cf5 \strokec5 STATE\cf0 \strokec4 .\cf5 \strokec5 ENDING\cf0 \strokec4 ); \});\cb1 \
\cb3       \} \cf2 \strokec2 else\cf0 \strokec4  \cf2 \strokec2 if\cf0 \strokec4  (f.gaveCoat) \{ \cf2 \strokec2 if\cf0 \strokec4  (s.walkTimer > s.coatClickTime + \cf8 \strokec8 250\cf0 \strokec4 ) \{ transitionTo(\cf5 \strokec5 STATE\cf0 \strokec4 .\cf5 \strokec5 SCENE_HOME_TV\cf0 \strokec4 ); \} \}\cb1 \
\cb3     \};\cb1 \
\
\cb3     \cf2 \strokec2 const\cf0 \strokec4  updateSceneHomeTV = () => \{\cb1 \
\cb3         \cf2 \strokec2 const\cf0 \strokec4  s = gameState.current; \cf2 \strokec2 const\cf0 \strokec4  f = s.flags; \cf2 \strokec2 const\cf0 \strokec4  h = s.homeTv; h.timer++;\cb1 \
\cb3         \cf2 \strokec2 let\cf0 \strokec4  darkness = \cf5 \strokec5 Math\cf0 \strokec4 .min(\cf8 \strokec8 1\cf0 \strokec4 , h.timer / \cf8 \strokec8 400\cf0 \strokec4 ); \cf2 \strokec2 const\cf0 \strokec4  r = \cf8 \strokec8 255\cf0 \strokec4  - darkness * \cf8 \strokec8 50\cf0 \strokec4 , g = \cf8 \strokec8 240\cf0 \strokec4  - darkness * \cf8 \strokec8 60\cf0 \strokec4 , b = \cf8 \strokec8 230\cf0 \strokec4  - darkness * \cf8 \strokec8 70\cf0 \strokec4 ; ctx.fillStyle = \cf6 \strokec6 `rgb(\cf0 \strokec4 $\{r\}\cf6 \strokec6 , \cf0 \strokec4 $\{g\}\cf6 \strokec6 , \cf0 \strokec4 $\{b\}\cf6 \strokec6 )`\cf0 \strokec4 ; ctx.fillRect(\cf8 \strokec8 0\cf0 \strokec4 , \cf8 \strokec8 0\cf0 \strokec4 , \cf5 \strokec5 LOGIC_W\cf0 \strokec4 , \cf5 \strokec5 LOGIC_H\cf0 \strokec4 );\cb1 \
\cb3         \cf2 \strokec2 const\cf0 \strokec4  winW = \cf8 \strokec8 200\cf0 \strokec4 , winH = \cf8 \strokec8 150\cf0 \strokec4 ; ctx.fillStyle = \cf6 \strokec6 '#87CEEB'\cf0 \strokec4 ; \cf2 \strokec2 if\cf0 \strokec4  (h.timer > \cf8 \strokec8 0\cf0 \strokec4 ) \{ \cf2 \strokec2 const\cf0 \strokec4  nr = \cf8 \strokec8 135\cf0 \strokec4  * (\cf8 \strokec8 1\cf0 \strokec4  - darkness) + \cf8 \strokec8 44\cf0 \strokec4  * darkness; \cf2 \strokec2 const\cf0 \strokec4  ng = \cf8 \strokec8 206\cf0 \strokec4  * (\cf8 \strokec8 1\cf0 \strokec4  - darkness) + \cf8 \strokec8 62\cf0 \strokec4  * darkness; \cf2 \strokec2 const\cf0 \strokec4  nb = \cf8 \strokec8 235\cf0 \strokec4  * (\cf8 \strokec8 1\cf0 \strokec4  - darkness) + \cf8 \strokec8 80\cf0 \strokec4  * darkness; ctx.fillStyle = \cf6 \strokec6 `rgb(\cf0 \strokec4 $\{nr\}\cf6 \strokec6 , \cf0 \strokec4 $\{ng\}\cf6 \strokec6 , \cf0 \strokec4 $\{nb\}\cf6 \strokec6 )`\cf0 \strokec4 ; \} ctx.fillRect(\cf8 \strokec8 50\cf0 \strokec4 , \cf8 \strokec8 100\cf0 \strokec4 , winW, winH); ctx.strokeStyle = \cf6 \strokec6 '#fff'\cf0 \strokec4 ; ctx.lineWidth = \cf8 \strokec8 5\cf0 \strokec4 ; ctx.strokeRect(\cf8 \strokec8 50\cf0 \strokec4 , \cf8 \strokec8 100\cf0 \strokec4 , winW, winH); ctx.beginPath(); ctx.moveTo(\cf8 \strokec8 50\cf0 \strokec4  + winW/\cf8 \strokec8 2\cf0 \strokec4 , \cf8 \strokec8 100\cf0 \strokec4 ); ctx.lineTo(\cf8 \strokec8 50\cf0 \strokec4  + winW/\cf8 \strokec8 2\cf0 \strokec4 , \cf8 \strokec8 100\cf0 \strokec4  + winH); ctx.stroke(); ctx.beginPath(); ctx.moveTo(\cf8 \strokec8 50\cf0 \strokec4 , \cf8 \strokec8 100\cf0 \strokec4  + winH/\cf8 \strokec8 2\cf0 \strokec4 ); ctx.lineTo(\cf8 \strokec8 50\cf0 \strokec4  + winW, \cf8 \strokec8 100\cf0 \strokec4  + winH/\cf8 \strokec8 2\cf0 \strokec4 ); ctx.stroke();\cb1 \
\cb3         ctx.fillStyle = \cf6 \strokec6 '#333'\cf0 \strokec4 ; drawRect(\cf5 \strokec5 LOGIC_W\cf0 \strokec4  - \cf8 \strokec8 120\cf0 \strokec4 , \cf8 \strokec8 200\cf0 \strokec4 , \cf8 \strokec8 120\cf0 \strokec4 , \cf8 \strokec8 80\cf0 \strokec4 , \cf6 \strokec6 '#000'\cf0 \strokec4 , \cf8 \strokec8 5\cf0 \strokec4 ); ctx.fillStyle = \cf6 \strokec6 `rgba(200, 230, 255, \cf0 \strokec4 $\{\cf8 \strokec8 0.2\cf0 \strokec4  + \cf5 \strokec5 Math\cf0 \strokec4 .random() * \cf8 \strokec8 0.3\cf0 \strokec4 \}\cf6 \strokec6 )`\cf0 \strokec4 ; ctx.fillRect(\cf5 \strokec5 LOGIC_W\cf0 \strokec4  - \cf8 \strokec8 115\cf0 \strokec4 , \cf8 \strokec8 205\cf0 \strokec4 , \cf8 \strokec8 110\cf0 \strokec4 , \cf8 \strokec8 70\cf0 \strokec4 );\cb1 \
\cb3         \cf2 \strokec2 const\cf0 \strokec4  sofaY = \cf8 \strokec8 400\cf0 \strokec4 ; drawRect(\cf8 \strokec8 50\cf0 \strokec4 , sofaY, \cf8 \strokec8 300\cf0 \strokec4 , \cf8 \strokec8 100\cf0 \strokec4 , \cf6 \strokec6 '#d35400'\cf0 \strokec4 , \cf8 \strokec8 20\cf0 \strokec4 ); drawRect(\cf8 \strokec8 30\cf0 \strokec4 , sofaY + \cf8 \strokec8 60\cf0 \strokec4 , \cf8 \strokec8 340\cf0 \strokec4 , \cf8 \strokec8 60\cf0 \strokec4 , \cf6 \strokec6 '#e67e22'\cf0 \strokec4 , \cf8 \strokec8 20\cf0 \strokec4 ); drawBean(\cf8 \strokec8 130\cf0 \strokec4 , sofaY + \cf8 \strokec8 30\cf0 \strokec4 , \cf2 \strokec2 false\cf0 \strokec4 ); drawBean(\cf8 \strokec8 230\cf0 \strokec4 , sofaY + \cf8 \strokec8 30\cf0 \strokec4 , \cf2 \strokec2 true\cf0 \strokec4 , \cf6 \strokec6 'normal'\cf0 \strokec4 , \cf8 \strokec8 1\cf0 \strokec4 , \cf2 \strokec2 true\cf0 \strokec4 );\cb1 \
\cb3         \cf2 \strokec2 const\cf0 \strokec4  tableY = \cf8 \strokec8 550\cf0 \strokec4 ; drawRect(\cf8 \strokec8 50\cf0 \strokec4 , tableY, \cf8 \strokec8 300\cf0 \strokec4 , \cf8 \strokec8 100\cf0 \strokec4 , \cf6 \strokec6 '#8b4513'\cf0 \strokec4 , \cf8 \strokec8 5\cf0 \strokec4 );\cb1 \
\cb3         \cf2 \strokec2 const\cf0 \strokec4  lipX = \cf8 \strokec8 250\cf0 \strokec4 , lipY = tableY + \cf8 \strokec8 20\cf0 \strokec4 , lipW = \cf8 \strokec8 20\cf0 \strokec4 , lipH = \cf8 \strokec8 40\cf0 \strokec4 ;\cb1 \
\cb3         \cf2 \strokec2 if\cf0 \strokec4  (!f.usedLipstick && h.timer > \cf8 \strokec8 60\cf0 \strokec4  && !h.reaction.active) \{ \cf2 \strokec2 if\cf0 \strokec4  (isHover(lipX - \cf8 \strokec8 40\cf0 \strokec4 , lipY - \cf8 \strokec8 40\cf0 \strokec4 , lipW + \cf8 \strokec8 80\cf0 \strokec4 , lipH + \cf8 \strokec8 80\cf0 \strokec4 )) \{ canvas.style.cursor = \cf6 \strokec6 'pointer'\cf0 \strokec4 ; \cf2 \strokec2 if\cf0 \strokec4  (s.mouse.clicked) \{ s.mouse.clicked = \cf2 \strokec2 false\cf0 \strokec4 ; f.usedLipstick = \cf2 \strokec2 true\cf0 \strokec4 ; h.lipstickClickFrame = h.timer; s.score += \cf8 \strokec8 2\cf0 \strokec4 ; \} \} \}\cb1 \
\cb3         ctx.fillStyle = \cf6 \strokec6 '#ffc0cb'\cf0 \strokec4 ; ctx.fillRect(lipX, lipY, lipW, lipH); ctx.fillStyle = \cf6 \strokec6 '#555'\cf0 \strokec4 ; ctx.fillRect(lipX, lipY + \cf8 \strokec8 20\cf0 \strokec4 , lipW, \cf8 \strokec8 10\cf0 \strokec4 );\cb1 \
\cb3         drawRect(\cf8 \strokec8 20\cf0 \strokec4 , \cf8 \strokec8 60\cf0 \strokec4 , \cf5 \strokec5 LOGIC_W\cf0 \strokec4  - \cf8 \strokec8 40\cf0 \strokec4 , \cf8 \strokec8 120\cf0 \strokec4 , \cf6 \strokec6 '#fff'\cf0 \strokec4 , \cf8 \strokec8 10\cf0 \strokec4 ); ctx.strokeStyle = \cf6 \strokec6 '#333'\cf0 \strokec4 ; ctx.lineWidth = \cf8 \strokec8 2\cf0 \strokec4 ; ctx.strokeRect(\cf8 \strokec8 20\cf0 \strokec4 , \cf8 \strokec8 60\cf0 \strokec4 , \cf5 \strokec5 LOGIC_W\cf0 \strokec4  - \cf8 \strokec8 40\cf0 \strokec4 , \cf8 \strokec8 120\cf0 \strokec4 );\cb1 \
\cb3         \cf2 \strokec2 let\cf0 \strokec4  msg = \cf6 \strokec6 ""\cf0 \strokec4 ;\cb1 \
\cb3         \cf2 \strokec2 if\cf0 \strokec4  (h.reaction.active) \{ msg = h.reaction.text; h.reaction.timer++; \cf2 \strokec2 if\cf0 \strokec4  (h.reaction.timer > \cf8 \strokec8 180\cf0 \strokec4 ) transitionTo(\cf5 \strokec5 STATE\cf0 \strokec4 .\cf5 \strokec5 ENDING\cf0 \strokec4 ); \}\cb1 \
\cb3         \cf2 \strokec2 else\cf0 \strokec4  \cf2 \strokec2 if\cf0 \strokec4  (f.usedLipstick) \{ \cf2 \strokec2 let\cf0 \strokec4  dt = h.timer - h.lipstickClickFrame; \cf2 \strokec2 if\cf0 \strokec4  (dt < \cf8 \strokec8 150\cf0 \strokec4 ) msg = \cf6 \strokec6 "\uc0\u25105 \u65306 \u20837 \u20908 \u20102 \u65292 \u22068 \u21767 \u31245 \u24494 \u26377 \u28857 \u24178 ..."\cf0 \strokec4 ; \cf2 \strokec2 else\cf0 \strokec4  \{ msg = \cf6 \strokec6 "\uc0\u22905 \u65306 \u65288 \u25343 \u36215 \u21767 \u33167 \u65289 \u21035 \u21160 \u65292 \u25105 \u24110 \u20320 \u28034 \u12290 "\cf0 \strokec4 ; ctx.save(); ctx.translate(\cf5 \strokec5 LOGIC_W\cf0 \strokec4  / \cf8 \strokec8 2\cf0 \strokec4 , \cf8 \strokec8 300\cf0 \strokec4 ); ctx.scale(\cf8 \strokec8 1\cf0 \strokec4  + \cf5 \strokec5 Math\cf0 \strokec4 .sin(s.frameCount*\cf8 \strokec8 0.1\cf0 \strokec4 )*\cf8 \strokec8 0.2\cf0 \strokec4 , \cf8 \strokec8 1\cf0 \strokec4  + \cf5 \strokec5 Math\cf0 \strokec4 .sin(s.frameCount*\cf8 \strokec8 0.1\cf0 \strokec4 )*\cf8 \strokec8 0.2\cf0 \strokec4 ); drawText(\cf6 \strokec6 "\uc0\u10084 "\cf0 \strokec4 , \cf8 \strokec8 0\cf0 \strokec4 , \cf8 \strokec8 0\cf0 \strokec4 , \cf8 \strokec8 50\cf0 \strokec4 , \cf5 \strokec5 COLORS\cf0 \strokec4 .primary); ctx.restore(); \} \cf2 \strokec2 if\cf0 \strokec4  (dt > \cf8 \strokec8 360\cf0 \strokec4 ) transitionTo(\cf5 \strokec5 STATE\cf0 \strokec4 .\cf5 \strokec5 SCENE_4_DATE\cf0 \strokec4 ); \}\cb1 \
\cb3         \cf2 \strokec2 else\cf0 \strokec4  \{ \cf2 \strokec2 if\cf0 \strokec4  (h.timer < \cf8 \strokec8 180\cf0 \strokec4 ) msg = \cf6 \strokec6 "\uc0\u65288 \u19981 \u30693 \u19981 \u35273 \u65292 \u22825 \u33394 \u28176 \u26202 \u65292 \u30005 \u24433 \u20063 \u24555 \u25918 \u23436 \u20102 ...\u65289 "\cf0 \strokec4 ; \cf2 \strokec2 else\cf0 \strokec4  \cf2 \strokec2 if\cf0 \strokec4  (h.timer > \cf8 \strokec8 300\cf0 \strokec4 ) \{ msg = \cf6 \strokec6 "\uc0\u25105 \u24212 \u35813 ..."\cf0 \strokec4 ; h.showOptions = \cf2 \strokec2 true\cf0 \strokec4 ; \} \}\cb1 \
\cb3         drawText(typeText(msg, \cf8 \strokec8 5\cf0 \strokec4 ), \cf8 \strokec8 40\cf0 \strokec4 , \cf8 \strokec8 100\cf0 \strokec4 , \cf8 \strokec8 20\cf0 \strokec4 , h.reaction.active && h.reaction.color === \cf6 \strokec6 'red'\cf0 \strokec4  ? \cf6 \strokec6 'red'\cf0 \strokec4  : \cf6 \strokec6 '#333'\cf0 \strokec4 , \cf6 \strokec6 'left'\cf0 \strokec4 );\cb1 \
\cb3         \cf2 \strokec2 if\cf0 \strokec4  (h.showOptions && !f.usedLipstick && !h.reaction.active) \{\cb1 \
\cb3           \cf2 \strokec2 const\cf0 \strokec4  btnW = \cf8 \strokec8 240\cf0 \strokec4 ; drawButton(\cf6 \strokec6 "\uc0\u22825 \u33394 \u22826 \u26202 \u20102 \u65292 \u25105 \u20808 \u22238 \u23478 \u20102 "\cf0 \strokec4 , (\cf5 \strokec5 LOGIC_W\cf0 \strokec4  - btnW)/\cf8 \strokec8 2\cf0 \strokec4 , \cf8 \strokec8 680\cf0 \strokec4 , btnW, \cf8 \strokec8 50\cf0 \strokec4 , () => \{ h.reaction = \{ active: \cf2 \strokec2 true\cf0 \strokec4 , text: \cf6 \strokec6 "\uc0\u22905 \u65306 \u22909 \u65292 \u37027 \u20320 \u36335 \u19978 \u23567 \u24515 \u12290 "\cf0 \strokec4 , color: \cf6 \strokec6 "#333"\cf0 \strokec4 , timer: \cf8 \strokec8 0\cf0 \strokec4  \}; s.score = \cf8 \strokec8 4\cf0 \strokec4 ; \});\cb1 \
\cb3           drawButton(\cf6 \strokec6 "\uc0\u25105 \u33021 \u22312 \u20320 \u23478 \u36807 \u22812 \u21527 \u65311 "\cf0 \strokec4 , (\cf5 \strokec5 LOGIC_W\cf0 \strokec4  - btnW)/\cf8 \strokec8 2\cf0 \strokec4 , \cf8 \strokec8 740\cf0 \strokec4 , btnW, \cf8 \strokec8 50\cf0 \strokec4 , () => \{ h.reaction = \{ active: \cf2 \strokec2 true\cf0 \strokec4 , text: \cf6 \strokec6 "\uc0\u22905 \u65306 \u28378 \u55357 \u56865 \u65281 "\cf0 \strokec4 , color: \cf6 \strokec6 "red"\cf0 \strokec4 , timer: \cf8 \strokec8 0\cf0 \strokec4  \}; s.score = \cf8 \strokec8 0\cf0 \strokec4 ; \});\cb1 \
\cb3         \}\cb1 \
\cb3     \};\cb1 \
\
\cb3     \cf2 \strokec2 const\cf0 \strokec4  updateScene4Date = () => \{\cb1 \
\cb3         \cf2 \strokec2 const\cf0 \strokec4  s = gameState.current; s.date.timer++; \cf2 \strokec2 const\cf0 \strokec4  dt = s.date.timer;\cb1 \
\cb3         \cf2 \strokec2 const\cf0 \strokec4  grad = ctx.createLinearGradient(\cf8 \strokec8 0\cf0 \strokec4 , \cf8 \strokec8 0\cf0 \strokec4 , \cf8 \strokec8 0\cf0 \strokec4 , \cf5 \strokec5 LOGIC_H\cf0 \strokec4 ); grad.addColorStop(\cf8 \strokec8 0\cf0 \strokec4 , \cf6 \strokec6 '#fdfbf7'\cf0 \strokec4 ); grad.addColorStop(\cf8 \strokec8 1\cf0 \strokec4 , \cf6 \strokec6 '#ffd1dc'\cf0 \strokec4 ); ctx.fillStyle = grad; ctx.fillRect(\cf8 \strokec8 0\cf0 \strokec4 , \cf8 \strokec8 0\cf0 \strokec4 , \cf5 \strokec5 LOGIC_W\cf0 \strokec4 , \cf5 \strokec5 LOGIC_H\cf0 \strokec4 );\cb1 \
\cb3         \cf2 \strokec2 const\cf0 \strokec4  calW = \cf8 \strokec8 240\cf0 \strokec4 , calH = \cf8 \strokec8 300\cf0 \strokec4 , calX = (\cf5 \strokec5 LOGIC_W\cf0 \strokec4  - calW) / \cf8 \strokec8 2\cf0 \strokec4 , calY = \cf8 \strokec8 150\cf0 \strokec4 ;\cb1 \
\cb3         ctx.shadowBlur = \cf8 \strokec8 15\cf0 \strokec4 ; ctx.shadowColor = \cf6 \strokec6 'rgba(0,0,0,0.1)'\cf0 \strokec4 ; drawRect(calX, calY, calW, calH, \cf6 \strokec6 '#fff'\cf0 \strokec4 , \cf8 \strokec8 10\cf0 \strokec4 ); ctx.shadowBlur = \cf8 \strokec8 0\cf0 \strokec4 ;\cb1 \
\cb3         drawRect(calX, calY, calW, \cf8 \strokec8 60\cf0 \strokec4 , \cf6 \strokec6 '#e74c3c'\cf0 \strokec4 , \cf8 \strokec8 10\cf0 \strokec4 ); ctx.fillRect(calX, calY + \cf8 \strokec8 40\cf0 \strokec4 , calW, \cf8 \strokec8 20\cf0 \strokec4 );\cb1 \
\cb3         drawCircle(calX + \cf8 \strokec8 40\cf0 \strokec4 , calY + \cf8 \strokec8 30\cf0 \strokec4 , \cf8 \strokec8 8\cf0 \strokec4 , \cf6 \strokec6 '#333'\cf0 \strokec4 ); drawCircle(calX + \cf8 \strokec8 200\cf0 \strokec4 , calY + \cf8 \strokec8 30\cf0 \strokec4 , \cf8 \strokec8 8\cf0 \strokec4 , \cf6 \strokec6 '#333'\cf0 \strokec4 );\cb1 \
\cb3         drawText(\cf6 \strokec6 "2023"\cf0 \strokec4 , \cf5 \strokec5 LOGIC_W\cf0 \strokec4  / \cf8 \strokec8 2\cf0 \strokec4 , calY + \cf8 \strokec8 38\cf0 \strokec4 , \cf8 \strokec8 24\cf0 \strokec4 , \cf6 \strokec6 '#fff'\cf0 \strokec4 , \cf6 \strokec6 'center'\cf0 \strokec4 ); \cb1 \
\cb3         drawText(\cf6 \strokec6 "11\uc0\u26376 "\cf0 \strokec4 , calX + calW/\cf8 \strokec8 2\cf0 \strokec4 , calY + \cf8 \strokec8 120\cf0 \strokec4 , \cf8 \strokec8 40\cf0 \strokec4 , \cf6 \strokec6 '#333'\cf0 \strokec4 ); drawText(\cf6 \strokec6 "26"\cf0 \strokec4 , calX + calW/\cf8 \strokec8 2\cf0 \strokec4 , calY + \cf8 \strokec8 220\cf0 \strokec4 , \cf8 \strokec8 80\cf0 \strokec4 , \cf6 \strokec6 '#e74c3c'\cf0 \strokec4 , \cf6 \strokec6 'center'\cf0 \strokec4 , \cf6 \strokec6 'Arial'\cf0 \strokec4 );\cb1 \
\cb3         \cf2 \strokec2 const\cf0 \strokec4  boyX = \cf5 \strokec5 LOGIC_W\cf0 \strokec4 /\cf8 \strokec8 2\cf0 \strokec4  - \cf8 \strokec8 60\cf0 \strokec4 , girlX = \cf5 \strokec5 LOGIC_W\cf0 \strokec4 /\cf8 \strokec8 2\cf0 \strokec4  + \cf8 \strokec8 60\cf0 \strokec4 , charY = \cf8 \strokec8 540\cf0 \strokec4 ; \cf2 \strokec2 let\cf0 \strokec4  slide = \cf5 \strokec5 Math\cf0 \strokec4 .max(\cf8 \strokec8 0\cf0 \strokec4 , \cf8 \strokec8 50\cf0 \strokec4  - dt * \cf8 \strokec8 0.5\cf0 \strokec4 ); \cb1 \
\cb3         drawBean(boyX - slide, charY, \cf2 \strokec2 false\cf0 \strokec4 ); drawText(\cf6 \strokec6 "\uc0\u20271 \u29273 "\cf0 \strokec4 , boyX - slide, charY - \cf8 \strokec8 65\cf0 \strokec4 , \cf8 \strokec8 14\cf0 \strokec4 , \cf6 \strokec6 '#333'\cf0 \strokec4 );\cb1 \
\cb3         drawBean(girlX + slide, charY, \cf2 \strokec2 true\cf0 \strokec4 , \cf6 \strokec6 'normal'\cf0 \strokec4 , \cf8 \strokec8 1\cf0 \strokec4 , \cf2 \strokec2 true\cf0 \strokec4 ); drawText(\cf6 \strokec6 "\uc0\u27224 \u23376 "\cf0 \strokec4 , girlX + slide, charY - \cf8 \strokec8 65\cf0 \strokec4 , \cf8 \strokec8 14\cf0 \strokec4 , \cf6 \strokec6 '#333'\cf0 \strokec4 );\cb1 \
\cb3         \cb1 \
\cb3         \cf2 \strokec2 if\cf0 \strokec4  (dt > \cf8 \strokec8 100\cf0 \strokec4 ) \{\cb1 \
\cb3           \cf2 \strokec2 let\cf0 \strokec4  scale = \cf8 \strokec8 1\cf0 \strokec4  + \cf5 \strokec5 Math\cf0 \strokec4 .sin(dt * \cf8 \strokec8 0.05\cf0 \strokec4 ) * \cf8 \strokec8 0.1\cf0 \strokec4 ; ctx.save(); ctx.translate(\cf5 \strokec5 LOGIC_W\cf0 \strokec4 /\cf8 \strokec8 2\cf0 \strokec4 , \cf8 \strokec8 500\cf0 \strokec4 ); ctx.scale(scale, scale); drawText(\cf6 \strokec6 "\uc0\u10084 "\cf0 \strokec4 , \cf8 \strokec8 0\cf0 \strokec4 , \cf8 \strokec8 0\cf0 \strokec4 , \cf8 \strokec8 40\cf0 \strokec4 , \cf6 \strokec6 '#ff6b81'\cf0 \strokec4 ); ctx.restore();\cb1 \
\cb3           \cf2 \strokec2 let\cf0 \strokec4  alpha = \cf5 \strokec5 Math\cf0 \strokec4 .min(\cf8 \strokec8 1\cf0 \strokec4 , (dt - \cf8 \strokec8 100\cf0 \strokec4 ) / \cf8 \strokec8 60\cf0 \strokec4 ); ctx.globalAlpha = alpha;\cb1 \
\cb3           \cf2 \strokec2 if\cf0 \strokec4  (s.date.phase === \cf8 \strokec8 0\cf0 \strokec4 ) \{ drawText(\cf6 \strokec6 "2023\uc0\u24180 11\u26376 26\u26085 "\cf0 \strokec4 , \cf5 \strokec5 LOGIC_W\cf0 \strokec4 /\cf8 \strokec8 2\cf0 \strokec4 , \cf8 \strokec8 680\cf0 \strokec4 , \cf8 \strokec8 24\cf0 \strokec4 , \cf6 \strokec6 '#333'\cf0 \strokec4 ); drawText(\cf6 \strokec6 "\uc0\u36825 \u26159 \u19968 \u20010 \u38590 \u20197 \u24536 \u24576 \u30340 \u26085 \u23376 \u12290 "\cf0 \strokec4 , \cf5 \strokec5 LOGIC_W\cf0 \strokec4 /\cf8 \strokec8 2\cf0 \strokec4 , \cf8 \strokec8 720\cf0 \strokec4 , \cf8 \strokec8 18\cf0 \strokec4 , \cf6 \strokec6 '#666'\cf0 \strokec4 ); \}\cb1 \
\cb3           \cf2 \strokec2 else\cf0 \strokec4  \{ drawText(\cf6 \strokec6 "\uc0\u22240 \u20026 \'97\'97"\cf0 \strokec4 , \cf5 \strokec5 LOGIC_W\cf0 \strokec4 /\cf8 \strokec8 2\cf0 \strokec4 , \cf8 \strokec8 680\cf0 \strokec4 , \cf8 \strokec8 24\cf0 \strokec4 , \cf6 \strokec6 '#333'\cf0 \strokec4 ); drawText(\cf6 \strokec6 "\uc0\u25105 \u21644 \u25105 \u21916 \u27426 \u30340 \u22899 \u29983 \u22312 \u19968 \u36215 \u20102 "\cf0 \strokec4 , \cf5 \strokec5 LOGIC_W\cf0 \strokec4 /\cf8 \strokec8 2\cf0 \strokec4 , \cf8 \strokec8 720\cf0 \strokec4 , \cf8 \strokec8 18\cf0 \strokec4 , \cf6 \strokec6 '#666'\cf0 \strokec4 ); \}\cb1 \
\cb3           ctx.globalAlpha = \cf8 \strokec8 1.0\cf0 \strokec4 ;\cb1 \
\cb3         \}\cb1 \
\cb3         \cf2 \strokec2 if\cf0 \strokec4  (dt > \cf8 \strokec8 200\cf0 \strokec4 ) \{\cb1 \
\cb3           \cf2 \strokec2 if\cf0 \strokec4  (s.mouse.clicked) \{ s.mouse.clicked = \cf2 \strokec2 false\cf0 \strokec4 ; \cf2 \strokec2 if\cf0 \strokec4 (s.date.phase===\cf8 \strokec8 0\cf0 \strokec4 ) s.date.phase=\cf8 \strokec8 1\cf0 \strokec4 ; \cf2 \strokec2 else\cf0 \strokec4  transitionTo(\cf5 \strokec5 STATE\cf0 \strokec4 .\cf5 \strokec5 SCENE_5_HAIR\cf0 \strokec4 ); \}\cb1 \
\cb3           \cf2 \strokec2 if\cf0 \strokec4  (\cf5 \strokec5 Math\cf0 \strokec4 .floor(dt / \cf8 \strokec8 30\cf0 \strokec4 ) % \cf8 \strokec8 2\cf0 \strokec4  === \cf8 \strokec8 0\cf0 \strokec4 ) drawText(\cf6 \strokec6 "\uc0\u28857 \u20987 \u32487 \u32493  >"\cf0 \strokec4 , \cf5 \strokec5 LOGIC_W\cf0 \strokec4  - \cf8 \strokec8 80\cf0 \strokec4 , \cf5 \strokec5 LOGIC_H\cf0 \strokec4  - \cf8 \strokec8 50\cf0 \strokec4 , \cf8 \strokec8 16\cf0 \strokec4 , \cf6 \strokec6 '#aaa'\cf0 \strokec4 );\cb1 \
\cb3         \}\cb1 \
\cb3     \};\cb1 \
\
\cb3     \cf2 \strokec2 const\cf0 \strokec4  updateScene5Hair = () => \{\cb1 \
\cb3       \cf2 \strokec2 const\cf0 \strokec4  s = gameState.current; \cf2 \strokec2 const\cf0 \strokec4  h = s.hair; \cf2 \strokec2 const\cf0 \strokec4  f = s.flags; h.timer++;\cb1 \
\cb3       ctx.fillStyle = \cf6 \strokec6 '#fdf5e6'\cf0 \strokec4 ; ctx.fillRect(\cf8 \strokec8 0\cf0 \strokec4 , \cf8 \strokec8 0\cf0 \strokec4 , \cf5 \strokec5 LOGIC_W\cf0 \strokec4 , \cf5 \strokec5 LOGIC_H\cf0 \strokec4 );\cb1 \
\cb3       drawRect(\cf5 \strokec5 LOGIC_W\cf0 \strokec4 /\cf8 \strokec8 2\cf0 \strokec4  - \cf8 \strokec8 75\cf0 \strokec4 , \cf8 \strokec8 100\cf0 \strokec4 , \cf8 \strokec8 150\cf0 \strokec4 , \cf8 \strokec8 100\cf0 \strokec4 , \cf6 \strokec6 '#fff'\cf0 \strokec4 , \cf8 \strokec8 5\cf0 \strokec4 ); ctx.strokeStyle = \cf6 \strokec6 '#d4a373'\cf0 \strokec4 ; ctx.strokeRect(\cf5 \strokec5 LOGIC_W\cf0 \strokec4 /\cf8 \strokec8 2\cf0 \strokec4  - \cf8 \strokec8 75\cf0 \strokec4 , \cf8 \strokec8 100\cf0 \strokec4 , \cf8 \strokec8 150\cf0 \strokec4 , \cf8 \strokec8 100\cf0 \strokec4 ); ctx.beginPath(); ctx.moveTo(\cf8 \strokec8 220\cf0 \strokec4 , \cf8 \strokec8 160\cf0 \strokec4 ); ctx.lineTo(\cf8 \strokec8 250\cf0 \strokec4 , \cf8 \strokec8 130\cf0 \strokec4 ); ctx.lineTo(\cf8 \strokec8 280\cf0 \strokec4 , \cf8 \strokec8 160\cf0 \strokec4 ); ctx.strokeStyle=\cf6 \strokec6 '#888'\cf0 \strokec4 ; ctx.stroke();\cb1 \
\cb3       \cf2 \strokec2 const\cf0 \strokec4  bedY = \cf8 \strokec8 350\cf0 \strokec4 ; drawRect(\cf8 \strokec8 50\cf0 \strokec4 , bedY, \cf5 \strokec5 LOGIC_W\cf0 \strokec4  - \cf8 \strokec8 100\cf0 \strokec4 , \cf8 \strokec8 250\cf0 \strokec4 , \cf6 \strokec6 '#e0e0e0'\cf0 \strokec4 , \cf8 \strokec8 20\cf0 \strokec4 ); drawRect(\cf8 \strokec8 50\cf0 \strokec4 , bedY + \cf8 \strokec8 120\cf0 \strokec4 , \cf5 \strokec5 LOGIC_W\cf0 \strokec4  - \cf8 \strokec8 100\cf0 \strokec4 , \cf8 \strokec8 130\cf0 \strokec4 , \cf6 \strokec6 '#fff'\cf0 \strokec4 , \cf8 \strokec8 20\cf0 \strokec4 ); drawRect(\cf8 \strokec8 80\cf0 \strokec4 , bedY - \cf8 \strokec8 20\cf0 \strokec4 , \cf8 \strokec8 100\cf0 \strokec4 , \cf8 \strokec8 50\cf0 \strokec4 , \cf6 \strokec6 '#fff'\cf0 \strokec4 , \cf8 \strokec8 10\cf0 \strokec4 ); drawRect(\cf5 \strokec5 LOGIC_W\cf0 \strokec4  - \cf8 \strokec8 180\cf0 \strokec4 , bedY - \cf8 \strokec8 20\cf0 \strokec4 , \cf8 \strokec8 100\cf0 \strokec4 , \cf8 \strokec8 50\cf0 \strokec4 , \cf6 \strokec6 '#fff'\cf0 \strokec4 , \cf8 \strokec8 10\cf0 \strokec4 ); drawRect(\cf8 \strokec8 20\cf0 \strokec4 , \cf8 \strokec8 500\cf0 \strokec4 , \cf8 \strokec8 80\cf0 \strokec4 , \cf8 \strokec8 120\cf0 \strokec4 , \cf6 \strokec6 '#8b4513'\cf0 \strokec4 , \cf8 \strokec8 5\cf0 \strokec4 );\cb1 \
\cb3       \cf2 \strokec2 const\cf0 \strokec4  phoneX = \cf8 \strokec8 40\cf0 \strokec4 , phoneY = \cf8 \strokec8 510\cf0 \strokec4 , phoneW = \cf8 \strokec8 40\cf0 \strokec4 , phoneH = \cf8 \strokec8 70\cf0 \strokec4 ;\cb1 \
\cb3       \cf2 \strokec2 if\cf0 \strokec4  (h.phase === \cf8 \strokec8 1\cf0 \strokec4  && !h.dryerBought) \{\cb1 \
\cb3         \cf2 \strokec2 if\cf0 \strokec4  (isHover(phoneX - \cf8 \strokec8 20\cf0 \strokec4 , phoneY - \cf8 \strokec8 20\cf0 \strokec4 , phoneW + \cf8 \strokec8 40\cf0 \strokec4 , phoneH + \cf8 \strokec8 40\cf0 \strokec4 )) \{ canvas.style.cursor = \cf6 \strokec6 'pointer'\cf0 \strokec4 ; \cf2 \strokec2 if\cf0 \strokec4  (s.mouse.clicked) \{ s.mouse.clicked = \cf2 \strokec2 false\cf0 \strokec4 ; h.dryerBought = \cf2 \strokec2 true\cf0 \strokec4 ; f.scene5Correct = \cf2 \strokec2 true\cf0 \strokec4 ; s.score += \cf8 \strokec8 2\cf0 \strokec4 ; h.phase = \cf8 \strokec8 2\cf0 \strokec4 ; h.timer = \cf8 \strokec8 0\cf0 \strokec4 ; \} \}\cb1 \
\cb3       \}\cb1 \
\cb3       drawRect(phoneX, phoneY, phoneW, phoneH, h.phase===\cf8 \strokec8 1\cf0 \strokec4  && !h.dryerBought && isHover(phoneX-\cf8 \strokec8 20\cf0 \strokec4 ,phoneY-\cf8 \strokec8 20\cf0 \strokec4 ,phoneW+\cf8 \strokec8 40\cf0 \strokec4 ,phoneH+\cf8 \strokec8 40\cf0 \strokec4 ) ? \cf6 \strokec6 '#555'\cf0 \strokec4  : \cf6 \strokec6 '#333'\cf0 \strokec4 , \cf8 \strokec8 5\cf0 \strokec4 ); drawRect(phoneX+\cf8 \strokec8 2\cf0 \strokec4 , phoneY+\cf8 \strokec8 5\cf0 \strokec4 , phoneW-\cf8 \strokec8 4\cf0 \strokec4 , phoneH-\cf8 \strokec8 10\cf0 \strokec4 , \cf6 \strokec6 '#111'\cf0 \strokec4 , \cf8 \strokec8 2\cf0 \strokec4 );\cb1 \
\cb3       \cf2 \strokec2 let\cf0 \strokec4  boyX = \cf8 \strokec8 120\cf0 \strokec4 , girlX = \cf8 \strokec8 300\cf0 \strokec4 , girlY = \cf8 \strokec8 300\cf0 \strokec4 ;\cb1 \
\cb3       \cf2 \strokec2 if\cf0 \strokec4  (h.phase === \cf8 \strokec8 1\cf0 \strokec4 ) \{ \cf2 \strokec2 if\cf0 \strokec4  (h.timer < \cf8 \strokec8 60\cf0 \strokec4 ) boyX = \cf8 \strokec8 120\cf0 \strokec4  + (girlX - \cf8 \strokec8 80\cf0 \strokec4  - \cf8 \strokec8 120\cf0 \strokec4 ) * (h.timer / \cf8 \strokec8 60\cf0 \strokec4 ); \cf2 \strokec2 else\cf0 \strokec4  boyX = girlX - \cf8 \strokec8 80\cf0 \strokec4 ; \} \cf2 \strokec2 else\cf0 \strokec4  \cf2 \strokec2 if\cf0 \strokec4  (h.phase === \cf8 \strokec8 2\cf0 \strokec4  || h.phase === \cf8 \strokec8 4\cf0 \strokec4  || h.phase === \cf8 \strokec8 5\cf0 \strokec4 ) boyX = girlX - \cf8 \strokec8 80\cf0 \strokec4 ;\cb1 \
\cb3       drawBean(boyX, \cf8 \strokec8 300\cf0 \strokec4 , \cf2 \strokec2 false\cf0 \strokec4 );\cb1 \
\cb3       \cf2 \strokec2 if\cf0 \strokec4  (h.phase === \cf8 \strokec8 0\cf0 \strokec4 ) \{ drawBean(girlX, girlY, \cf2 \strokec2 true\cf0 \strokec4 , \cf6 \strokec6 'normal'\cf0 \strokec4 , \cf8 \strokec8 1\cf0 \strokec4 , \cf2 \strokec2 true\cf0 \strokec4 ); ctx.fillStyle = \cf6 \strokec6 '#afeeee'\cf0 \strokec4 ; ctx.beginPath(); ctx.arc(girlX, girlY - \cf8 \strokec8 15\cf0 \strokec4 , \cf8 \strokec8 45\cf0 \strokec4 , \cf5 \strokec5 Math\cf0 \strokec4 .\cf5 \strokec5 PI\cf0 \strokec4 , \cf8 \strokec8 0\cf0 \strokec4 ); ctx.fill(); ctx.fillRect(girlX - \cf8 \strokec8 45\cf0 \strokec4 , girlY - \cf8 \strokec8 15\cf0 \strokec4 , \cf8 \strokec8 90\cf0 \strokec4 , \cf8 \strokec8 20\cf0 \strokec4 ); \}\cb1 \
\cb3       \cf2 \strokec2 else\cf0 \strokec4  \{ drawBean(girlX, girlY, \cf2 \strokec2 true\cf0 \strokec4 , \cf6 \strokec6 'normal'\cf0 \strokec4 , \cf8 \strokec8 1\cf0 \strokec4 , \cf2 \strokec2 true\cf0 \strokec4 ); \cf2 \strokec2 if\cf0 \strokec4  (h.timer >= \cf8 \strokec8 60\cf0 \strokec4  && h.phase === \cf8 \strokec8 1\cf0 \strokec4  && !h.dryerBought) \{ ctx.save(); ctx.translate(girlX - \cf8 \strokec8 60\cf0 \strokec4 , girlY - \cf8 \strokec8 20\cf0 \strokec4 ); drawRect(\cf8 \strokec8 0\cf0 \strokec4 , \cf8 \strokec8 0\cf0 \strokec4 , \cf8 \strokec8 40\cf0 \strokec4 , \cf8 \strokec8 20\cf0 \strokec4 , \cf6 \strokec6 '#555'\cf0 \strokec4 ); drawRect(\cf8 \strokec8 40\cf0 \strokec4 , -\cf8 \strokec8 5\cf0 \strokec4 , \cf8 \strokec8 10\cf0 \strokec4 , \cf8 \strokec8 30\cf0 \strokec4 , \cf6 \strokec6 '#555'\cf0 \strokec4 ); ctx.strokeStyle = \cf6 \strokec6 '#ccc'\cf0 \strokec4 ; ctx.beginPath(); ctx.moveTo(\cf8 \strokec8 40\cf0 \strokec4 , \cf8 \strokec8 10\cf0 \strokec4 ); ctx.lineTo(\cf8 \strokec8 60\cf0 \strokec4  + \cf5 \strokec5 Math\cf0 \strokec4 .random()*\cf8 \strokec8 10\cf0 \strokec4 , \cf8 \strokec8 5\cf0 \strokec4  + \cf5 \strokec5 Math\cf0 \strokec4 .random()*\cf8 \strokec8 10\cf0 \strokec4 ); ctx.moveTo(\cf8 \strokec8 40\cf0 \strokec4 , \cf8 \strokec8 10\cf0 \strokec4 ); ctx.lineTo(\cf8 \strokec8 60\cf0 \strokec4  + \cf5 \strokec5 Math\cf0 \strokec4 .random()*\cf8 \strokec8 10\cf0 \strokec4 , \cf8 \strokec8 15\cf0 \strokec4  + \cf5 \strokec5 Math\cf0 \strokec4 .random()*\cf8 \strokec8 10\cf0 \strokec4 ); ctx.stroke(); ctx.restore(); \} \}\cb1 \
\cb3       drawRect(\cf8 \strokec8 20\cf0 \strokec4 , \cf8 \strokec8 60\cf0 \strokec4 , \cf5 \strokec5 LOGIC_W\cf0 \strokec4  - \cf8 \strokec8 40\cf0 \strokec4 , \cf8 \strokec8 120\cf0 \strokec4 , \cf6 \strokec6 '#fff'\cf0 \strokec4 , \cf8 \strokec8 10\cf0 \strokec4 ); ctx.strokeStyle = \cf6 \strokec6 '#333'\cf0 \strokec4 ; ctx.lineWidth = \cf8 \strokec8 2\cf0 \strokec4 ; ctx.strokeRect(\cf8 \strokec8 20\cf0 \strokec4 , \cf8 \strokec8 60\cf0 \strokec4 , \cf5 \strokec5 LOGIC_W\cf0 \strokec4  - \cf8 \strokec8 40\cf0 \strokec4 , \cf8 \strokec8 120\cf0 \strokec4 );\cb1 \
\cb3       \cf2 \strokec2 let\cf0 \strokec4  msg = \cf6 \strokec6 ""\cf0 \strokec4 ;\cb1 \
\cb3       \cf2 \strokec2 if\cf0 \strokec4  (h.phase === \cf8 \strokec8 0\cf0 \strokec4 ) \{\cb1 \
\cb3         \cf2 \strokec2 if\cf0 \strokec4  (h.timer < \cf8 \strokec8 120\cf0 \strokec4 ) msg = \cf6 \strokec6 "\uc0\u65288 \u22905 \u21018 \u27927 \u23436 \u22836 \u20174 \u28020 \u23460 \u20986 \u26469 ...\u65289 "\cf0 \strokec4 ; \cf2 \strokec2 else\cf0 \strokec4  \{ msg = \cf6 \strokec6 "\uc0\u25105 \u24212 \u35813 ..."\cf0 \strokec4 ; \cf2 \strokec2 if\cf0 \strokec4  (h.timer > \cf8 \strokec8 120\cf0 \strokec4 ) \{ drawButton(\cf6 \strokec6 "\uc0\u36214 \u32039 \u19978 \u24202 \u21543 \u65292 \u21035 \u24863 \u20882 \u20102 "\cf0 \strokec4 , (\cf5 \strokec5 LOGIC_W\cf0 \strokec4 -\cf8 \strokec8 350\cf0 \strokec4 )/\cf8 \strokec8 2\cf0 \strokec4 , \cf8 \strokec8 680\cf0 \strokec4 , \cf8 \strokec8 350\cf0 \strokec4 , \cf8 \strokec8 40\cf0 \strokec4 , () => \{ h.phase = \cf8 \strokec8 3\cf0 \strokec4 ; h.timer = \cf8 \strokec8 0\cf0 \strokec4 ; s.score = \cf8 \strokec8 0\cf0 \strokec4 ; \}); drawButton(\cf6 \strokec6 "\uc0\u26469 \u65292 \u25105 \u32473 \u20320 \u21561 \u22836 \u12290 "\cf0 \strokec4 , (\cf5 \strokec5 LOGIC_W\cf0 \strokec4 -\cf8 \strokec8 350\cf0 \strokec4 )/\cf8 \strokec8 2\cf0 \strokec4 , \cf8 \strokec8 730\cf0 \strokec4 , \cf8 \strokec8 350\cf0 \strokec4 , \cf8 \strokec8 40\cf0 \strokec4 , () => \{ h.phase = \cf8 \strokec8 1\cf0 \strokec4 ; h.timer = \cf8 \strokec8 0\cf0 \strokec4 ; \}); \} \}\cb1 \
\cb3       \} \cf2 \strokec2 else\cf0 \strokec4  \cf2 \strokec2 if\cf0 \strokec4  (h.phase === \cf8 \strokec8 1\cf0 \strokec4 ) \{\cb1 \
\cb3         \cf2 \strokec2 if\cf0 \strokec4  (h.timer < \cf8 \strokec8 120\cf0 \strokec4 ) msg = \cf6 \strokec6 "\uc0\u65288 \u36208 \u36807 \u21435 \u24110 \u22905 \u21561 \u22836 \u21457 ...\u65289 "\cf0 \strokec4 ; \cf2 \strokec2 else\cf0 \strokec4  \cf2 \strokec2 if\cf0 \strokec4  (h.timer < \cf8 \strokec8 200\cf0 \strokec4 ) msg = \cf6 \strokec6 "\uc0\u65288 \u21561 \u39118 \u26426 \u30340 \u22768 \u38899 \u21985 \u21985 \u20316 \u21709 ...\u65289 "\cf0 \strokec4 ; \cf2 \strokec2 else\cf0 \strokec4  \{\cb1 \
\cb3           msg = \cf6 \strokec6 "\uc0\u22905 \u65306 \u25105 \u30340 \u22836 \u21457 \u22909 \u27611 \u36481 \u21734 \u65292 \u19981 \u20687 \u21035 \u30340 \u37027 \u20123 \u22899 \u29983 ..."\cf0 \strokec4 ;\cb1 \
\cb3           \cf2 \strokec2 if\cf0 \strokec4  (!h.dryerBought) \{ drawButton(\cf6 \strokec6 "\uc0\u23453 \u23453 \u30340 \u22836 \u21457 \u19968 \u28857 \u20063 \u19981 \u27611 \u36481 "\cf0 \strokec4 , (\cf5 \strokec5 LOGIC_W\cf0 \strokec4 -\cf8 \strokec8 350\cf0 \strokec4 )/\cf8 \strokec8 2\cf0 \strokec4 , \cf8 \strokec8 680\cf0 \strokec4 , \cf8 \strokec8 350\cf0 \strokec4 , \cf8 \strokec8 40\cf0 \strokec4 , () => \{ h.phase = \cf8 \strokec8 4\cf0 \strokec4 ; h.timer = \cf8 \strokec8 0\cf0 \strokec4 ; s.score = \cf8 \strokec8 4\cf0 \strokec4 ; \}); drawButton(\cf6 \strokec6 "\uc0\u21035 \u30340 \u22899 \u29983 \u30340 \u22836 \u21457 \u37117 \u27604 \u20320 \u27611 \u36481 "\cf0 \strokec4 , (\cf5 \strokec5 LOGIC_W\cf0 \strokec4 -\cf8 \strokec8 350\cf0 \strokec4 )/\cf8 \strokec8 2\cf0 \strokec4 , \cf8 \strokec8 730\cf0 \strokec4 , \cf8 \strokec8 350\cf0 \strokec4 , \cf8 \strokec8 40\cf0 \strokec4 , () => \{ h.phase = \cf8 \strokec8 5\cf0 \strokec4 ; h.timer = \cf8 \strokec8 0\cf0 \strokec4 ; s.score = \cf8 \strokec8 0\cf0 \strokec4 ; \}); \}\cb1 \
\cb3         \}\cb1 \
\cb3       \} \cf2 \strokec2 else\cf0 \strokec4  \cf2 \strokec2 if\cf0 \strokec4  (h.phase === \cf8 \strokec8 2\cf0 \strokec4 ) \{\cb1 \
\cb3         \cf2 \strokec2 if\cf0 \strokec4  (h.timer < \cf8 \strokec8 150\cf0 \strokec4 ) msg = \cf6 \strokec6 "\uc0\u25105 \u65306 \u65288 \u40664 \u40664 \u25343 \u36215 \u25163 \u26426 \u19979 \u21333 \u20102 \u26368 \u26032 \u27454 \u21561 \u39118 \u26426 \u65289 "\cf0 \strokec4 ; \cf2 \strokec2 else\cf0 \strokec4  \{ msg = \cf6 \strokec6 "\uc0\u25105 \u65306 \u21018 \u25165 \u32473 \u20320 \u20080 \u20102 \u20010 \u26356 \u22909 \u30340 \u21561 \u39118 \u26426 \u65292 \u36807 \u20004 \u22825 \u23601 \u21040 \u12290 "\cf0 \strokec4 ; ctx.save(); ctx.translate(\cf8 \strokec8 400\cf0 \strokec4 , \cf8 \strokec8 300\cf0 \strokec4 ); ctx.scale(\cf8 \strokec8 1.5\cf0 \strokec4 , \cf8 \strokec8 1.5\cf0 \strokec4 ); drawText(\cf6 \strokec6 "\uc0\u10084 "\cf0 \strokec4 , \cf8 \strokec8 0\cf0 \strokec4 , \cf8 \strokec8 0\cf0 \strokec4 , \cf8 \strokec8 50\cf0 \strokec4 , \cf5 \strokec5 COLORS\cf0 \strokec4 .primary); ctx.restore(); \cf2 \strokec2 if\cf0 \strokec4  (h.timer > \cf8 \strokec8 400\cf0 \strokec4 ) transitionTo(\cf5 \strokec5 STATE\cf0 \strokec4 .\cf5 \strokec5 SCENE_6_PHOTO\cf0 \strokec4 ); \}\cb1 \
\cb3       \} \cf2 \strokec2 else\cf0 \strokec4  \cf2 \strokec2 if\cf0 \strokec4  (h.phase === \cf8 \strokec8 3\cf0 \strokec4 ) \{ msg = \cf6 \strokec6 "\uc0\u22905 \u65306 \u21734 ...\u55357 \u56848 "\cf0 \strokec4 ; \cf2 \strokec2 if\cf0 \strokec4  (h.timer > \cf8 \strokec8 150\cf0 \strokec4 ) transitionTo(\cf5 \strokec5 STATE\cf0 \strokec4 .\cf5 \strokec5 ENDING\cf0 \strokec4 ); \}\cb1 \
\cb3       \cf2 \strokec2 else\cf0 \strokec4  \cf2 \strokec2 if\cf0 \strokec4  (h.phase === \cf8 \strokec8 4\cf0 \strokec4 ) \{ msg = \cf6 \strokec6 "\uc0\u22905 \u65306 \u28902 \u27515 \u20102 \u65292 \u27611 \u36481 \u19981 \u27611 \u36481 \u25105 \u19981 \u30693 \u36947 \u21527 \u65281 "\cf0 \strokec4 ; \cf2 \strokec2 if\cf0 \strokec4  (h.timer > \cf8 \strokec8 150\cf0 \strokec4 ) transitionTo(\cf5 \strokec5 STATE\cf0 \strokec4 .\cf5 \strokec5 ENDING\cf0 \strokec4 ); \}\cb1 \
\cb3       \cf2 \strokec2 else\cf0 \strokec4  \cf2 \strokec2 if\cf0 \strokec4  (h.phase === \cf8 \strokec8 5\cf0 \strokec4 ) \{ msg = \cf6 \strokec6 "\uc0\u22905 \u65306 \u25402 \u22909 \u30340 \u65292 \u20320 \u36824 \u32473 \u20960 \u20010 \u22969 \u22969 \u21561 \u36807 \u65311 \u55358 \u56596 "\cf0 \strokec4 ; \cf2 \strokec2 if\cf0 \strokec4  (h.timer > \cf8 \strokec8 150\cf0 \strokec4 ) transitionTo(\cf5 \strokec5 STATE\cf0 \strokec4 .\cf5 \strokec5 ENDING\cf0 \strokec4 ); \}\cb1 \
\cb3       drawParagraph(typeText(msg, \cf8 \strokec8 5\cf0 \strokec4 ), \cf8 \strokec8 40\cf0 \strokec4 , \cf8 \strokec8 100\cf0 \strokec4 , \cf8 \strokec8 370\cf0 \strokec4 , \cf8 \strokec8 26\cf0 \strokec4 , \cf8 \strokec8 20\cf0 \strokec4 , \cf6 \strokec6 '#333'\cf0 \strokec4 , \cf6 \strokec6 'left'\cf0 \strokec4 ); \cb1 \
\cb3     \};\cb1 \
\
\cb3     \cf2 \strokec2 const\cf0 \strokec4  updateScene6Photo = () => \{\cb1 \
\cb3       \cf2 \strokec2 const\cf0 \strokec4  s = gameState.current; \cf2 \strokec2 const\cf0 \strokec4  p = s.photo; \cf2 \strokec2 const\cf0 \strokec4  f = s.flags; p.timer++;\cb1 \
\cb3       ctx.fillStyle = \cf6 \strokec6 '#87ceeb'\cf0 \strokec4 ; ctx.fillRect(\cf8 \strokec8 0\cf0 \strokec4 , \cf8 \strokec8 0\cf0 \strokec4 , \cf5 \strokec5 LOGIC_W\cf0 \strokec4 , \cf5 \strokec5 LOGIC_H\cf0 \strokec4 ); ctx.fillStyle = \cf6 \strokec6 '#a8e6cf'\cf0 \strokec4 ; ctx.beginPath(); ctx.moveTo(\cf8 \strokec8 0\cf0 \strokec4 , \cf8 \strokec8 400\cf0 \strokec4 ); ctx.lineTo(\cf8 \strokec8 200\cf0 \strokec4 , \cf8 \strokec8 200\cf0 \strokec4 ); ctx.lineTo(\cf8 \strokec8 500\cf0 \strokec4 , \cf8 \strokec8 450\cf0 \strokec4 ); ctx.lineTo(\cf8 \strokec8 800\cf0 \strokec4 , \cf8 \strokec8 250\cf0 \strokec4 ); ctx.lineTo(\cf8 \strokec8 800\cf0 \strokec4 , \cf8 \strokec8 600\cf0 \strokec4 ); ctx.lineTo(\cf8 \strokec8 0\cf0 \strokec4 , \cf8 \strokec8 600\cf0 \strokec4 ); ctx.fill(); ctx.fillStyle = \cf6 \strokec6 '#dcedc1'\cf0 \strokec4 ; ctx.fillRect(\cf8 \strokec8 0\cf0 \strokec4 , \cf8 \strokec8 450\cf0 \strokec4 , \cf5 \strokec5 LOGIC_W\cf0 \strokec4 , \cf8 \strokec8 350\cf0 \strokec4 );\cb1 \
\cb3       \cf2 \strokec2 const\cf0 \strokec4  girlX = \cf5 \strokec5 LOGIC_W\cf0 \strokec4  / \cf8 \strokec8 2\cf0 \strokec4 , girlY = \cf8 \strokec8 350\cf0 \strokec4 ; drawBean(girlX, girlY, \cf2 \strokec2 true\cf0 \strokec4 , \cf6 \strokec6 'happy'\cf0 \strokec4 , \cf8 \strokec8 1\cf0 \strokec4 , \cf2 \strokec2 true\cf0 \strokec4 );\cb1 \
\cb3       ctx.strokeStyle = \cf6 \strokec6 '#333'\cf0 \strokec4 ; ctx.lineWidth = \cf8 \strokec8 3\cf0 \strokec4 ; ctx.beginPath(); ctx.moveTo(girlX - \cf8 \strokec8 40\cf0 \strokec4 , girlY + \cf8 \strokec8 50\cf0 \strokec4 ); ctx.lineTo(girlX - \cf8 \strokec8 70\cf0 \strokec4 , girlY + \cf8 \strokec8 10\cf0 \strokec4 ); ctx.stroke(); ctx.beginPath(); ctx.moveTo(girlX - \cf8 \strokec8 70\cf0 \strokec4 , girlY + \cf8 \strokec8 10\cf0 \strokec4 ); ctx.lineTo(girlX - \cf8 \strokec8 80\cf0 \strokec4 , girlY - \cf8 \strokec8 10\cf0 \strokec4 ); ctx.stroke(); ctx.beginPath(); ctx.moveTo(girlX - \cf8 \strokec8 70\cf0 \strokec4 , girlY + \cf8 \strokec8 10\cf0 \strokec4 ); ctx.lineTo(girlX - \cf8 \strokec8 60\cf0 \strokec4 , girlY - \cf8 \strokec8 10\cf0 \strokec4 ); ctx.stroke();\cb1 \
\cb3       ctx.strokeStyle = \cf6 \strokec6 '#fff'\cf0 \strokec4 ; ctx.lineWidth = \cf8 \strokec8 5\cf0 \strokec4 ; ctx.strokeRect(\cf8 \strokec8 50\cf0 \strokec4 , \cf8 \strokec8 100\cf0 \strokec4 , \cf5 \strokec5 LOGIC_W\cf0 \strokec4  - \cf8 \strokec8 100\cf0 \strokec4 , \cf8 \strokec8 400\cf0 \strokec4 ); ctx.lineWidth = \cf8 \strokec8 2\cf0 \strokec4 ; ctx.strokeStyle = \cf6 \strokec6 'rgba(255, 255, 255, 0.7)'\cf0 \strokec4 ;\cb1 \
\cb3       \cf2 \strokec2 const\cf0 \strokec4  sz = \cf8 \strokec8 40\cf0 \strokec4 , cx = \cf8 \strokec8 400\cf0 \strokec4 , cy = \cf8 \strokec8 275\cf0 \strokec4 ; ctx.strokeRect(cx - sz/\cf8 \strokec8 2\cf0 \strokec4 , cy - sz/\cf8 \strokec8 2\cf0 \strokec4 , sz, sz);\cb1 \
\cb3       ctx.beginPath(); ctx.moveTo(\cf8 \strokec8 300\cf0 \strokec4 , \cf8 \strokec8 50\cf0 \strokec4 ); ctx.lineTo(\cf8 \strokec8 300\cf0 \strokec4 , \cf8 \strokec8 500\cf0 \strokec4 ); ctx.moveTo(\cf8 \strokec8 500\cf0 \strokec4 , \cf8 \strokec8 50\cf0 \strokec4 ); ctx.lineTo(\cf8 \strokec8 500\cf0 \strokec4 , \cf8 \strokec8 500\cf0 \strokec4 ); ctx.moveTo(\cf8 \strokec8 100\cf0 \strokec4 , \cf8 \strokec8 200\cf0 \strokec4 ); ctx.lineTo(\cf8 \strokec8 700\cf0 \strokec4 , \cf8 \strokec8 200\cf0 \strokec4 ); ctx.moveTo(\cf8 \strokec8 100\cf0 \strokec4 , \cf8 \strokec8 350\cf0 \strokec4 ); ctx.lineTo(\cf8 \strokec8 700\cf0 \strokec4 , \cf8 \strokec8 350\cf0 \strokec4 ); ctx.stroke();\cb1 \
\cb3       ctx.fillStyle = \cf6 \strokec6 '#000'\cf0 \strokec4 ; ctx.fillRect(\cf8 \strokec8 0\cf0 \strokec4 , \cf8 \strokec8 500\cf0 \strokec4 , \cf8 \strokec8 800\cf0 \strokec4 , \cf8 \strokec8 100\cf0 \strokec4 );\cb1 \
\cb3       \cf2 \strokec2 const\cf0 \strokec4  shutterX = \cf5 \strokec5 LOGIC_W\cf0 \strokec4  / \cf8 \strokec8 2\cf0 \strokec4 , shutterY = \cf8 \strokec8 700\cf0 \strokec4 , shutterR = \cf8 \strokec8 35\cf0 \strokec4 ; ctx.fillStyle = \cf6 \strokec6 '#fff'\cf0 \strokec4 ; ctx.beginPath(); ctx.arc(shutterX, shutterY, shutterR, \cf8 \strokec8 0\cf0 \strokec4 , \cf5 \strokec5 Math\cf0 \strokec4 .\cf5 \strokec5 PI\cf0 \strokec4 *\cf8 \strokec8 2\cf0 \strokec4 ); ctx.fill(); ctx.strokeStyle = \cf6 \strokec6 '#333'\cf0 \strokec4 ; ctx.lineWidth = \cf8 \strokec8 2\cf0 \strokec4 ; ctx.stroke(); ctx.fillStyle = \cf6 \strokec6 '#fff'\cf0 \strokec4 ; ctx.beginPath(); ctx.arc(shutterX, shutterY, shutterR - \cf8 \strokec8 6\cf0 \strokec4 , \cf8 \strokec8 0\cf0 \strokec4 , \cf5 \strokec5 Math\cf0 \strokec4 .\cf5 \strokec5 PI\cf0 \strokec4 *\cf8 \strokec8 2\cf0 \strokec4 ); ctx.fill();\cb1 \
\cb3       \cf2 \strokec2 if\cf0 \strokec4  (p.phase <= \cf8 \strokec8 1\cf0 \strokec4 ) \{ \cf2 \strokec2 if\cf0 \strokec4  (isHover(shutterX - \cf8 \strokec8 40\cf0 \strokec4 , shutterY - \cf8 \strokec8 40\cf0 \strokec4 , \cf8 \strokec8 80\cf0 \strokec4 , \cf8 \strokec8 80\cf0 \strokec4 )) \{ canvas.style.cursor = \cf6 \strokec6 'pointer'\cf0 \strokec4 ; \cf2 \strokec2 if\cf0 \strokec4  (s.mouse.clicked) \{ s.mouse.clicked = \cf2 \strokec2 false\cf0 \strokec4 ; p.count++; p.flash = \cf8 \strokec8 1.0\cf0 \strokec4 ; \cf2 \strokec2 if\cf0 \strokec4  (p.count >= \cf8 \strokec8 3\cf0 \strokec4 ) \{ p.phase = \cf8 \strokec8 3\cf0 \strokec4 ; p.timer = \cf8 \strokec8 0\cf0 \strokec4 ; \} \} \} \}\cb1 \
\cb3       \cf2 \strokec2 if\cf0 \strokec4  (p.flash > \cf8 \strokec8 0\cf0 \strokec4 ) \{ ctx.fillStyle = \cf6 \strokec6 `rgba(255, 255, 255, \cf0 \strokec4 $\{p.flash\}\cf6 \strokec6 )`\cf0 \strokec4 ; ctx.fillRect(\cf8 \strokec8 0\cf0 \strokec4 , \cf8 \strokec8 0\cf0 \strokec4 , \cf5 \strokec5 LOGIC_W\cf0 \strokec4 , \cf5 \strokec5 LOGIC_H\cf0 \strokec4 ); p.flash -= \cf8 \strokec8 0.1\cf0 \strokec4 ; \}\cb1 \
\cb3       \cf2 \strokec2 if\cf0 \strokec4  (p.phase !== \cf8 \strokec8 2\cf0 \strokec4  && p.phase !== \cf8 \strokec8 3\cf0 \strokec4 ) \{ ctx.fillStyle = \cf6 \strokec6 'rgba(0,0,0,0.6)'\cf0 \strokec4 ; drawRect(\cf8 \strokec8 20\cf0 \strokec4 , \cf8 \strokec8 60\cf0 \strokec4 , \cf5 \strokec5 LOGIC_W\cf0 \strokec4  - \cf8 \strokec8 40\cf0 \strokec4 , \cf8 \strokec8 60\cf0 \strokec4 , \cf6 \strokec6 'rgba(0,0,0,0.6)'\cf0 \strokec4 , \cf8 \strokec8 10\cf0 \strokec4 ); \} \cf2 \strokec2 else\cf0 \strokec4  \{ drawRect(\cf8 \strokec8 20\cf0 \strokec4 , \cf8 \strokec8 60\cf0 \strokec4 , \cf5 \strokec5 LOGIC_W\cf0 \strokec4  - \cf8 \strokec8 40\cf0 \strokec4 , \cf8 \strokec8 80\cf0 \strokec4 , \cf6 \strokec6 '#fff'\cf0 \strokec4 , \cf8 \strokec8 10\cf0 \strokec4 ); ctx.strokeStyle = \cf6 \strokec6 '#333'\cf0 \strokec4 ; ctx.lineWidth = \cf8 \strokec8 2\cf0 \strokec4 ; ctx.strokeRect(\cf8 \strokec8 20\cf0 \strokec4 , \cf8 \strokec8 60\cf0 \strokec4 , \cf5 \strokec5 LOGIC_W\cf0 \strokec4  - \cf8 \strokec8 40\cf0 \strokec4 , \cf8 \strokec8 80\cf0 \strokec4 ); \}\cb1 \
\cb3       \cf2 \strokec2 let\cf0 \strokec4  msg = \cf6 \strokec6 ""\cf0 \strokec4 , textColor = \cf6 \strokec6 '#fff'\cf0 \strokec4 ;\cb1 \
\cb3       \cf7 \strokec7 // 180=3s\cf0 \cb1 \strokec4 \
\cb3       \cf2 \strokec2 if\cf0 \strokec4  (p.phase === \cf8 \strokec8 0\cf0 \strokec4 ) \{\cb1 \
\cb3         textColor = \cf6 \strokec6 '#fff'\cf0 \strokec4 ;\cb1 \
\cb3         \cf2 \strokec2 if\cf0 \strokec4  (p.timer < \cf8 \strokec8 180\cf0 \strokec4 ) msg = \cf6 \strokec6 "\uc0\u22905 \u65306 \u38236 \u22836 \u24448 \u19978 \u19968 \u28857 \u65281 "\cf0 \strokec4 ; \cf2 \strokec2 else\cf0 \strokec4  \cf2 \strokec2 if\cf0 \strokec4  (p.timer < \cf8 \strokec8 360\cf0 \strokec4 ) msg = \cf6 \strokec6 "\uc0\u22905 \u65306 \u35201 \u35760 \u24471 \u25226 \u25105 \u30340 \u20154 \u26694 \u22312 2/3\u30340 \u20301 \u32622 \u21734 ~"\cf0 \strokec4 ; \cf2 \strokec2 else\cf0 \strokec4  \cf2 \strokec2 if\cf0 \strokec4  (p.timer < \cf8 \strokec8 540\cf0 \strokec4 ) msg = \cf6 \strokec6 "\uc0\u22905 \u65306 \u24320 \u23454 \u20917 \u21035 \u24536 \u35760 \u20102 \u65281 "\cf0 \strokec4 ; \cf2 \strokec2 else\cf0 \strokec4  \cf2 \strokec2 if\cf0 \strokec4  (p.timer < \cf8 \strokec8 720\cf0 \strokec4 ) msg = \cf6 \strokec6 "\uc0\u22905 \u65306 \u35201 \u25293 \u21040 \u21518 \u38754 \u30340 \u26223 \u33394 \u21734 ~"\cf0 \strokec4 ; \cf2 \strokec2 else\cf0 \strokec4  \{ msg = \cf6 \strokec6 "\uc0\u22905 \u65306 \u36824 \u26377 \u37027 \u20010 ..."\cf0 \strokec4 ; p.phase = \cf8 \strokec8 1\cf0 \strokec4 ; \}\cb1 \
\cb3       \} \cf2 \strokec2 else\cf0 \strokec4  \cf2 \strokec2 if\cf0 \strokec4  (p.phase === \cf8 \strokec8 1\cf0 \strokec4 ) \{\cb1 \
\cb3         msg = \cf6 \strokec6 "\uc0\u22905 \u65306 \u36824 \u26377 \u20809 \u32447 \u22909 \u20687 \u19981 \u22826 \u23545 ..."\cf0 \strokec4 ; textColor = \cf6 \strokec6 '#fff'\cf0 \strokec4 ; drawButton(\cf6 \strokec6 "\uc0\u34892 \u20102 \u34892 \u20102 \u21035 \u35828 \u20102 "\cf0 \strokec4 , (\cf5 \strokec5 LOGIC_W\cf0 \strokec4 -\cf8 \strokec8 250\cf0 \strokec4 )/\cf8 \strokec8 2\cf0 \strokec4 , \cf8 \strokec8 300\cf0 \strokec4 , \cf8 \strokec8 250\cf0 \strokec4 , \cf8 \strokec8 50\cf0 \strokec4 , () => \{ p.phase = \cf8 \strokec8 2\cf0 \strokec4 ; p.timer = \cf8 \strokec8 0\cf0 \strokec4 ; f.failReason = \cf8 \strokec8 1\cf0 \strokec4 ; s.score = \cf8 \strokec8 4\cf0 \strokec4 ; \}); drawButton(\cf6 \strokec6 "\uc0\u20877 \u20063 \u19981 \u24819 \u20986 \u26469 \u20102 ..."\cf0 \strokec4 , (\cf5 \strokec5 LOGIC_W\cf0 \strokec4 -\cf8 \strokec8 250\cf0 \strokec4 )/\cf8 \strokec8 2\cf0 \strokec4 , \cf8 \strokec8 370\cf0 \strokec4 , \cf8 \strokec8 250\cf0 \strokec4 , \cf8 \strokec8 50\cf0 \strokec4 , () => \{ p.phase = \cf8 \strokec8 2\cf0 \strokec4 ; p.timer = \cf8 \strokec8 0\cf0 \strokec4 ; f.failReason = \cf8 \strokec8 2\cf0 \strokec4 ; s.score = \cf8 \strokec8 0\cf0 \strokec4 ; \});\cb1 \
\cb3       \} \cf2 \strokec2 else\cf0 \strokec4  \cf2 \strokec2 if\cf0 \strokec4  (p.phase === \cf8 \strokec8 2\cf0 \strokec4 ) \{\cb1 \
\cb3         textColor = \cf6 \strokec6 '#333'\cf0 \strokec4 ; \cf2 \strokec2 if\cf0 \strokec4  (f.failReason === \cf8 \strokec8 1\cf0 \strokec4 ) msg = \cf6 \strokec6 "\uc0\u22905 \u65306 \u23545 \u19981 \u36215 \u22043 \u23453 \u23453 \u65292 \u39532 \u19978 \u24102 \u20320 \u21435 \u21507 \u22909 \u21507 \u30340 \u65374 "\cf0 \strokec4 ; \cf2 \strokec2 else\cf0 \strokec4  msg = \cf6 \strokec6 "\uc0\u22905 \u65306 \u23453 \u23453 \u27809 \u20107 \u22079 \u22079 \u65292 \u36825 \u24352 \u25293 \u23436 \u23601 \u19981 \u25293 \u20102 ..."\cf0 \strokec4 ;\cb1 \
\cb3         \cf2 \strokec2 if\cf0 \strokec4  (p.timer > \cf8 \strokec8 50\cf0 \strokec4 ) \{ ctx.save(); ctx.translate(\cf5 \strokec5 LOGIC_W\cf0 \strokec4 /\cf8 \strokec8 2\cf0 \strokec4 , \cf8 \strokec8 300\cf0 \strokec4 ); ctx.scale(\cf8 \strokec8 2\cf0 \strokec4 , \cf8 \strokec8 2\cf0 \strokec4 ); drawBean(\cf8 \strokec8 0\cf0 \strokec4 , \cf8 \strokec8 0\cf0 \strokec4 , \cf2 \strokec2 true\cf0 \strokec4 , \cf6 \strokec6 'normal'\cf0 \strokec4 , \cf8 \strokec8 1\cf0 \strokec4 , \cf2 \strokec2 true\cf0 \strokec4 ); ctx.restore(); \}\cb1 \
\cb3         \cf2 \strokec2 if\cf0 \strokec4  (p.timer > \cf8 \strokec8 200\cf0 \strokec4 ) transitionTo(\cf5 \strokec5 STATE\cf0 \strokec4 .\cf5 \strokec5 ENDING\cf0 \strokec4 );\cb1 \
\cb3       \} \cf2 \strokec2 else\cf0 \strokec4  \cf2 \strokec2 if\cf0 \strokec4  (p.phase === \cf8 \strokec8 3\cf0 \strokec4 ) \{\cb1 \
\cb3         textColor = \cf6 \strokec6 '#333'\cf0 \strokec4 ; \cf2 \strokec2 if\cf0 \strokec4  (p.timer < \cf8 \strokec8 100\cf0 \strokec4 ) \{ msg = \cf6 \strokec6 "\uc0\u22905 \u65306 \u65288 \u36305 \u36807 \u26469 \u30475 \u29031 \u29255 \u65289 "\cf0 \strokec4 ; ctx.save(); ctx.translate(\cf5 \strokec5 LOGIC_W\cf0 \strokec4 /\cf8 \strokec8 2\cf0 \strokec4 , \cf8 \strokec8 300\cf0 \strokec4 ); ctx.scale(\cf8 \strokec8 2\cf0 \strokec4 , \cf8 \strokec8 2\cf0 \strokec4 ); drawBean(\cf8 \strokec8 0\cf0 \strokec4 , \cf8 \strokec8 0\cf0 \strokec4 , \cf2 \strokec2 true\cf0 \strokec4 , \cf6 \strokec6 'happy'\cf0 \strokec4 , \cf8 \strokec8 1\cf0 \strokec4 , \cf2 \strokec2 true\cf0 \strokec4 ); ctx.restore(); \} \cf2 \strokec2 else\cf0 \strokec4  \{ msg = \cf6 \strokec6 "\uc0\u22905 \u65306 \u23453 \u23453 \u20320 \u25293 \u30340 \u20063 \u22826 \u22909 \u20102 \u21596 \u21596 \u21596 \u55358 \u56697  \u25105 \u22909 \u29233 \u20320 \u65281 "\cf0 \strokec4 ; ctx.save(); ctx.translate(\cf5 \strokec5 LOGIC_W\cf0 \strokec4 /\cf8 \strokec8 2\cf0 \strokec4 , \cf8 \strokec8 200\cf0 \strokec4 ); ctx.scale(\cf8 \strokec8 1.5\cf0 \strokec4 , \cf8 \strokec8 1.5\cf0 \strokec4 ); drawText(\cf6 \strokec6 "\uc0\u10084 "\cf0 \strokec4 , \cf8 \strokec8 0\cf0 \strokec4 , \cf8 \strokec8 0\cf0 \strokec4 , \cf8 \strokec8 50\cf0 \strokec4 , \cf5 \strokec5 COLORS\cf0 \strokec4 .primary); ctx.restore(); \cf2 \strokec2 if\cf0 \strokec4  (p.timer > \cf8 \strokec8 300\cf0 \strokec4 ) \{ f.scene6Correct = \cf2 \strokec2 true\cf0 \strokec4 ; s.score += \cf8 \strokec8 2\cf0 \strokec4 ; transitionTo(\cf5 \strokec5 STATE\cf0 \strokec4 .\cf5 \strokec5 SCENE_7_SKINCARE\cf0 \strokec4 ); \} \}\cb1 \
\cb3       \}\cb1 \
\cb3       \cf2 \strokec2 if\cf0 \strokec4  (p.phase >= \cf8 \strokec8 2\cf0 \strokec4 ) drawParagraph(typeText(msg, \cf8 \strokec8 5\cf0 \strokec4 ), \cf8 \strokec8 40\cf0 \strokec4 , \cf8 \strokec8 100\cf0 \strokec4 , \cf8 \strokec8 370\cf0 \strokec4 , \cf8 \strokec8 26\cf0 \strokec4 , \cf8 \strokec8 18\cf0 \strokec4 , textColor, \cf6 \strokec6 'left'\cf0 \strokec4 ); \cf2 \strokec2 else\cf0 \strokec4  drawText(typeText(msg, \cf8 \strokec8 5\cf0 \strokec4 ), \cf5 \strokec5 LOGIC_W\cf0 \strokec4 /\cf8 \strokec8 2\cf0 \strokec4 , \cf8 \strokec8 100\cf0 \strokec4 , \cf8 \strokec8 18\cf0 \strokec4 , textColor);\cb1 \
\cb3     \};\cb1 \
\
\cb3     \cf2 \strokec2 const\cf0 \strokec4  updateScene7Skincare = () => \{\cb1 \
\cb3       \cf2 \strokec2 const\cf0 \strokec4  s = gameState.current; \cf2 \strokec2 const\cf0 \strokec4  k = s.skin; \cf2 \strokec2 const\cf0 \strokec4  f = s.flags; k.timer++;\cb1 \
\cb3       ctx.fillStyle = \cf6 \strokec6 '#fdf5e6'\cf0 \strokec4 ; ctx.fillRect(\cf8 \strokec8 0\cf0 \strokec4 , \cf8 \strokec8 0\cf0 \strokec4 , \cf5 \strokec5 LOGIC_W\cf0 \strokec4 , \cf5 \strokec5 LOGIC_H\cf0 \strokec4 );\cb1 \
\cb3       \cf2 \strokec2 const\cf0 \strokec4  bedY = \cf8 \strokec8 350\cf0 \strokec4 ; drawRect(\cf8 \strokec8 50\cf0 \strokec4 , bedY, \cf5 \strokec5 LOGIC_W\cf0 \strokec4  - \cf8 \strokec8 100\cf0 \strokec4 , \cf8 \strokec8 250\cf0 \strokec4 , \cf6 \strokec6 '#e0e0e0'\cf0 \strokec4 , \cf8 \strokec8 20\cf0 \strokec4 ); drawRect(\cf8 \strokec8 50\cf0 \strokec4 , bedY + \cf8 \strokec8 100\cf0 \strokec4 , \cf5 \strokec5 LOGIC_W\cf0 \strokec4  - \cf8 \strokec8 100\cf0 \strokec4 , \cf8 \strokec8 150\cf0 \strokec4 , \cf6 \strokec6 '#fff'\cf0 \strokec4 , \cf8 \strokec8 20\cf0 \strokec4 ); drawRect(\cf8 \strokec8 80\cf0 \strokec4 , bedY - \cf8 \strokec8 20\cf0 \strokec4 , \cf8 \strokec8 100\cf0 \strokec4 , \cf8 \strokec8 50\cf0 \strokec4 , \cf6 \strokec6 '#fff'\cf0 \strokec4 , \cf8 \strokec8 10\cf0 \strokec4 ); drawRect(\cf5 \strokec5 LOGIC_W\cf0 \strokec4  - \cf8 \strokec8 180\cf0 \strokec4 , bedY - \cf8 \strokec8 20\cf0 \strokec4 , \cf8 \strokec8 100\cf0 \strokec4 , \cf8 \strokec8 50\cf0 \strokec4 , \cf6 \strokec6 '#fff'\cf0 \strokec4 , \cf8 \strokec8 10\cf0 \strokec4 );\cb1 \
\cb3       drawRect(\cf8 \strokec8 20\cf0 \strokec4 , \cf8 \strokec8 500\cf0 \strokec4 , \cf8 \strokec8 80\cf0 \strokec4 , \cf8 \strokec8 120\cf0 \strokec4 , \cf6 \strokec6 '#8b4513'\cf0 \strokec4 , \cf8 \strokec8 5\cf0 \strokec4 );\cb1 \
\cb3       \cf2 \strokec2 const\cf0 \strokec4  bottleX = \cf8 \strokec8 40\cf0 \strokec4 , bottleY = \cf8 \strokec8 510\cf0 \strokec4 , bottleW = \cf8 \strokec8 40\cf0 \strokec4 , bottleH = \cf8 \strokec8 50\cf0 \strokec4 ;\cb1 \
\cb3       \cf2 \strokec2 if\cf0 \strokec4  (k.phase === \cf8 \strokec8 0\cf0 \strokec4  || k.phase === \cf8 \strokec8 1\cf0 \strokec4 ) \{\cb1 \
\cb3         \cf2 \strokec2 if\cf0 \strokec4  (isHover(bottleX - \cf8 \strokec8 20\cf0 \strokec4 , bottleY - \cf8 \strokec8 20\cf0 \strokec4 , bottleW + \cf8 \strokec8 40\cf0 \strokec4 , bottleH + \cf8 \strokec8 40\cf0 \strokec4 )) \{\cb1 \
\cb3           canvas.style.cursor = \cf6 \strokec6 'pointer'\cf0 \strokec4 ;\cb1 \
\cb3           \cf2 \strokec2 if\cf0 \strokec4  (s.mouse.clicked) \{\cb1 \
\cb3             s.mouse.clicked = \cf2 \strokec2 false\cf0 \strokec4 ;\cb1 \
\cb3             \cf2 \strokec2 if\cf0 \strokec4  (k.phase === \cf8 \strokec8 0\cf0 \strokec4 ) \{ k.phase = \cf8 \strokec8 3\cf0 \strokec4 ; k.timer = \cf8 \strokec8 0\cf0 \strokec4 ; s.score = \cf8 \strokec8 0\cf0 \strokec4 ; \}\cb1 \
\cb3             \cf2 \strokec2 else\cf0 \strokec4  \{ k.phase = \cf8 \strokec8 2\cf0 \strokec4 ; k.timer = \cf8 \strokec8 0\cf0 \strokec4 ; f.scene7Correct = \cf2 \strokec2 true\cf0 \strokec4 ; s.score += \cf8 \strokec8 2\cf0 \strokec4 ; \}\cb1 \
\cb3           \}\cb1 \
\cb3         \}\cb1 \
\cb3       \}\cb1 \
\cb3       ctx.fillStyle = \cf6 \strokec6 '#2ecc71'\cf0 \strokec4 ; drawRect(bottleX, bottleY, bottleW, bottleH, \cf6 \strokec6 '#2ecc71'\cf0 \strokec4 , \cf8 \strokec8 5\cf0 \strokec4 ); ctx.fillStyle = \cf6 \strokec6 '#fff'\cf0 \strokec4 ; ctx.fillRect(bottleX + \cf8 \strokec8 10\cf0 \strokec4 , bottleY + \cf8 \strokec8 10\cf0 \strokec4 , \cf8 \strokec8 20\cf0 \strokec4 , \cf8 \strokec8 20\cf0 \strokec4 );\cb1 \
\cb3       \cf2 \strokec2 let\cf0 \strokec4  boyX, boyY, girlX, girlY;\cb1 \
\cb3       \cf2 \strokec2 if\cf0 \strokec4  (k.phase === \cf8 \strokec8 0\cf0 \strokec4  || k.phase === \cf8 \strokec8 3\cf0 \strokec4  || k.phase === \cf8 \strokec8 4\cf0 \strokec4 ) \{ boyX = \cf8 \strokec8 120\cf0 \strokec4 ; boyY = \cf8 \strokec8 300\cf0 \strokec4 ; girlX = \cf8 \strokec8 250\cf0 \strokec4 ; girlY = \cf8 \strokec8 320\cf0 \strokec4 ; \} \cf2 \strokec2 else\cf0 \strokec4  \{ boyX = \cf8 \strokec8 250\cf0 \strokec4 ; boyY = \cf8 \strokec8 320\cf0 \strokec4 ; girlX = \cf8 \strokec8 120\cf0 \strokec4 ; girlY = \cf8 \strokec8 300\cf0 \strokec4 ; \}\cb1 \
\cb3       drawBean(boyX, boyY, \cf2 \strokec2 false\cf0 \strokec4 ); drawBean(girlX, girlY, \cf2 \strokec2 true\cf0 \strokec4 , \cf6 \strokec6 'normal'\cf0 \strokec4 , \cf8 \strokec8 1\cf0 \strokec4 , \cf2 \strokec2 true\cf0 \strokec4 );\cb1 \
\cb3       ctx.strokeStyle = \cf6 \strokec6 '#333'\cf0 \strokec4 ; ctx.lineWidth = \cf8 \strokec8 3\cf0 \strokec4 ; ctx.beginPath();\cb1 \
\cb3       \cf2 \strokec2 if\cf0 \strokec4  (k.phase === \cf8 \strokec8 0\cf0 \strokec4  || k.phase === \cf8 \strokec8 3\cf0 \strokec4  || k.phase === \cf8 \strokec8 4\cf0 \strokec4 ) \{ ctx.moveTo(girlX - \cf8 \strokec8 40\cf0 \strokec4 , girlY + \cf8 \strokec8 30\cf0 \strokec4 ); ctx.lineTo(boyX + \cf8 \strokec8 20\cf0 \strokec4 , boyY); \} \cf2 \strokec2 else\cf0 \strokec4  \{ ctx.moveTo(boyX - \cf8 \strokec8 40\cf0 \strokec4 , boyY + \cf8 \strokec8 30\cf0 \strokec4 ); ctx.lineTo(girlX + \cf8 \strokec8 20\cf0 \strokec4 , girlY); \}\cb1 \
\cb3       ctx.stroke();\cb1 \
\cb3       drawRect(\cf8 \strokec8 20\cf0 \strokec4 , \cf8 \strokec8 60\cf0 \strokec4 , \cf5 \strokec5 LOGIC_W\cf0 \strokec4  - \cf8 \strokec8 40\cf0 \strokec4 , \cf8 \strokec8 120\cf0 \strokec4 , \cf6 \strokec6 '#fff'\cf0 \strokec4 , \cf8 \strokec8 10\cf0 \strokec4 ); ctx.strokeStyle = \cf6 \strokec6 '#333'\cf0 \strokec4 ; ctx.lineWidth = \cf8 \strokec8 2\cf0 \strokec4 ; ctx.strokeRect(\cf8 \strokec8 20\cf0 \strokec4 , \cf8 \strokec8 60\cf0 \strokec4 , \cf5 \strokec5 LOGIC_W\cf0 \strokec4  - \cf8 \strokec8 40\cf0 \strokec4 , \cf8 \strokec8 120\cf0 \strokec4 );\cb1 \
\cb3       \cf2 \strokec2 let\cf0 \strokec4  msg = \cf6 \strokec6 ""\cf0 \strokec4 ;\cb1 \
\cb3       \cf2 \strokec2 if\cf0 \strokec4  (k.phase === \cf8 \strokec8 0\cf0 \strokec4 ) \{\cb1 \
\cb3         \cf2 \strokec2 if\cf0 \strokec4  (k.timer < \cf8 \strokec8 120\cf0 \strokec4 ) msg = \cf6 \strokec6 "\uc0\u65288 \u22905 \u27491 \u22312 \u32473 \u20320 \u25830 \u25252 \u32932 \u38684 ...\u65289 "\cf0 \strokec4 ; \cf2 \strokec2 else\cf0 \strokec4  \{\cb1 \
\cb3           msg = \cf6 \strokec6 "\uc0\u25105 \u24212 \u35813 ..."\cf0 \strokec4 ;\cb1 \
\cb3           drawButton(\cf6 \strokec6 "\uc0\u21035 \u32473 \u25105 \u25830 \u20102 \u65292 \u25105 \u19981 \u35201 "\cf0 \strokec4 , (\cf5 \strokec5 LOGIC_W\cf0 \strokec4 -\cf8 \strokec8 280\cf0 \strokec4 )/\cf8 \strokec8 2\cf0 \strokec4 , \cf8 \strokec8 680\cf0 \strokec4 , \cf8 \strokec8 280\cf0 \strokec4 , \cf8 \strokec8 40\cf0 \strokec4 , () => \{ k.phase = \cf8 \strokec8 1\cf0 \strokec4 ; k.timer = \cf8 \strokec8 0\cf0 \strokec4 ; \});\cb1 \
\cb3           drawButton(\cf6 \strokec6 "\uc0\u35874 \u35874 \u23453 \u23453 \u65374 \u21916 \u27426 \u65374 "\cf0 \strokec4 , (\cf5 \strokec5 LOGIC_W\cf0 \strokec4 -\cf8 \strokec8 280\cf0 \strokec4 )/\cf8 \strokec8 2\cf0 \strokec4 , \cf8 \strokec8 730\cf0 \strokec4 , \cf8 \strokec8 280\cf0 \strokec4 , \cf8 \strokec8 40\cf0 \strokec4 , () => \{ k.phase = \cf8 \strokec8 4\cf0 \strokec4 ; k.timer = \cf8 \strokec8 0\cf0 \strokec4 ; s.score = \cf8 \strokec8 0\cf0 \strokec4 ; \}); \cb1 \
\cb3         \}\cb1 \
\cb3       \} \cf2 \strokec2 else\cf0 \strokec4  \cf2 \strokec2 if\cf0 \strokec4  (k.phase === \cf8 \strokec8 1\cf0 \strokec4 ) \{\cb1 \
\cb3         \cf2 \strokec2 if\cf0 \strokec4  (k.timer < \cf8 \strokec8 150\cf0 \strokec4 ) msg = \cf6 \strokec6 "\uc0\u25105 \u65306 \u27599 \u27425 \u37117 \u26159 \u20320 \u32473 \u25105 \u25830 \u65292 \u20197 \u21518 \u37117 \u35753 \u25105 \u32473 \u20320 \u25830 \u12290 "\cf0 \strokec4 ; \cf2 \strokec2 else\cf0 \strokec4  \{\cb1 \
\cb3           msg = \cf6 \strokec6 "\uc0\u65288 \u36731 \u36731 \u24110 \u22905 \u25830 \u25325 \u33080 \u39050 ...\u65289 "\cf0 \strokec4 ;\cb1 \
\cb3           drawButton(\cf6 \strokec6 "\uc0\u36825 \u26679 \u25830 \u30528 \u33298 \u26381 \u21527 \u65311 "\cf0 \strokec4 , (\cf5 \strokec5 LOGIC_W\cf0 \strokec4 -\cf8 \strokec8 280\cf0 \strokec4 )/\cf8 \strokec8 2\cf0 \strokec4 , \cf8 \strokec8 680\cf0 \strokec4 , \cf8 \strokec8 280\cf0 \strokec4 , \cf8 \strokec8 40\cf0 \strokec4 , () => \{ k.phase = \cf8 \strokec8 5\cf0 \strokec4 ; k.timer = \cf8 \strokec8 0\cf0 \strokec4 ; s.score = \cf8 \strokec8 4\cf0 \strokec4 ; \}); \cb1 \
\cb3           drawButton(\cf6 \strokec6 "\uc0\u23453 \u23453 \u20320 \u30340 \u30382 \u32932 \u22909 \u24178 \u29157 "\cf0 \strokec4 , (\cf5 \strokec5 LOGIC_W\cf0 \strokec4 -\cf8 \strokec8 280\cf0 \strokec4 )/\cf8 \strokec8 2\cf0 \strokec4 , \cf8 \strokec8 730\cf0 \strokec4 , \cf8 \strokec8 280\cf0 \strokec4 , \cf8 \strokec8 40\cf0 \strokec4 , () => \{ k.phase = \cf8 \strokec8 6\cf0 \strokec4 ; k.timer = \cf8 \strokec8 0\cf0 \strokec4 ; s.score = \cf8 \strokec8 0\cf0 \strokec4 ; \}); \cb1 \
\cb3         \}\cb1 \
\cb3       \} \cf2 \strokec2 else\cf0 \strokec4  \cf2 \strokec2 if\cf0 \strokec4  (k.phase === \cf8 \strokec8 2\cf0 \strokec4 ) \{\cb1 \
\cb3         \cf2 \strokec2 if\cf0 \strokec4  (k.timer < \cf8 \strokec8 150\cf0 \strokec4 ) msg = \cf6 \strokec6 "\uc0\u25105 \u65306 \u22079 \u22079 \u65292 \u25105 \u30693 \u36947 \u20320 \u30340 \u32511 \u23453 \u29942 \u24555 \u29992 \u23436 \u20102 \u65292 \u20080 \u20102 \u26032 \u30340 \u12290 "\cf0 \strokec4 ; \cf2 \strokec2 else\cf0 \strokec4  \{\cb1 \
\cb3           msg = \cf6 \strokec6 "\uc0\u65288 \u25487 \u20986 \u23853 \u26032 \u30340 \u25252 \u32932 \u21697 \u36882 \u32473 \u22905 \u65289 "\cf0 \strokec4 ;\cb1 \
\cb3           \cf2 \strokec2 if\cf0 \strokec4  (!k.newBottleShown) \{ ctx.fillStyle = \cf6 \strokec6 '#2ecc71'\cf0 \strokec4 ; drawRect(\cf8 \strokec8 200\cf0 \strokec4 , \cf8 \strokec8 250\cf0 \strokec4 , \cf8 \strokec8 60\cf0 \strokec4 , \cf8 \strokec8 80\cf0 \strokec4 , \cf6 \strokec6 '#2ecc71'\cf0 \strokec4 , \cf8 \strokec8 5\cf0 \strokec4 ); ctx.fillStyle = \cf6 \strokec6 '#f1c40f'\cf0 \strokec4 ; drawCircle(\cf8 \strokec8 230\cf0 \strokec4 , \cf8 \strokec8 270\cf0 \strokec4 , \cf8 \strokec8 15\cf0 \strokec4 , \cf6 \strokec6 '#f1c40f'\cf0 \strokec4 ); \}\cb1 \
\cb3           \cf2 \strokec2 if\cf0 \strokec4  (k.timer > \cf8 \strokec8 300\cf0 \strokec4 ) transitionTo(\cf5 \strokec5 STATE\cf0 \strokec4 .\cf5 \strokec5 ENDING\cf0 \strokec4 );\cb1 \
\cb3         \}\cb1 \
\cb3       \} \cf2 \strokec2 else\cf0 \strokec4  \cf2 \strokec2 if\cf0 \strokec4  (k.phase === \cf8 \strokec8 3\cf0 \strokec4 ) \{ msg = \cf6 \strokec6 "\uc0\u22905 \u65306 \u25105 \u30340 \u25252 \u32932 \u21697 \u37117 \u29992 \u23436 \u20102 \u20320 \u20063 \u19981 \u32473 \u25105 \u20080 ..."\cf0 \strokec4 ; \cf2 \strokec2 if\cf0 \strokec4  (k.timer > \cf8 \strokec8 150\cf0 \strokec4 ) transitionTo(\cf5 \strokec5 STATE\cf0 \strokec4 .\cf5 \strokec5 ENDING\cf0 \strokec4 ); \}\cb1 \
\cb3       \cf2 \strokec2 else\cf0 \strokec4  \cf2 \strokec2 if\cf0 \strokec4  (k.phase === \cf8 \strokec8 4\cf0 \strokec4 ) \{ msg = \cf6 \strokec6 "\uc0\u22905 \u65306 \u20320 \u22909 \u24694 \u24515 \u55358 \u56622 "\cf0 \strokec4 ; \cf2 \strokec2 if\cf0 \strokec4  (k.timer > \cf8 \strokec8 100\cf0 \strokec4 ) transitionTo(\cf5 \strokec5 STATE\cf0 \strokec4 .\cf5 \strokec5 ENDING\cf0 \strokec4 ); \}\cb1 \
\cb3       \cf2 \strokec2 else\cf0 \strokec4  \cf2 \strokec2 if\cf0 \strokec4  (k.phase === \cf8 \strokec8 5\cf0 \strokec4 ) \{ msg = \cf6 \strokec6 "\uc0\u22905 \u65306 \u36824 \u34892 \u21543 \u65292 \u36319 \u25105 \u30340 \u25216 \u26415 \u30456 \u27604 \u36824 \u26159 \u26377 \u24046 \u36317 \u12290 "\cf0 \strokec4 ; \cf2 \strokec2 if\cf0 \strokec4  (k.timer > \cf8 \strokec8 150\cf0 \strokec4 ) transitionTo(\cf5 \strokec5 STATE\cf0 \strokec4 .\cf5 \strokec5 ENDING\cf0 \strokec4 ); \}\cb1 \
\cb3       \cf2 \strokec2 else\cf0 \strokec4  \cf2 \strokec2 if\cf0 \strokec4  (k.phase === \cf8 \strokec8 6\cf0 \strokec4 ) \{ msg = \cf6 \strokec6 "\uc0\u22905 \u65306 \u20320 \u36824 \u30693 \u36947 \u21834 \u65311 \u29233 \u19982 \u19981 \u29233 \u30495 \u30340 \u24456 \u26126 \u26174 \u12290 "\cf0 \strokec4 ; \cf2 \strokec2 if\cf0 \strokec4  (k.timer > \cf8 \strokec8 150\cf0 \strokec4 ) transitionTo(\cf5 \strokec5 STATE\cf0 \strokec4 .\cf5 \strokec5 ENDING\cf0 \strokec4 ); \}\cb1 \
\cb3       drawParagraph(typeText(msg, \cf8 \strokec8 5\cf0 \strokec4 ), \cf8 \strokec8 40\cf0 \strokec4 , \cf8 \strokec8 100\cf0 \strokec4 , \cf8 \strokec8 370\cf0 \strokec4 , \cf8 \strokec8 26\cf0 \strokec4 , \cf8 \strokec8 18\cf0 \strokec4 , \cf6 \strokec6 '#333'\cf0 \strokec4 , \cf6 \strokec6 'left'\cf0 \strokec4 );\cb1 \
\cb3     \};\cb1 \
\
\cb3     \cf2 \strokec2 const\cf0 \strokec4  updateEnding = () => \{\cb1 \
\cb3       \cf2 \strokec2 const\cf0 \strokec4  s = gameState.current;\cb1 \
\cb3       ctx.fillStyle = \cf5 \strokec5 COLORS\cf0 \strokec4 .bg; ctx.fillRect(\cf8 \strokec8 0\cf0 \strokec4 , \cf8 \strokec8 0\cf0 \strokec4 , \cf5 \strokec5 LOGIC_W\cf0 \strokec4 , \cf5 \strokec5 LOGIC_H\cf0 \strokec4 );\cb1 \
\cb3       \cb1 \
\cb3       \cf2 \strokec2 let\cf0 \strokec4  title = \cf6 \strokec6 ""\cf0 \strokec4 , desc = \cf6 \strokec6 ""\cf0 \strokec4 , color = \cf6 \strokec6 ""\cf0 \strokec4 ;\cb1 \
\cb3       \cf2 \strokec2 if\cf0 \strokec4  (checkPerfectRun()) \{\cb1 \
\cb3         \cf2 \strokec2 const\cf0 \strokec4  grad = ctx.createLinearGradient(\cf8 \strokec8 0\cf0 \strokec4 , \cf8 \strokec8 0\cf0 \strokec4 , \cf8 \strokec8 0\cf0 \strokec4 , \cf5 \strokec5 LOGIC_H\cf0 \strokec4 );\cb1 \
\cb3         grad.addColorStop(\cf8 \strokec8 0\cf0 \strokec4 , \cf6 \strokec6 '#ff9a9e'\cf0 \strokec4 ); grad.addColorStop(\cf8 \strokec8 1\cf0 \strokec4 , \cf6 \strokec6 '#fecfef'\cf0 \strokec4 );\cb1 \
\cb3         ctx.fillStyle = grad; ctx.fillRect(\cf8 \strokec8 0\cf0 \strokec4 , \cf8 \strokec8 0\cf0 \strokec4 , \cf5 \strokec5 LOGIC_W\cf0 \strokec4 , \cf5 \strokec5 LOGIC_H\cf0 \strokec4 );\cb1 \
\cb3         \cf2 \strokec2 for\cf0 \strokec4  (\cf2 \strokec2 let\cf0 \strokec4  i = \cf8 \strokec8 0\cf0 \strokec4 ; i < \cf8 \strokec8 20\cf0 \strokec4 ; i++) \{\cb1 \
\cb3             \cf2 \strokec2 const\cf0 \strokec4  t = s.frameCount * \cf8 \strokec8 0.02\cf0 \strokec4  + i * \cf8 \strokec8 100\cf0 \strokec4 ; \cf2 \strokec2 const\cf0 \strokec4  x = (\cf5 \strokec5 Math\cf0 \strokec4 .sin(t * \cf8 \strokec8 0.5\cf0 \strokec4  + i) * \cf8 \strokec8 200\cf0 \strokec4  + \cf5 \strokec5 LOGIC_W\cf0 \strokec4  / \cf8 \strokec8 2\cf0 \strokec4 ); \cf2 \strokec2 const\cf0 \strokec4  y = (t * \cf8 \strokec8 50\cf0 \strokec4  + i * \cf8 \strokec8 100\cf0 \strokec4 ) % (\cf5 \strokec5 LOGIC_H\cf0 \strokec4  + \cf8 \strokec8 100\cf0 \strokec4 ) - \cf8 \strokec8 50\cf0 \strokec4 ; \cf2 \strokec2 const\cf0 \strokec4  size = \cf8 \strokec8 20\cf0 \strokec4  + \cf5 \strokec5 Math\cf0 \strokec4 .sin(t) * \cf8 \strokec8 10\cf0 \strokec4 ;\cb1 \
\cb3             ctx.save(); ctx.translate(x, y); ctx.globalAlpha = \cf8 \strokec8 0.3\cf0 \strokec4 ; drawText(\cf6 \strokec6 "\uc0\u10084 "\cf0 \strokec4 , \cf8 \strokec8 0\cf0 \strokec4 , \cf8 \strokec8 0\cf0 \strokec4 , size, \cf6 \strokec6 '#fff'\cf0 \strokec4 ); ctx.restore();\cb1 \
\cb3         \}\cb1 \
\cb3         ctx.globalAlpha = \cf8 \strokec8 1.0\cf0 \strokec4 ;\cb1 \
\cb3         drawText(\cf6 \strokec6 "2\uc0\u21608 \u24180 \u24555 \u20048 \u65281 "\cf0 \strokec4 , \cf5 \strokec5 LOGIC_W\cf0 \strokec4  / \cf8 \strokec8 2\cf0 \strokec4 , \cf8 \strokec8 120\cf0 \strokec4 , \cf8 \strokec8 48\cf0 \strokec4 , \cf6 \strokec6 '#fff'\cf0 \strokec4 , \cf6 \strokec6 'center'\cf0 \strokec4 , \cf6 \strokec6 'Arial'\cf0 \strokec4 );\cb1 \
\cb3         \cf2 \strokec2 const\cf0 \strokec4  centerX = \cf5 \strokec5 LOGIC_W\cf0 \strokec4  / \cf8 \strokec8 2\cf0 \strokec4 , charY = \cf8 \strokec8 250\cf0 \strokec4 ;\cb1 \
\cb3         drawBean(centerX - \cf8 \strokec8 35\cf0 \strokec4 , charY, \cf2 \strokec2 false\cf0 \strokec4 , \cf6 \strokec6 'happy'\cf0 \strokec4 , \cf8 \strokec8 1.2\cf0 \strokec4 ); drawBean(centerX + \cf8 \strokec8 35\cf0 \strokec4 , charY, \cf2 \strokec2 true\cf0 \strokec4 , \cf6 \strokec6 'happy'\cf0 \strokec4 , \cf8 \strokec8 1.2\cf0 \strokec4 , \cf2 \strokec2 true\cf0 \strokec4 );\cb1 \
\cb3         ctx.save(); ctx.translate(centerX, charY - \cf8 \strokec8 80\cf0 \strokec4 ); \cf2 \strokec2 const\cf0 \strokec4  beat = \cf8 \strokec8 1\cf0 \strokec4  + \cf5 \strokec5 Math\cf0 \strokec4 .sin(s.frameCount * \cf8 \strokec8 0.1\cf0 \strokec4 ) * \cf8 \strokec8 0.1\cf0 \strokec4 ; ctx.scale(beat, beat); drawText(\cf6 \strokec6 "\uc0\u10084 "\cf0 \strokec4 , \cf8 \strokec8 0\cf0 \strokec4 , \cf8 \strokec8 0\cf0 \strokec4 , \cf8 \strokec8 60\cf0 \strokec4 , \cf6 \strokec6 '#ff2442'\cf0 \strokec4 ); ctx.restore();\cb1 \
\
\cb3         \cf2 \strokec2 const\cf0 \strokec4  lines = [\cb1 \
\cb3             \cf6 \strokec6 "\uc0\u20146 \u29233 \u30340 \u27224 \u23376 \u65306 "\cf0 \strokec4 , \cf6 \strokec6 ""\cf0 \strokec4 ,\cb1 \
\cb3             \cf6 \strokec6 "\uc0\u20004 \u21608 \u24180 \u24555 \u20048 \u65281 "\cf0 \strokec4 ,\cb1 \
\cb3             \cf6 \strokec6 "\uc0\u35874 \u35874 \u20320 \u36825 \u20004 \u24180 \u30340 \u21253 \u23481 \u19982 \u38506 \u20276 \u12290 "\cf0 \strokec4 ,\cb1 \
\cb3             \cf6 \strokec6 "\uc0\u26410 \u26469 \u30340 \u27599 \u19968 \u20010 \u26149 \u22799 \u31179 \u20908 \u65292 "\cf0 \strokec4 ,\cb1 \
\cb3             \cf6 \strokec6 "\uc0\u25105 \u37117 \u24819 \u21644 \u20320 \u19968 \u36215 \u24230 \u36807 \u12290 "\cf0 \strokec4 , \cf6 \strokec6 ""\cf0 \strokec4 ,\cb1 \
\cb3             \cf6 \strokec6 "\uc0\u29233 \u20320 \u30340  \u20271 \u29273 "\cf0 \strokec4 , \cf6 \strokec6 "2023.11.26"\cf0 \cb1 \strokec4 \
\cb3         ];\cb1 \
\cb3         \cf2 \strokec2 let\cf0 \strokec4  startY = \cf8 \strokec8 380\cf0 \strokec4 ;\cb1 \
\cb3         lines.forEach((line, i) => \{\cb1 \
\cb3             \cf2 \strokec2 if\cf0 \strokec4  (s.frameCount > i * \cf8 \strokec8 20\cf0 \strokec4 ) \{\cb1 \
\cb3                 \cf2 \strokec2 const\cf0 \strokec4  alpha = \cf5 \strokec5 Math\cf0 \strokec4 .min(\cf8 \strokec8 1\cf0 \strokec4 , (s.frameCount - i * \cf8 \strokec8 20\cf0 \strokec4 ) / \cf8 \strokec8 20\cf0 \strokec4 );\cb1 \
\cb3                 ctx.globalAlpha = alpha; ctx.fillStyle = \cf6 \strokec6 '#333'\cf0 \strokec4 ; ctx.font = \cf6 \strokec6 `18px "ZCOOL KuaiLe", sans-serif`\cf0 \strokec4 ; ctx.textAlign = \cf6 \strokec6 'center'\cf0 \strokec4 ; ctx.fillText(line, \cf5 \strokec5 LOGIC_W\cf0 \strokec4  / \cf8 \strokec8 2\cf0 \strokec4 , startY + i * \cf8 \strokec8 28\cf0 \strokec4 );\cb1 \
\cb3             \}\cb1 \
\cb3         \});\cb1 \
\cb3         ctx.globalAlpha = \cf8 \strokec8 1.0\cf0 \strokec4 ;\cb1 \
\
\cb3         \cf2 \strokec2 if\cf0 \strokec4  (s.frameCount > lines.length * \cf8 \strokec8 20\cf0 \strokec4  + \cf8 \strokec8 60\cf0 \strokec4 ) \{\cb1 \
\cb3             drawButton(\cf6 \strokec6 "\uc0\u37325 \u28201 \u25105 \u20204 \u30340 \u25925 \u20107 "\cf0 \strokec4 , (\cf5 \strokec5 LOGIC_W\cf0 \strokec4  - \cf8 \strokec8 240\cf0 \strokec4 )/\cf8 \strokec8 2\cf0 \strokec4 , \cf8 \strokec8 720\cf0 \strokec4 , \cf8 \strokec8 240\cf0 \strokec4 , \cf8 \strokec8 50\cf0 \strokec4 , () => \{ transitionTo(\cf5 \strokec5 STATE\cf0 \strokec4 .\cf5 \strokec5 SCENE_1_NOTIFICATION\cf0 \strokec4 , \cf2 \strokec2 false\cf0 \strokec4 , resetGame); \}, \cf6 \strokec6 '#ff6b81'\cf0 \strokec4 );\cb1 \
\cb3         \}\cb1 \
\cb3       \} \cf2 \strokec2 else\cf0 \strokec4  \{\cb1 \
\cb3         drawText(\cf6 \strokec6 "\uc0\u25925 \u20107 \u32467 \u26463 "\cf0 \strokec4 , \cf5 \strokec5 LOGIC_W\cf0 \strokec4  / \cf8 \strokec8 2\cf0 \strokec4 , \cf8 \strokec8 200\cf0 \strokec4 , \cf8 \strokec8 40\cf0 \strokec4 , \cf6 \strokec6 '#333'\cf0 \strokec4 );\cb1 \
\cb3         \cf2 \strokec2 const\cf0 \strokec4  findFirstMistake = () => \{\cb1 \
\cb3           \cf2 \strokec2 const\cf0 \strokec4  f = s.flags;\cb1 \
\cb3           \cf2 \strokec2 if\cf0 \strokec4  (!f.scene1Correct) \cf2 \strokec2 return\cf0 \strokec4  \{ state: \cf5 \strokec5 STATE\cf0 \strokec4 .\cf5 \strokec5 SCENE_1_CHAT\cf0 \strokec4 , label: \cf6 \strokec6 "\uc0\u22238 \u21040  \u32842 \u22825 "\cf0 \strokec4  \};\cb1 \
\cb3           \cf2 \strokec2 if\cf0 \strokec4  (!f.paidSecretly) \cf2 \strokec2 return\cf0 \strokec4  \{ state: \cf5 \strokec5 STATE\cf0 \strokec4 .\cf5 \strokec5 SCENE_2_DINNER\cf0 \strokec4 , label: \cf6 \strokec6 "\uc0\u22238 \u21040  \u26202 \u39184 "\cf0 \strokec4  \};\cb1 \
\cb3           \cf2 \strokec2 if\cf0 \strokec4  (!f.gaveCoat) \cf2 \strokec2 return\cf0 \strokec4  \{ state: \cf5 \strokec5 STATE\cf0 \strokec4 .\cf5 \strokec5 SCENE_3_WALK\cf0 \strokec4 , label: \cf6 \strokec6 "\uc0\u22238 \u21040  \u23506 \u22812 "\cf0 \strokec4  \};\cb1 \
\cb3           \cf2 \strokec2 if\cf0 \strokec4  (!f.usedLipstick) \cf2 \strokec2 return\cf0 \strokec4  \{ state: \cf5 \strokec5 STATE\cf0 \strokec4 .\cf5 \strokec5 SCENE_HOME_TV\cf0 \strokec4 , label: \cf6 \strokec6 "\uc0\u22238 \u21040  \u27801 \u21457 "\cf0 \strokec4  \};\cb1 \
\cb3           \cf2 \strokec2 if\cf0 \strokec4  (!f.scene5Correct) \cf2 \strokec2 return\cf0 \strokec4  \{ state: \cf5 \strokec5 STATE\cf0 \strokec4 .\cf5 \strokec5 SCENE_5_HAIR\cf0 \strokec4 , label: \cf6 \strokec6 "\uc0\u22238 \u21040  \u21561 \u22836 \u21457 "\cf0 \strokec4  \};\cb1 \
\cb3           \cf2 \strokec2 if\cf0 \strokec4  (!f.scene6Correct) \cf2 \strokec2 return\cf0 \strokec4  \{ state: \cf5 \strokec5 STATE\cf0 \strokec4 .\cf5 \strokec5 SCENE_6_PHOTO\cf0 \strokec4 , label: \cf6 \strokec6 "\uc0\u22238 \u21040  \u25293 \u29031 "\cf0 \strokec4  \};\cb1 \
\cb3           \cf2 \strokec2 if\cf0 \strokec4  (!f.scene7Correct) \cf2 \strokec2 return\cf0 \strokec4  \{ state: \cf5 \strokec5 STATE\cf0 \strokec4 .\cf5 \strokec5 SCENE_7_SKINCARE\cf0 \strokec4 , label: \cf6 \strokec6 "\uc0\u22238 \u21040  \u25252 \u32932 "\cf0 \strokec4  \};\cb1 \
\cb3           \cf2 \strokec2 return\cf0 \strokec4  \cf2 \strokec2 null\cf0 \strokec4 ;\cb1 \
\cb3         \};\cb1 \
\cb3         \cf2 \strokec2 const\cf0 \strokec4  mistake = findFirstMistake();\cb1 \
\cb3         \cf2 \strokec2 if\cf0 \strokec4  (mistake) \{\cb1 \
\cb3           drawButton(mistake.label, (\cf5 \strokec5 LOGIC_W\cf0 \strokec4  - \cf8 \strokec8 200\cf0 \strokec4 )/\cf8 \strokec8 2\cf0 \strokec4 , \cf8 \strokec8 600\cf0 \strokec4 , \cf8 \strokec8 200\cf0 \strokec4 , \cf8 \strokec8 50\cf0 \strokec4 , () => \{ retryFromMistake(mistake.state); \}, \cf6 \strokec6 "#3498db"\cf0 \strokec4 );\cb1 \
\cb3         \}\cb1 \
\cb3         \cf2 \strokec2 if\cf0 \strokec4  (s.score >= \cf8 \strokec8 4\cf0 \strokec4 ) \{ title = \cf6 \strokec6 "\uc0\u26222 \u36890 \u32467 \u23616 \u65306 \u22909 \u20154 \u21345 "\cf0 \strokec4 ; desc = \cf6 \strokec6 "\uc0\u20320 \u26159 \u20010 \u22909 \u20154 \u65292 \u20294 \u21487 \u33021 \u36824 \u19981 \u22815 \u25026 \u22905 \u12290 "\cf0 \strokec4 ; color = \cf6 \strokec6 "#f39c12"\cf0 \strokec4 ; drawText(\cf6 \strokec6 "\uc0\u55357 \u56848 "\cf0 \strokec4 , \cf5 \strokec5 LOGIC_W\cf0 \strokec4  / \cf8 \strokec8 2\cf0 \strokec4 , \cf8 \strokec8 400\cf0 \strokec4 , \cf8 \strokec8 60\cf0 \strokec4 , \cf6 \strokec6 "#333"\cf0 \strokec4 ); \}\cb1 \
\cb3         \cf2 \strokec2 else\cf0 \strokec4  \{ title = \cf6 \strokec6 "\uc0\u22351 \u32467 \u23616 \u65306 \u38050 \u38081 \u30452 \u30007 "\cf0 \strokec4 ; desc = \cf6 \strokec6 "\uc0\u26377 \u20123 \u26426 \u20250 \u38169 \u36807 \u20102 \u65292 \u23601 \u30495 \u30340 \u38169 \u36807 \u20102 \u12290 "\cf0 \strokec4 ; color = \cf6 \strokec6 "#7f8c8d"\cf0 \strokec4 ; drawText(\cf6 \strokec6 "\uc0\u55357 \u56468 "\cf0 \strokec4 , \cf5 \strokec5 LOGIC_W\cf0 \strokec4  / \cf8 \strokec8 2\cf0 \strokec4 , \cf8 \strokec8 400\cf0 \strokec4 , \cf8 \strokec8 60\cf0 \strokec4 , \cf6 \strokec6 "#7f8c8d"\cf0 \strokec4 ); \}\cb1 \
\cb3         drawText(title, \cf5 \strokec5 LOGIC_W\cf0 \strokec4  / \cf8 \strokec8 2\cf0 \strokec4 , \cf8 \strokec8 300\cf0 \strokec4 , \cf8 \strokec8 24\cf0 \strokec4 , color); drawText(desc, \cf5 \strokec5 LOGIC_W\cf0 \strokec4  / \cf8 \strokec8 2\cf0 \strokec4 , \cf8 \strokec8 340\cf0 \strokec4 , \cf8 \strokec8 14\cf0 \strokec4 , \cf6 \strokec6 '#555'\cf0 \strokec4 );\cb1 \
\cb3         drawButton(\cf6 \strokec6 "\uc0\u37325 \u26032 \u24320 \u22987 "\cf0 \strokec4 , (\cf5 \strokec5 LOGIC_W\cf0 \strokec4  - \cf8 \strokec8 200\cf0 \strokec4 )/\cf8 \strokec8 2\cf0 \strokec4 , \cf8 \strokec8 670\cf0 \strokec4 , \cf8 \strokec8 200\cf0 \strokec4 , \cf8 \strokec8 50\cf0 \strokec4 , () => \{ transitionTo(\cf5 \strokec5 STATE\cf0 \strokec4 .\cf5 \strokec5 SCENE_1_NOTIFICATION\cf0 \strokec4 , \cf2 \strokec2 false\cf0 \strokec4 , resetGame); \});\cb1 \
\cb3       \}\cb1 \
\cb3     \};\cb1 \
\
\cb3     \cf2 \strokec2 const\cf0 \strokec4  loop = () => \{\cb1 \
\cb3       \cf2 \strokec2 const\cf0 \strokec4  s = gameState.current;\cb1 \
\cb3       s.frameCount++;\cb1 \
\cb3       ctx.clearRect(\cf8 \strokec8 0\cf0 \strokec4 , \cf8 \strokec8 0\cf0 \strokec4 , canvas.width, canvas.height);\cb1 \
\cb3       \cb1 \
\cb3       \cf2 \strokec2 if\cf0 \strokec4  (s.transition.active) \{\cb1 \
\cb3         \cf2 \strokec2 if\cf0 \strokec4  (s.transition.mode === \cf6 \strokec6 'FADE_OUT'\cf0 \strokec4 ) \{\cb1 \
\cb3           s.transition.alpha += \cf8 \strokec8 0.02\cf0 \strokec4 ;\cb1 \
\cb3           \cf2 \strokec2 if\cf0 \strokec4  (s.transition.alpha >= \cf8 \strokec8 1\cf0 \strokec4 ) \{\cb1 \
\cb3             s.transition.alpha = \cf8 \strokec8 1\cf0 \strokec4 ; s.current = s.transition.nextState; s.transition.mode = \cf6 \strokec6 'FADE_IN'\cf0 \strokec4 ;\cb1 \
\cb3             \cf2 \strokec2 if\cf0 \strokec4 (s.transition.onMidpoint) s.transition.onMidpoint();\cb1 \
\cb3             s.mouse.clicked = \cf2 \strokec2 false\cf0 \strokec4 ; s.textTyper = \{ text: \cf6 \strokec6 ""\cf0 \strokec4 , index: \cf8 \strokec8 0\cf0 \strokec4 , complete: \cf2 \strokec2 false\cf0 \strokec4  \};\cb1 \
\cb3           \}\cb1 \
\cb3         \} \cf2 \strokec2 else\cf0 \strokec4  \{\cb1 \
\cb3           s.transition.alpha -= \cf8 \strokec8 0.02\cf0 \strokec4 ; \cf2 \strokec2 if\cf0 \strokec4  (s.transition.alpha <= \cf8 \strokec8 0\cf0 \strokec4 ) \{ s.transition.alpha = \cf8 \strokec8 0\cf0 \strokec4 ; s.transition.active = \cf2 \strokec2 false\cf0 \strokec4 ; s.transition.onMidpoint = \cf2 \strokec2 null\cf0 \strokec4 ; \}\cb1 \
\cb3         \}\cb1 \
\cb3       \}\cb1 \
\
\cb3       \cf2 \strokec2 switch\cf0 \strokec4  (s.current) \{\cb1 \
\cb3         \cf2 \strokec2 case\cf0 \strokec4  \cf5 \strokec5 STATE\cf0 \strokec4 .\cf5 \strokec5 MENU\cf0 \strokec4 : updateMenu(); \cf2 \strokec2 break\cf0 \strokec4 ;\cb1 \
\cb3         \cf2 \strokec2 case\cf0 \strokec4  \cf5 \strokec5 STATE\cf0 \strokec4 .\cf5 \strokec5 SCENE_1_NOTIFICATION\cf0 \strokec4 : updateScene1Notification(); \cf2 \strokec2 break\cf0 \strokec4 ;\cb1 \
\cb3         \cf2 \strokec2 case\cf0 \strokec4  \cf5 \strokec5 STATE\cf0 \strokec4 .\cf5 \strokec5 SCENE_1_CHAT\cf0 \strokec4 : updateScene1(); \cf2 \strokec2 break\cf0 \strokec4 ;\cb1 \
\cb3         \cf2 \strokec2 case\cf0 \strokec4  \cf5 \strokec5 STATE\cf0 \strokec4 .\cf5 \strokec5 SCENE_1_PHONE\cf0 \strokec4 : updateScene1Phone(); \cf2 \strokec2 break\cf0 \strokec4 ;\cb1 \
\cb3         \cf2 \strokec2 case\cf0 \strokec4  \cf5 \strokec5 STATE\cf0 \strokec4 .\cf5 \strokec5 SCENE_2_DINNER\cf0 \strokec4 : updateScene2(); \cf2 \strokec2 break\cf0 \strokec4 ;\cb1 \
\cb3         \cf2 \strokec2 case\cf0 \strokec4  \cf5 \strokec5 STATE\cf0 \strokec4 .\cf5 \strokec5 SCENE_3_WALK\cf0 \strokec4 : updateScene3(); \cf2 \strokec2 break\cf0 \strokec4 ;\cb1 \
\cb3         \cf2 \strokec2 case\cf0 \strokec4  \cf5 \strokec5 STATE\cf0 \strokec4 .\cf5 \strokec5 SCENE_HOME_TV\cf0 \strokec4 : updateSceneHomeTV(); \cf2 \strokec2 break\cf0 \strokec4 ;\cb1 \
\cb3         \cf2 \strokec2 case\cf0 \strokec4  \cf5 \strokec5 STATE\cf0 \strokec4 .\cf5 \strokec5 SCENE_4_DATE\cf0 \strokec4 : updateScene4Date(); \cf2 \strokec2 break\cf0 \strokec4 ;\cb1 \
\cb3         \cf2 \strokec2 case\cf0 \strokec4  \cf5 \strokec5 STATE\cf0 \strokec4 .\cf5 \strokec5 SCENE_5_HAIR\cf0 \strokec4 : updateScene5Hair(); \cf2 \strokec2 break\cf0 \strokec4 ;\cb1 \
\cb3         \cf2 \strokec2 case\cf0 \strokec4  \cf5 \strokec5 STATE\cf0 \strokec4 .\cf5 \strokec5 SCENE_6_PHOTO\cf0 \strokec4 : updateScene6Photo(); \cf2 \strokec2 break\cf0 \strokec4 ;\cb1 \
\cb3         \cf2 \strokec2 case\cf0 \strokec4  \cf5 \strokec5 STATE\cf0 \strokec4 .\cf5 \strokec5 SCENE_7_SKINCARE\cf0 \strokec4 : updateScene7Skincare(); \cf2 \strokec2 break\cf0 \strokec4 ;\cb1 \
\cb3         \cf2 \strokec2 case\cf0 \strokec4  \cf5 \strokec5 STATE\cf0 \strokec4 .\cf5 \strokec5 ENDING\cf0 \strokec4 : updateEnding(); \cf2 \strokec2 break\cf0 \strokec4 ;\cb1 \
\cb3         \cf2 \strokec2 default\cf0 \strokec4 : \cf2 \strokec2 break\cf0 \strokec4 ;\cb1 \
\cb3       \}\cb1 \
\cb3       \cb1 \
\cb3       \cf2 \strokec2 if\cf0 \strokec4  (s.transition.active || s.transition.alpha > \cf8 \strokec8 0\cf0 \strokec4 ) \{ ctx.fillStyle = \cf6 \strokec6 `rgba(255, 255, 255, \cf0 \strokec4 $\{s.transition.alpha\}\cf6 \strokec6 )`\cf0 \strokec4 ; ctx.fillRect(\cf8 \strokec8 0\cf0 \strokec4 , \cf8 \strokec8 0\cf0 \strokec4 , \cf5 \strokec5 LOGIC_W\cf0 \strokec4 , \cf5 \strokec5 LOGIC_H\cf0 \strokec4 ); \}\cb1 \
\cb3       \cf2 \strokec2 if\cf0 \strokec4  (s.mouse.clicked) s.mouse.clicked = \cf2 \strokec2 false\cf0 \strokec4 ;\cb1 \
\cb3       animationFrameId = requestAnimationFrame(loop);\cb1 \
\cb3     \};\cb1 \
\
\cb3     animationFrameId = requestAnimationFrame(loop);\cb1 \
\
\cb3     \cf2 \strokec2 return\cf0 \strokec4  () => \{\cb1 \
\cb3       window.removeEventListener(\cf6 \strokec6 'resize'\cf0 \strokec4 , resize);\cb1 \
\cb3       cancelAnimationFrame(animationFrameId);\cb1 \
\cb3       canvas.removeEventListener(\cf6 \strokec6 'mousedown'\cf0 \strokec4 , handleInputStart);\cb1 \
\cb3       canvas.removeEventListener(\cf6 \strokec6 'mousemove'\cf0 \strokec4 , handleInputMove);\cb1 \
\cb3       canvas.removeEventListener(\cf6 \strokec6 'mouseup'\cf0 \strokec4 , handleInputEnd);\cb1 \
\cb3       canvas.removeEventListener(\cf6 \strokec6 'touchstart'\cf0 \strokec4 , handleInputStart);\cb1 \
\cb3       canvas.removeEventListener(\cf6 \strokec6 'touchmove'\cf0 \strokec4 , handleInputMove);\cb1 \
\cb3       canvas.removeEventListener(\cf6 \strokec6 'touchend'\cf0 \strokec4 , handleInputEnd);\cb1 \
\cb3     \};\cb1 \
\cb3   \}, []);\cb1 \
\
\cb3   \cf2 \strokec2 return\cf0 \strokec4  <canvas ref=\{canvasRef\} />;\cb1 \
\cb3 \}\cb1 \
}